/*! For license information please see index.js.LICENSE.txt */
(()=>{var t={924:(t,e,i)=>{"use strict";var r=i(210),s=i(559),n=s(r("String.prototype.indexOf"));t.exports=function(t,e){var i=r(t,!!e);return"function"==typeof i&&n(t,".prototype.")>-1?s(i):i}},559:(t,e,i)=>{"use strict";var r=i(612),s=i(210),n=s("%Function.prototype.apply%"),o=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||r.call(o,n),l=s("%Object.getOwnPropertyDescriptor%",!0),h=s("%Object.defineProperty%",!0),c=s("%Math.max%");if(h)try{h({},"a",{value:1})}catch(t){h=null}t.exports=function(t){var e=a(r,o,arguments);return l&&h&&l(e,"length").configurable&&h(e,"length",{value:1+c(0,t.length-(arguments.length-1))}),e};var u=function(){return a(r,n,arguments)};h?h(t.exports,"apply",{value:u}):t.exports.apply=u},187:t=>{"use strict";function e(t,e,r){r=r||2;var n,o,a,l,u,d,f,m=e&&e.length,g=m?e[0]*r:t.length,y=i(t,0,g,r,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(t,e,r,s){var n,o,a,l=[];for(n=0,o=e.length;n<o;n++)(a=i(t,e[n]*s,n<o-1?e[n+1]*s:t.length,s,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(h),n=0;n<l.length;n++)r=c(l[n],r);return r}(t,e,y,r)),t.length>80*r){n=a=t[0],o=l=t[1];for(var x=r;x<g;x+=r)(u=t[x])<n&&(n=u),(d=t[x+1])<o&&(o=d),u>a&&(a=u),d>l&&(l=d);f=0!==(f=Math.max(a-n,l-o))?32767/f:0}return s(y,v,r,n,o,f,0),v}function i(t,e,i,r,s){var n,o;if(s===A(t,e,i,r)>0)for(n=e;n<i;n+=r)o=T(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=T(n,t[n],t[n+1],o);return o&&y(o,o.next)&&(S(o),o=o.next),o}function r(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function s(t,e,i,h,c,u,p){if(t){!p&&u&&function(t,e,i,r){var s=t;do{0===s.z&&(s.z=d(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,r,s,n,o,a,l,h=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(l=h;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,h*=2}while(o>1)}(s)}(t,h,c,u);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,u?o(t,h,c,u):n(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),S(t),t=m.next,g=m.next;else if((t=m)===g){p?1===p?s(t=a(r(t),e,i),e,i,h,c,u,2):2===p&&l(t,e,i,h,c,u):s(r(t),e,i,h,c,u,1);break}}}function n(t){var e=t.prev,i=t,r=t.next;if(g(e,i,r)>=0)return!1;for(var s=e.x,n=i.x,o=r.x,a=e.y,l=i.y,h=r.y,c=s<n?s<o?s:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,d=s>n?s>o?s:o:n>o?n:o,p=a>l?a>h?a:h:l>h?l:h,m=r.next;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=p&&f(s,a,n,l,o,h,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,i,r){var s=t.prev,n=t,o=t.next;if(g(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,c=s.y,u=n.y,p=o.y,m=a<l?a<h?a:h:l<h?l:h,y=c<u?c<p?c:p:u<p?u:p,v=a>l?a>h?a:h:l>h?l:h,x=c>u?c>p?c:p:u>p?u:p,b=d(m,y,e,i,r),_=d(v,x,e,i,r),w=t.prevZ,T=t.nextZ;w&&w.z>=b&&T&&T.z<=_;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=x&&w!==s&&w!==o&&f(a,c,l,u,h,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,T.x>=m&&T.x<=v&&T.y>=y&&T.y<=x&&T!==s&&T!==o&&f(a,c,l,u,h,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;w&&w.z>=b;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=x&&w!==s&&w!==o&&f(a,c,l,u,h,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=_;){if(T.x>=m&&T.x<=v&&T.y>=y&&T.y<=x&&T!==s&&T!==o&&f(a,c,l,u,h,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function a(t,e,i){var s=t;do{var n=s.prev,o=s.next.next;!y(n,o)&&v(n,s,s.next,o)&&_(n,o)&&_(o,n)&&(e.push(n.i/i|0),e.push(s.i/i|0),e.push(o.i/i|0),S(s),S(s.next),s=t=o),s=s.next}while(s!==t);return r(s)}function l(t,e,i,n,o,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&m(l,h)){var c=w(l,h);return l=r(l,l.next),c=r(c,c.next),s(l,e,i,n,o,a,0),void s(c,e,i,n,o,a,0)}h=h.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function c(t,e){var i=function(t,e){var i,r=e,s=t.x,n=t.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o&&(o=a,i=r.x<r.next.x?r:r.next,a===s))return i}r=r.next}while(r!==e);if(!i)return null;var l,h=i,c=i.x,d=i.y,p=1/0;r=i;do{s>=r.x&&r.x>=c&&s!==r.x&&f(n<d?s:o,n,c,d,n<d?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),_(r,t)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&u(i,r)))&&(i=r,p=l)),r=r.next}while(r!==h);return i}(t,e);if(!i)return e;var s=w(i,t);return r(s,s.next),r(i,i.next)}function u(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,r,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(r-a)>=(i-o)*(e-a)&&(i-o)*(n-a)>=(s-o)*(r-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&v(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(_(t,e)&&_(e,t)&&function(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||y(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,i,r){var s=b(g(t,e,i)),n=b(g(t,e,r)),o=b(g(i,r,t)),a=b(g(i,r,e));return s!==n&&o!==a||!(0!==s||!x(t,i,e))||!(0!==n||!x(t,r,e))||!(0!==o||!x(i,t,r))||!(0!==a||!x(i,e,r))}function x(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function b(t){return t>0?1:t<0?-1:0}function _(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var i=new E(t.i,t.x,t.y),r=new E(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function T(t,e,i,r){var s=new E(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs(A(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;o-=Math.abs(A(t,h,c,i))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function r(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||t,o),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,r,s=[];if(0===this._eventsCount)return s;for(r in t=this._events)e.call(t,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,o=new Array(n);s<n;s++)o[s]=r[s].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,s,n,o){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,s),!0;case 5:return c.fn.call(c.context,e,r,s,n),!0;case 6:return c.fn.call(c.context,e,r,s,n,o),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var d,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,r);break;case 4:c[h].fn.call(c[h].context,e,r,s);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[h].fn.apply(c[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,r,s){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||s&&!a.once||r&&a.context!==r||o(this,n);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||s&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:o(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e=Array.prototype.slice,i=Object.prototype.toString;t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==i.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var s,n=e.call(arguments,1),o=Math.max(0,r.length-n.length),a=[],l=0;l<o;l++)a.push("$"+l);if(s=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var i=r.apply(this,n.concat(e.call(arguments)));return Object(i)===i?i:this}return r.apply(t,n.concat(e.call(arguments)))})),r.prototype){var h=function(){};h.prototype=r.prototype,s.prototype=new h,h.prototype=null}return s}},612:(t,e,i)=>{"use strict";var r=i(648);t.exports=Function.prototype.bind||r},210:(t,e,i)=>{"use strict";var r,s=SyntaxError,n=Function,o=TypeError,a=function(t){try{return n('"use strict"; return ('+t+").constructor;")()}catch(t){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(t){l=null}var h=function(){throw new o},c=l?function(){try{return h}catch(t){try{return l(arguments,"callee").get}catch(t){return h}}}():h,u=i(405)(),d=i(185)(),p=Object.getPrototypeOf||(d?function(t){return t.__proto__}:null),f={},m="undefined"!=typeof Uint8Array&&p?p(Uint8Array):r,g={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":u&&p?p([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":n,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&p?p(p([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&p?p((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&p?p((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&p?p(""[Symbol.iterator]()):r,"%Symbol%":u?Symbol:r,"%SyntaxError%":s,"%ThrowTypeError%":c,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(p)try{null.error}catch(t){var y=p(p(t));g["%Error.prototype%"]=y}var v=function t(e){var i;if("%AsyncFunction%"===e)i=a("async function () {}");else if("%GeneratorFunction%"===e)i=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=a("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var s=t("%AsyncGenerator%");s&&p&&(i=p(s.prototype))}return g[e]=i,i},x={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(612),_=i(642),w=b.call(Function.call,Array.prototype.concat),T=b.call(Function.apply,Array.prototype.splice),S=b.call(Function.call,String.prototype.replace),E=b.call(Function.call,String.prototype.slice),A=b.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,R=function(t,e){var i,r=t;if(_(x,r)&&(r="%"+(i=x[r])[0]+"%"),_(g,r)){var n=g[r];if(n===f&&(n=v(r)),void 0===n&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:n}}throw new s("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===A(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=E(t,0,1),i=E(t,-1);if("%"===e&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var r=[];return S(t,C,(function(t,e,i,s){r[r.length]=i?S(s,P,"$1"):e||t})),r}(t),r=i.length>0?i[0]:"",n=R("%"+r+"%",e),a=n.name,h=n.value,c=!1,u=n.alias;u&&(r=u[0],T(i,w([0,1],u)));for(var d=1,p=!0;d<i.length;d+=1){var f=i[d],m=E(f,0,1),y=E(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new s("property names with quotes must have matching quotes");if("constructor"!==f&&p||(c=!0),_(g,a="%"+(r+="."+f)+"%"))h=g[a];else if(null!=h){if(!(f in h)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(l&&d+1>=i.length){var v=l(h,f);h=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:h[f]}else p=_(h,f),h=h[f];p&&!c&&(g[a]=h)}}return h}},185:t=>{"use strict";var e={foo:{}},i=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof i)}},405:(t,e,i)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,s=i(419);t.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&s()}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,e);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},642:(t,e,i)=>{"use strict";var r=i(612);t.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},631:(t,e,i)=>{var r="function"==typeof Map&&Map.prototype,s=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=r&&s&&"function"==typeof s.get?s.get:null,o=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=a&&l&&"function"==typeof l.get?l.get:null,c=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,x=String.prototype.replace,b=String.prototype.toUpperCase,_=String.prototype.toLowerCase,w=RegExp.prototype.test,T=Array.prototype.concat,S=Array.prototype.join,E=Array.prototype.slice,A=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,M="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,k=Object.prototype.propertyIsEnumerable,F=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function D(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-A(-t):A(t);if(r!==t){var s=String(r),n=v.call(e,s.length+1);return x.call(s,i,"$&_")+"."+x.call(x.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(e,i,"$&_")}var B=i(654),O=B.custom,L=j(O)?O:null;function N(t,e,i){var r="double"===(i.quoteStyle||e)?'"':"'";return r+t+r}function U(t){return x.call(String(t),/"/g,"&quot;")}function G(t){return!("[object Array]"!==W(t)||I&&"object"==typeof t&&I in t)}function z(t){return!("[object RegExp]"!==W(t)||I&&"object"==typeof t&&I in t)}function j(t){if(M)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!R)return!1;try{return R.call(t),!0}catch(t){}return!1}t.exports=function t(e,i,r,s){var a=i||{};if(V(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(V(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!V(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(V(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(V(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=a.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return $(e,a);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var b=String(e);return m?D(e,b):b}if("bigint"==typeof e){var w=String(e)+"n";return m?D(e,w):w}var A=void 0===a.depth?5:a.depth;if(void 0===r&&(r=0),r>=A&&A>0&&"object"==typeof e)return G(e)?"[Array]":"[Object]";var P,O=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=S.call(Array(t.indent+1)," ")}return{base:i,prev:S.call(Array(e+1),i)}}(a,r);if(void 0===s)s=[];else if(X(s,e)>=0)return"[Circular]";function H(e,i,n){if(i&&(s=E.call(s)).push(i),n){var o={depth:a.depth};return V(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),t(e,o,r+1,s)}return t(e,a,r+1,s)}if("function"==typeof e&&!z(e)){var Y=function(t){if(t.name)return t.name;var e=y.call(g.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),tt=Q(e,H);return"[Function"+(Y?": "+Y:" (anonymous)")+"]"+(tt.length>0?" { "+S.call(tt,", ")+" }":"")}if(j(e)){var et=M?x.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):R.call(e);return"object"!=typeof e||M?et:q(et)}if((P=e)&&"object"==typeof P&&("undefined"!=typeof HTMLElement&&P instanceof HTMLElement||"string"==typeof P.nodeName&&"function"==typeof P.getAttribute)){for(var it="<"+_.call(String(e.nodeName)),rt=e.attributes||[],st=0;st<rt.length;st++)it+=" "+rt[st].name+"="+N(U(rt[st].value),"double",a);return it+=">",e.childNodes&&e.childNodes.length&&(it+="..."),it+"</"+_.call(String(e.nodeName))+">"}if(G(e)){if(0===e.length)return"[]";var nt=Q(e,H);return O&&!function(t){for(var e=0;e<t.length;e++)if(X(t[e],"\n")>=0)return!1;return!0}(nt)?"["+J(nt,O)+"]":"[ "+S.call(nt,", ")+" ]"}if(function(t){return!("[object Error]"!==W(t)||I&&"object"==typeof t&&I in t)}(e)){var ot=Q(e,H);return"cause"in Error.prototype||!("cause"in e)||k.call(e,"cause")?0===ot.length?"["+String(e)+"]":"{ ["+String(e)+"] "+S.call(ot,", ")+" }":"{ ["+String(e)+"] "+S.call(T.call("[cause]: "+H(e.cause),ot),", ")+" }"}if("object"==typeof e&&l){if(L&&"function"==typeof e[L]&&B)return B(e,{depth:A-r});if("symbol"!==l&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!n||!t||"object"!=typeof t)return!1;try{n.call(t);try{h.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var at=[];return o&&o.call(e,(function(t,i){at.push(H(i,e,!0)+" => "+H(t,e))})),K("Map",n.call(e),at,O)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t);try{n.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var lt=[];return c&&c.call(e,(function(t){lt.push(H(t,e))})),K("Set",h.call(e),lt,O)}if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t,u);try{d.call(t,d)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return Z("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{u.call(t,u)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return Z("WeakSet");if(function(t){if(!p||!t||"object"!=typeof t)return!1;try{return p.call(t),!0}catch(t){}return!1}(e))return Z("WeakRef");if(function(t){return!("[object Number]"!==W(t)||I&&"object"==typeof t&&I in t)}(e))return q(H(Number(e)));if(function(t){if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(t){}return!1}(e))return q(H(C.call(e)));if(function(t){return!("[object Boolean]"!==W(t)||I&&"object"==typeof t&&I in t)}(e))return q(f.call(e));if(function(t){return!("[object String]"!==W(t)||I&&"object"==typeof t&&I in t)}(e))return q(H(String(e)));if(!function(t){return!("[object Date]"!==W(t)||I&&"object"==typeof t&&I in t)}(e)&&!z(e)){var ht=Q(e,H),ct=F?F(e)===Object.prototype:e instanceof Object||e.constructor===Object,ut=e instanceof Object?"":"null prototype",dt=!ct&&I&&Object(e)===e&&I in e?v.call(W(e),8,-1):ut?"Object":"",pt=(ct||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(dt||ut?"["+S.call(T.call([],dt||[],ut||[]),": ")+"] ":"");return 0===ht.length?pt+"{}":O?pt+"{"+J(ht,O)+"}":pt+"{ "+S.call(ht,", ")+" }"}return String(e)};var H=Object.prototype.hasOwnProperty||function(t){return t in this};function V(t,e){return H.call(t,e)}function W(t){return m.call(t)}function X(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function $(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,r="... "+i+" more character"+(i>1?"s":"");return $(v.call(t,0,e.maxStringLength),e)+r}return N(x.call(x.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Y),"single",e)}function Y(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+b.call(e.toString(16))}function q(t){return"Object("+t+")"}function Z(t){return t+" { ? }"}function K(t,e,i,r){return t+" ("+e+") {"+(r?J(i,r):S.call(i,", "))+"}"}function J(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+S.call(t,","+i)+"\n"+e.prev}function Q(t,e){var i=G(t),r=[];if(i){r.length=t.length;for(var s=0;s<t.length;s++)r[s]=V(t,s)?e(t[s],t):""}var n,o="function"==typeof P?P(t):[];if(M){n={};for(var a=0;a<o.length;a++)n["$"+o[a]]=o[a]}for(var l in t)V(t,l)&&(i&&String(Number(l))===l&&l<t.length||M&&n["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof P)for(var h=0;h<o.length;h++)k.call(t,o[h])&&r.push("["+e(o[h])+"]: "+e(t[o[h]],t));return r}},798:t=>{"use strict";var e=String.prototype.replace,i=/%20/g,r="RFC3986";t.exports={default:r,formatters:{RFC1738:function(t){return e.call(t,i,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:r}},129:(t,e,i)=>{"use strict";var r=i(261),s=i(235),n=i(798);t.exports={formats:n,parse:s,stringify:r}},235:(t,e,i)=>{"use strict";var r=i(769),s=Object.prototype.hasOwnProperty,n=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},h=function(t,e,i,r){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(n),h=a?n.slice(0,a.index):n,c=[];if(h){if(!i.plainObjects&&s.call(Object.prototype,h)&&!i.allowPrototypes)return;c.push(h)}for(var u=0;i.depth>0&&null!==(a=o.exec(n))&&u<i.depth;){if(u+=1,!i.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(t,e,i,r){for(var s=r?e:l(e,i),n=t.length-1;n>=0;--n){var o,a=t[n];if("[]"===a&&i.parseArrays)o=[].concat(s);else{o=i.plainObjects?Object.create(null):{};var h="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(h,10);i.parseArrays||""!==h?!isNaN(c)&&a!==h&&String(c)===h&&c>=0&&i.parseArrays&&c<=i.arrayLimit?(o=[])[c]=s:"__proto__"!==h&&(o[h]=s):o={0:s}}s=o}return s}(c,e,i,r)}};t.exports=function(t,e){var i=function(t){if(!t)return o;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?o.charset:t.charset;return{allowDots:void 0===t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var c="string"==typeof t?function(t,e){var i,h={},c=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,u=e.parameterLimit===1/0?void 0:e.parameterLimit,d=c.split(e.delimiter,u),p=-1,f=e.charset;if(e.charsetSentinel)for(i=0;i<d.length;++i)0===d[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[i]?f="utf-8":"utf8=%26%2310003%3B"===d[i]&&(f="iso-8859-1"),p=i,i=d.length);for(i=0;i<d.length;++i)if(i!==p){var m,g,y=d[i],v=y.indexOf("]="),x=-1===v?y.indexOf("="):v+1;-1===x?(m=e.decoder(y,o.decoder,f,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(y.slice(0,x),o.decoder,f,"key"),g=r.maybeMap(l(y.slice(x+1),e),(function(t){return e.decoder(t,o.decoder,f,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===f&&(g=a(g)),y.indexOf("[]=")>-1&&(g=n(g)?[g]:g),s.call(h,m)?h[m]=r.combine(h[m],g):h[m]=g}return h}(t,i):t,u=i.plainObjects?Object.create(null):{},d=Object.keys(c),p=0;p<d.length;++p){var f=d[p],m=h(f,c[f],i,"string"==typeof t);u=r.merge(u,m,i)}return!0===i.allowSparse?u:r.compact(u)}},261:(t,e,i)=>{"use strict";var r=i(478),s=i(769),n=i(798),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,h=String.prototype.split,c=Array.prototype.push,u=function(t,e){c.apply(t,l(e)?e:[e])},d=Date.prototype.toISOString,p=n.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:s.encode,encodeValuesOnly:!1,format:p,formatter:n.formatters[p],indices:!1,serializeDate:function(t){return d.call(t)},skipNulls:!1,strictNullHandling:!1},m={},g=function t(e,i,n,o,a,c,d,p,g,y,v,x,b,_,w,T){for(var S,E=e,A=T,C=0,P=!1;void 0!==(A=A.get(m))&&!P;){var R=A.get(e);if(C+=1,void 0!==R){if(R===C)throw new RangeError("Cyclic object value");P=!0}void 0===A.get(m)&&(C=0)}if("function"==typeof p?E=p(i,E):E instanceof Date?E=v(E):"comma"===n&&l(E)&&(E=s.maybeMap(E,(function(t){return t instanceof Date?v(t):t}))),null===E){if(a)return d&&!_?d(i,f.encoder,w,"key",x):i;E=""}if("string"==typeof(S=E)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||s.isBuffer(E)){if(d){var M=_?i:d(i,f.encoder,w,"key",x);if("comma"===n&&_){for(var I=h.call(String(E),","),k="",F=0;F<I.length;++F)k+=(0===F?"":",")+b(d(I[F],f.encoder,w,"value",x));return[b(M)+(o&&l(E)&&1===I.length?"[]":"")+"="+k]}return[b(M)+"="+b(d(E,f.encoder,w,"value",x))]}return[b(i)+"="+b(String(E))]}var D,B=[];if(void 0===E)return B;if("comma"===n&&l(E))D=[{value:E.length>0?E.join(",")||null:void 0}];else if(l(p))D=p;else{var O=Object.keys(E);D=g?O.sort(g):O}for(var L=o&&l(E)&&1===E.length?i+"[]":i,N=0;N<D.length;++N){var U=D[N],G="object"==typeof U&&void 0!==U.value?U.value:E[U];if(!c||null!==G){var z=l(E)?"function"==typeof n?n(L,U):L:L+(y?"."+U:"["+U+"]");T.set(e,C);var j=r();j.set(m,T),u(B,t(G,z,n,o,a,c,d,p,g,y,v,x,b,_,w,j))}}return B};t.exports=function(t,e){var i,s=t,h=function(t){if(!t)return f;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||f.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=n.default;if(void 0!==t.format){if(!o.call(n.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var r=n.formatters[i],s=f.filter;return("function"==typeof t.filter||l(t.filter))&&(s=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===t.allowDots?f.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:f.charsetSentinel,delimiter:void 0===t.delimiter?f.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:f.encode,encoder:"function"==typeof t.encoder?t.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:f.encodeValuesOnly,filter:s,format:i,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:f.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof h.filter?s=(0,h.filter)("",s):l(h.filter)&&(i=h.filter);var c,d=[];if("object"!=typeof s||null===s)return"";c=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var p=a[c];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===p&&e&&e.commaRoundTrip;i||(i=Object.keys(s)),h.sort&&i.sort(h.sort);for(var y=r(),v=0;v<i.length;++v){var x=i[v];h.skipNulls&&null===s[x]||u(d,g(s[x],x,p,m,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,y))}var b=d.join(h.delimiter),_=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),b.length>0?_+b:""}},769:(t,e,i)=>{"use strict";var r=i(798),s=Object.prototype.hasOwnProperty,n=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(i[r]=t[r]);return i};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],r=0;r<e.length;++r)for(var s=e[r],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],c=o[h];"object"==typeof c&&null!==c&&-1===i.indexOf(c)&&(e.push({obj:o,prop:h}),i.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(n(i)){for(var r=[],s=0;s<i.length;++s)void 0!==i[s]&&r.push(i[s]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,i){var r=t.replace(/\+/g," ");if("iso-8859-1"===i)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,i,s,n){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",h=0;h<a.length;++h){var c=a.charCodeAt(h);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||n===r.RFC1738&&(40===c||41===c)?l+=a.charAt(h):c<128?l+=o[c]:c<2048?l+=o[192|c>>6]+o[128|63&c]:c<55296||c>=57344?l+=o[224|c>>12]+o[128|c>>6&63]+o[128|63&c]:(h+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(h)),l+=o[240|c>>18]+o[128|c>>12&63]+o[128|c>>6&63]+o[128|63&c])}return l},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(n(t)){for(var i=[],r=0;r<t.length;r+=1)i.push(e(t[r]));return i}return e(t)},merge:function t(e,i,r){if(!i)return e;if("object"!=typeof i){if(n(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(r&&(r.plainObjects||r.allowPrototypes)||!s.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var o=e;return n(e)&&!n(i)&&(o=a(e,r)),n(e)&&n(i)?(i.forEach((function(i,n){if(s.call(e,n)){var o=e[n];o&&"object"==typeof o&&i&&"object"==typeof i?e[n]=t(o,i,r):e.push(i)}else e[n]=i})),e):Object.keys(i).reduce((function(e,n){var o=i[n];return s.call(e,n)?e[n]=t(e[n],o,r):e[n]=o,e}),o)}}},478:(t,e,i)=>{"use strict";var r=i(210),s=i(924),n=i(631),o=r("%TypeError%"),a=r("%WeakMap%",!0),l=r("%Map%",!0),h=s("WeakMap.prototype.get",!0),c=s("WeakMap.prototype.set",!0),u=s("WeakMap.prototype.has",!0),d=s("Map.prototype.get",!0),p=s("Map.prototype.set",!0),f=s("Map.prototype.has",!0),m=function(t,e){for(var i,r=t;null!==(i=r.next);r=i)if(i.key===e)return r.next=i.next,i.next=t.next,t.next=i,i};t.exports=function(){var t,e,i,r={assert:function(t){if(!r.has(t))throw new o("Side channel does not contain "+n(t))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return h(t,r)}else if(l){if(e)return d(e,r)}else if(i)return function(t,e){var i=m(t,e);return i&&i.value}(i,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return u(t,r)}else if(l){if(e)return f(e,r)}else if(i)return function(t,e){return!!m(t,e)}(i,r);return!1},set:function(r,s){a&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new a),c(t,r,s)):l?(e||(e=new l),p(e,r,s)):(i||(i={key:{},next:null}),function(t,e,i){var r=m(t,e);r?r.value=i:t.next={key:e,next:t.next,value:i}}(i,r,s))}};return r}},511:function(t,e,i){var r;t=i.nmd(t),function(s){e&&e.nodeType,t&&t.nodeType;var n="object"==typeof i.g&&i.g;n.global!==n&&n.window!==n&&n.self;var o,a=2147483647,l=36,h=26,c=38,u=700,d=/^xn--/,p=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},g=l-1,y=Math.floor,v=String.fromCharCode;function x(t){throw new RangeError(m[t])}function b(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function _(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+b((t=t.replace(f,".")).split("."),e).join(".")}function w(t){for(var e,i,r=[],s=0,n=t.length;s<n;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<n?56320==(64512&(i=t.charCodeAt(s++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),s--):r.push(e);return r}function T(t){return b(t,(function(t){var e="";return t>65535&&(e+=v((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+v(t)})).join("")}function S(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function E(t,e,i){var r=0;for(t=i?y(t/u):t>>1,t+=y(t/e);t>g*h>>1;r+=l)t=y(t/g);return y(r+(g+1)*t/(t+c))}function A(t){var e,i,r,s,n,o,c,u,d,p,f,m=[],g=t.length,v=0,b=128,_=72;for((i=t.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&x("not-basic"),m.push(t.charCodeAt(r));for(s=i>0?i+1:0;s<g;){for(n=v,o=1,c=l;s>=g&&x("invalid-input"),((u=(f=t.charCodeAt(s++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:l)>=l||u>y((a-v)/o))&&x("overflow"),v+=u*o,!(u<(d=c<=_?1:c>=_+h?h:c-_));c+=l)o>y(a/(p=l-d))&&x("overflow"),o*=p;_=E(v-n,e=m.length+1,0==n),y(v/e)>a-b&&x("overflow"),b+=y(v/e),v%=e,m.splice(v++,0,b)}return T(m)}function C(t){var e,i,r,s,n,o,c,u,d,p,f,m,g,b,_,T=[];for(m=(t=w(t)).length,e=128,i=0,n=72,o=0;o<m;++o)(f=t[o])<128&&T.push(v(f));for(r=s=T.length,s&&T.push("-");r<m;){for(c=a,o=0;o<m;++o)(f=t[o])>=e&&f<c&&(c=f);for(c-e>y((a-i)/(g=r+1))&&x("overflow"),i+=(c-e)*g,e=c,o=0;o<m;++o)if((f=t[o])<e&&++i>a&&x("overflow"),f==e){for(u=i,d=l;!(u<(p=d<=n?1:d>=n+h?h:d-n));d+=l)_=u-p,b=l-p,T.push(v(S(p+_%b,0))),u=y(_/b);T.push(v(S(u,0))),n=E(i,g,r==s),i=0,++r}++i,++e}return T.join("")}o={version:"1.4.1",ucs2:{decode:w,encode:T},decode:A,encode:C,toASCII:function(t){return _(t,(function(t){return p.test(t)?"xn--"+C(t):t}))},toUnicode:function(t){return _(t,(function(t){return d.test(t)?A(t.slice(4).toLowerCase()):t}))}},void 0===(r=function(){return o}.call(e,i,e,t))||(t.exports=r)}()},575:(t,e,i)=>{"use strict";var r=i(511);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var n=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(l),c=["%","/","?",";","#"].concat(h),u=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(129);function v(t,e,i){if(t&&"object"==typeof t&&t instanceof s)return t;var r=new s;return r.parse(t,e,i),r}s.prototype.parse=function(t,e,i){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),o=-1!==s&&s<t.indexOf("#")?"?":"#",l=t.split(o);l[0]=l[0].replace(/\\/g,"/");var v=t=l.join(o);if(v=v.trim(),!i&&1===t.split("#").length){var x=a.exec(v);if(x)return this.path=v,this.href=v,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var b=n.exec(v);if(b){var _=(b=b[0]).toLowerCase();this.protocol=_,v=v.substr(b.length)}if(i||b||v.match(/^\/\/[^@/]+@[^@/]+/)){var w="//"===v.substr(0,2);!w||b&&m[b]||(v=v.substr(2),this.slashes=!0)}if(!m[b]&&(w||b&&!g[b])){for(var T,S,E=-1,A=0;A<u.length;A++)-1!==(C=v.indexOf(u[A]))&&(-1===E||C<E)&&(E=C);for(-1!==(S=-1===E?v.lastIndexOf("@"):v.lastIndexOf("@",E))&&(T=v.slice(0,S),v=v.slice(S+1),this.auth=decodeURIComponent(T)),E=-1,A=0;A<c.length;A++){var C;-1!==(C=v.indexOf(c[A]))&&(-1===E||C<E)&&(E=C)}-1===E&&(E=v.length),this.host=v.slice(0,E),v=v.slice(E),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var R=this.hostname.split(/\./),M=(A=0,R.length);A<M;A++){var I=R[A];if(I&&!I.match(d)){for(var k="",F=0,D=I.length;F<D;F++)I.charCodeAt(F)>127?k+="x":k+=I[F];if(!k.match(d)){var B=R.slice(0,A),O=R.slice(A+1),L=I.match(p);L&&(B.push(L[1]),O.unshift(L[2])),O.length&&(v="/"+O.join(".")+v),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=r.toASCII(this.hostname));var N=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+N,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!f[_])for(A=0,M=h.length;A<M;A++){var G=h[A];if(-1!==v.indexOf(G)){var z=encodeURIComponent(G);z===G&&(z=escape(G)),v=v.split(G).join(z)}}var j=v.indexOf("#");-1!==j&&(this.hash=v.substr(j),v=v.slice(0,j));var H=v.indexOf("?");if(-1!==H?(this.search=v.substr(H),this.query=v.substr(H+1),e&&(this.query=y.parse(this.query)),v=v.slice(0,H)):e&&(this.search="",this.query={}),v&&(this.pathname=v),g[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var V=this.search||"";this.path=N+V}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(n=y.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==s?(s="//"+(s||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),e+s+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+r},s.prototype.resolve=function(t){return this.resolveObject(v(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if("string"==typeof t){var e=new s;e.parse(t,!1,!0),t=e}for(var i=new s,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var h=a[l];"protocol"!==h&&(i[h]=t[h])}return g[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!g[t.protocol]){for(var c=Object.keys(t),u=0;u<c.length;u++){var d=c[u];i[d]=t[d]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||m[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var f=i.pathname||"",y=i.search||"";i.path=f+y}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var v=i.pathname&&"/"===i.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=x||v||i.host&&t.pathname,_=b,w=i.pathname&&i.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!g[i.protocol]);if(T&&(i.hostname="",i.port=null,i.host&&(""===w[0]?w[0]=i.host:w.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),b=b&&(""===p[0]||""===w[0])),x)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),i.search=t.search,i.query=t.query;else if(null!=t.search)return T&&(i.host=w.shift(),i.hostname=i.host,(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.hostname=P.shift(),i.host=i.hostname)),i.search=t.search,i.query=t.query,null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!w.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var S=w.slice(-1)[0],E=(i.host||t.host||w.length>1)&&("."===S||".."===S)||""===S,A=0,C=w.length;C>=0;C--)"."===(S=w[C])?w.splice(C,1):".."===S?(w.splice(C,1),A++):A&&(w.splice(C,1),A--);if(!b&&!_)for(;A--;A)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),E&&"/"!==w.join("/").substr(-1)&&w.push("");var P,R=""===w[0]||w[0]&&"/"===w[0].charAt(0);return T&&(i.hostname=R?"":w.length?w.shift():"",i.host=i.hostname,(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.hostname=P.shift(),i.host=i.hostname)),(b=b||i.host&&w.length)&&!R&&w.unshift(""),w.length>0?i.pathname=w.join("/"):(i.pathname=null,i.path=null),null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},s.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=v,e.DB=function(t,e){return v(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=v(t)),t instanceof s?t.format():s.prototype.format.call(t)}},654:()=>{}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&!t;)t=r[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";var t=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(t||{}),e=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(e||{}),r=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(r||{}),s=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(s||{}),n=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(n||{}),o=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(o||{}),a=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(a||{}),l=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(l||{}),h=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(h||{}),c=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(c||{}),u=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(u||{}),d=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(d||{}),p=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(p||{}),f=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(f||{}),m=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(m||{}),g=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(g||{}),y=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(y||{}),v=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(v||{}),x=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(x||{});const b={createCanvas:(t,e)=>{const i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},_={ADAPTER:b,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var w=/iPhone/i,T=/iPod/i,S=/iPad/i,E=/\biOS-universal(?:.+)Mac\b/i,A=/\bAndroid(?:.+)Mobile\b/i,C=/Android/i,P=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,R=/Silk/i,M=/Windows Phone/i,I=/\bWindows(?:.+)ARM\b/i,k=/BlackBerry/i,F=/BB10/i,D=/Opera Mini/i,B=/\b(CriOS|Chrome)(?:.+)Mobile/i,O=/Mobile(?:.+)Firefox\b/i,L=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function N(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var s=function(t){return function(e){return e.test(t)}}(i),n={apple:{phone:s(w)&&!s(M),ipod:s(T),tablet:!s(w)&&(s(S)||L(e))&&!s(M),universal:s(E),device:(s(w)||s(T)||s(S)||s(E)||L(e))&&!s(M)},amazon:{phone:s(P),tablet:!s(P)&&s(R),device:s(P)||s(R)},android:{phone:!s(M)&&s(P)||!s(M)&&s(A),tablet:!s(M)&&!s(P)&&!s(A)&&(s(R)||s(C)),device:!s(M)&&(s(P)||s(R)||s(A)||s(C))||s(/\bokhttp\b/i)},windows:{phone:s(M),tablet:s(I),device:s(M)||s(I)},other:{blackberry:s(k),blackberry10:s(F),opera:s(D),firefox:s(O),chrome:s(B),device:s(k)||s(F)||s(D)||s(O)||s(B)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const U=(N.default??N)(globalThis.navigator);_.RETINA_PREFIX=/@([0-9\.]+)x/,_.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var G=i(729),z=i(187),j=i(575);const H={parse:j.Qc,format:j.WU,resolve:j.DB};function V(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function W(t){return t.split("?")[0].split("#")[0]}const X={toPosix:t=>("\\","/",t.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/")),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){V(t),t=this.toPosix(t);let e="";const i=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),s=/^[^/:]+:\//.exec(t);if(i||r||s){const n=i?.[0]||r?.[0]||s?.[0];e=n,t=t.slice(n.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;const r=W(this.toPosix(e??_.ADAPTER.getBaseUrl())),s=W(this.toPosix(i??this.rootname(r)));return V(t),(t=this.toPosix(t)).startsWith("/")?X.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(V(t=this.toPosix(t)),0===t.length)return".";let e="";const i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const r=t.endsWith("/");return(t=function(t,e){let i="",r=0,s=-1,n=0,o=-1;for(let e=0;e<=t.length;++e){if(e<t.length)o=t.charCodeAt(e);else{if(47===o)break;o=47}if(47===o){if(s===e-1||1===n);else if(s!==e-1&&2===n){if(i.length<2||2!==r||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){const t=i.lastIndexOf("/");if(t!==i.length-1){-1===t?(i="",r=0):(i=i.slice(0,t),r=i.length-1-i.lastIndexOf("/")),s=e,n=0;continue}}else if(2===i.length||1===i.length){i="",r=0,s=e,n=0;continue}}else i.length>0?i+=`/${t.slice(s+1,e)}`:i=t.slice(s+1,e),r=e-s-1;s=e,n=0}else 46===o&&-1!==n?++n:n=-1}return i}(t)).length>0&&r&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return V(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let i=0;i<t.length;++i){const r=t[i];if(V(r),r.length>0)if(void 0===e)e=r;else{const s=t[i-1]??"";this.extname(s)?e+=`/../${r}`:e+=`/${r}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(V(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const i=47===e;let r=-1,s=!0;const n=this.getProtocol(t),o=t;for(let i=(t=t.slice(n.length)).length-1;i>=1;--i)if(e=t.charCodeAt(i),47===e){if(!s){r=i;break}}else s=!1;return-1===r?i?"/":this.isUrl(o)?n+t:n:i&&1===r?"//":n+t.slice(0,r)},rootname(t){V(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const i=t.indexOf("/",e.length);e=-1!==i?t.slice(0,i):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){V(t),e&&V(e),t=W(this.toPosix(t));let i,r=0,s=-1,n=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(47===l){if(!n){r=i+1;break}}else-1===a&&(n=!1,a=i+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(s=i):(o=-1,s=a))}return r===s?s=a:-1===s&&(s=t.length),t.slice(r,s)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!n){r=i+1;break}}else-1===s&&(n=!1,s=i+1);return-1===s?"":t.slice(r,s)},extname(t){V(t);let e=-1,i=0,r=-1,s=!0,n=0;for(let o=(t=W(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===r&&(s=!1,r=o+1),46===a?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!s){i=o+1;break}}return-1===e||-1===r||0===n||1===n&&e===r-1&&e===i+1?"":t.slice(e,r)},parse(t){V(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let i=(t=W(this.toPosix(t))).charCodeAt(0);const r=this.isAbsolute(t);let s;e.root=this.rootname(t),s=r||this.hasProtocol(t)?1:0;let n=-1,o=0,a=-1,l=!0,h=t.length-1,c=0;for(;h>=s;--h)if(i=t.charCodeAt(h),47!==i)-1===a&&(l=!1,a=h+1),46===i?-1===n?n=h:1!==c&&(c=1):-1!==n&&(c=-1);else if(!l){o=h+1;break}return-1===n||-1===a||0===c||1===c&&n===a-1&&n===o+1?-1!==a&&(e.base=e.name=0===o&&r?t.slice(1,a):t.slice(o,a)):(0===o&&r?(e.name=t.slice(1,n),e.base=t.slice(1,a)):(e.name=t.slice(o,n),e.base=t.slice(o,a)),e.ext=t.slice(n,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},$={};function Y(t,e,i=3){if($[e])return;let r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(r))),$[e]=!0}let q;var Z,K={grad:.9,turn:360,rad:360/(2*Math.PI)},J=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Q=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},tt=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t>i?i:t>e?t:e},et=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},it=function(t){return{r:tt(t.r,0,255),g:tt(t.g,0,255),b:tt(t.b,0,255),a:tt(t.a)}},rt=function(t){return{r:Q(t.r),g:Q(t.g),b:Q(t.b),a:Q(t.a,3)}},st=/^#([0-9a-f]{3,8})$/i,nt=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},ot=function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=Math.max(e,i,r),o=n-Math.min(e,i,r),a=o?n===e?(i-r)/o:n===i?2+(r-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},at=function(t){var e=t.h,i=t.s,r=t.v,s=t.a;e=e/360*6,i/=100,r/=100;var n=Math.floor(e),o=r*(1-i),a=r*(1-(e-n)*i),l=r*(1-(1-e+n)*i),h=n%6;return{r:255*[r,a,o,o,l,r][h],g:255*[l,r,r,a,o,o][h],b:255*[o,o,l,r,r,a][h],a:s}},lt=function(t){return{h:et(t.h),s:tt(t.s,0,100),l:tt(t.l,0,100),a:tt(t.a)}},ht=function(t){return{h:Q(t.h),s:Q(t.s),l:Q(t.l),a:Q(t.a,3)}},ct=function(t){return at((i=(e=t).s,{h:e.h,s:(i*=((r=e.l)<50?r:100-r)/100)>0?2*i/(r+i)*100:0,v:r+i,a:e.a}));var e,i,r},ut=function(t){return{h:(e=ot(t)).h,s:(s=(200-(i=e.s))*(r=e.v)/100)>0&&s<200?i*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,i,r,s},dt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ft=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gt={string:[[function(t){var e=st.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Q(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Q(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=ft.exec(t)||mt.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:it({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=dt.exec(t)||pt.exec(t);if(!e)return null;var i,r,s=lt({h:(i=e[1],r=e[2],void 0===r&&(r="deg"),Number(i)*(K[r]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return ct(s)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=void 0===s?1:s;return J(e)&&J(i)&&J(r)?it({r:Number(e),g:Number(i),b:Number(r),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,i=t.s,r=t.l,s=t.a,n=void 0===s?1:s;if(!J(e)||!J(i)||!J(r))return null;var o=lt({h:Number(e),s:Number(i),l:Number(r),a:Number(n)});return ct(o)},"hsl"],[function(t){var e=t.h,i=t.s,r=t.v,s=t.a,n=void 0===s?1:s;if(!J(e)||!J(i)||!J(r))return null;var o=function(t){return{h:et(t.h),s:tt(t.s,0,100),v:tt(t.v,0,100),a:tt(t.a)}}({h:Number(e),s:Number(i),v:Number(r),a:Number(n)});return at(o)},"hsv"]]},yt=function(t,e){for(var i=0;i<e.length;i++){var r=e[i][0](t);if(r)return[r,e[i][1]]}return[null,void 0]},vt=function(t,e){var i=ut(t);return{h:i.h,s:tt(i.s+100*e,0,100),l:i.l,a:i.a}},xt=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},bt=function(t,e){var i=ut(t);return{h:i.h,s:i.s,l:tt(i.l+100*e,0,100),a:i.a}},_t=function(){function t(t){this.parsed=function(t){return"string"==typeof t?yt(t.trim(),gt.string):"object"==typeof t&&null!==t?yt(t,gt.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Q(xt(this.rgba),2)},t.prototype.isDark=function(){return xt(this.rgba)<.5},t.prototype.isLight=function(){return xt(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=rt(this.rgba)).r,i=t.g,r=t.b,n=(s=t.a)<1?nt(Q(255*s)):"","#"+nt(e)+nt(i)+nt(r)+n;var t,e,i,r,s,n},t.prototype.toRgb=function(){return rt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=rt(this.rgba)).r,i=t.g,r=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+r+", "+s+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,s},t.prototype.toHsl=function(){return ht(ut(this.rgba))},t.prototype.toHslString=function(){return e=(t=ht(ut(this.rgba))).h,i=t.s,r=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+s+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,s},t.prototype.toHsv=function(){return t=ot(this.rgba),{h:Q(t.h),s:Q(t.s),v:Q(t.v),a:Q(t.a,3)};var t},t.prototype.invert=function(){return wt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),wt(vt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),wt(vt(this.rgba,-t))},t.prototype.grayscale=function(){return wt(vt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),wt(bt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),wt(bt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?wt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Q(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=ut(this.rgba);return"number"==typeof t?wt({h:t,s:e.s,l:e.l,a:e.a}):Q(e.h)},t.prototype.isEqual=function(t){return this.toHex()===wt(t).toHex()},t}(),wt=function(t){return t instanceof _t?t:new _t(t)},Tt=[];Z=[function(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in i)r[i[s]]=s;var n={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=r[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var l=this.toRgb(),h=1/0,c="black";if(!n.length)for(var u in i)n[u]=new t(i[u]).toRgb();for(var d in i){var p=(s=l,o=n[d],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));p<h&&(h=p,c=d)}return c}},e.string.push([function(e){var r=e.toLowerCase(),s="transparent"===r?"#0000":i[r];return s?new t(s).toRgb():null},"name"])}],Z.forEach((function(t){Tt.indexOf(t)<0&&(t(_t,gt),Tt.push(t))}));const St=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof St)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if("number"===i||"string"===i||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,i)=>t===e[i]));if(null!==t&&null!==e){const i=Object.keys(t),r=Object.keys(e);return i.length===r.length&&i.every((i=>t[i]===e[i]))}return t===e}toRgba(){const[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,r]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*i),t[2]=Math.round(255*r),t}toRgbArray(t){t=t??[];const[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,i,r,s]=St.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=255&this._int;return e&&(i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0),(255*t<<24)+(i<<16)+(r<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e,i,r,s;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215)e=(t>>16&255)/255,i=(t>>8&255)/255,r=(255&t)/255,s=1;else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,s=255]=t,e/=255,i/=255,r/=255,s/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=St.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const n=wt(t);n.isValid()&&(({r:e,g:i,b:r,a:s}=n.rgba),e/=255,i/=255,r/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=s,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*i|0)}_clamp(t,e=0,i=1){return"number"==typeof t?Math.min(Math.max(t,e),i):(t.forEach(((r,s)=>{t[s]=Math.min(Math.max(r,e),i)})),t)}};let Et=St;function At(t,e=[]){return Y("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Et.shared.setValue(t).toRgbArray(e)}function Ct(t){return Y("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Et.shared.setValue(t).toNumber()}Et.shared=new St,Et.temp=new St,Et.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Pt=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[s.NORMAL_NPM]=s.NORMAL,t[s.ADD_NPM]=s.ADD,t[s.SCREEN_NPM]=s.SCREEN,e[s.NORMAL]=s.NORMAL_NPM,e[s.ADD]=s.ADD_NPM,e[s.SCREEN]=s.SCREEN_NPM;const i=[];return i.push(e),i.push(t),i}();function Rt(t,e){return Pt[e?1:0][t]}function Mt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function It(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function kt(t){return!(t&t-1||!t)}function Ft(t){let e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,i=((t>>>=i)>15?1:0)<<2,e|=i,i=((t>>>=i)>3?1:0)<<1,e|=i,e|(t>>>=i)>>1}function Dt(t,e,i){const r=t.length;let s;if(e>=r||0===i)return;const n=r-(i=e+i>r?r-e:i);for(s=e;s<n;++s)t[s]=t[s+i];t.length=n}function Bt(t){return 0===t?0:t<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let Ot=0;function Lt(){return++Ot}const Nt=class{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Ut=Nt;Ut.EMPTY=new Nt(0,0,0,0);const Gt={},zt=Object.create(null),jt=Object.create(null);function Ht(){let t;for(t in zt)delete zt[t];for(t in jt)delete jt[t]}class Vt{constructor(t,e,i){this._canvas=_.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||_.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Wt(t,e,i){for(let r=0,s=4*i*e;r<e;++r,s+=4)if(0!==t[s+3])return!1;return!0}function Xt(t,e,i,r,s){const n=4*e;for(let e=r,o=r*n+4*i;e<=s;++e,o+=n)if(0!==t[o+3])return!1;return!0}let $t;function Yt(t,e=1){const i=_.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var qt=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(qt||{});const Zt=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},Kt=(t,e)=>Zt(t).priority??e,Jt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Zt).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(Zt).forEach((t=>{t.type.forEach((e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e](t):(r[e]=r[e]||[],r[e].push(t))}))})),this},handle(t,e,i){const r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=i;const n=this._queue;return n[t]&&(n[t].forEach((t=>e(t))),delete n[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,i=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>Kt(e,i)-Kt(t,i))))}),(t=>{const i=e.indexOf(t.ref);-1!==i&&e.splice(i,1)}))}};class Qt{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const te=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function ee(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class ie{constructor(){this.data=0,this.blendMode=s.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==s.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ie;return t.depthTest=!1,t.blend=!0,t}}const re=[];function se(t,e){if(!t)return null;let i="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(i=e[1].toLowerCase())}for(let r=re.length-1;r>=0;--r){const s=re[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class ne{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,r,s,n,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:h}=this;this._aliasCount++;for(let c=0,u=h.length;c<u;c++)h[c][l](t,e,i,r,s,n,o,a);return h===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(ne.prototype,{dispatch:{value:ne.prototype.emit},run:{value:ne.prototype.emit}});class oe{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new ne("setRealSize"),this.onUpdate=new ne("update"),this.onError=new ne("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class ae extends oe{constructor(t,e){const{width:i,height:r}=e||{};if(!i||!r)throw new Error("BufferResource width or height invalid");super(i,r),this.data=t}upload(t,e,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK);const s=e.realWidth,n=e.realHeight;return i.width===s&&i.height===n?r.texSubImage2D(e.target,0,0,0,s,n,e.format,i.type,this.data):(i.width=s,i.height=n,r.texImage2D(e.target,0,i.internalFormat,s,n,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const le={scaleMode:c.NEAREST,format:o.RGBA,alphaMode:p.NPM},he=class extends G{constructor(t=null,e=null){super(),e=Object.assign({},he.defaultOptions,e);const{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:p}=e;!t||t instanceof oe||((t=se(t,p)).internal=!0),this.resolution=d||_.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=n,this.format=h,this.type=c,this.target=u,this.alphaMode=i,this.uid=Lt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=kt(this.realWidth)&&kt(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete jt[this.cacheId],delete zt[this.cacheId],this.cacheId=null),this.dispose(),he.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=_.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let s=null;if(r)s=t;else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Lt()}`}s=t._pixiId}let n=jt[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new he(t,e),n.cacheId=s,he.addToCache(n,s)),n}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);const s=new ae(t,{width:e,height:i}),n=t instanceof Float32Array?l.FLOAT:l.UNSIGNED_BYTE;return new he(s,Object.assign({},le,{type:n},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),jt[e]&&jt[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),jt[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=jt[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete jt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete jt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let ce=he;ce.defaultOptions={mipmap:d.POW2,anisotropicLevel:0,scaleMode:c.LINEAR,wrapMode:u.CLAMP,alphaMode:p.UNPACK,target:a.TEXTURE_2D,format:o.RGBA,type:l.UNSIGNED_BYTE},ce._globalBatch=0;class ue{constructor(){this.texArray=null,this.blend=0,this.type=n.TRIANGLES,this.start=0,this.size=0,this.data=null}}let de=0;class pe{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=de++,this.disposeRunner=new ne("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER}get index(){return this.type===x.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new pe(t)}}class fe{constructor(t,e=0,i=!1,r=l.FLOAT,s,n,o,a=1){this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=s,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,i,r,s){return new fe(t,e,i,r,s)}}const me={Float32Array,Uint32Array,Int32Array,Uint8Array},ge={5126:4,5123:2,5121:1};let ye=0;const ve={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class xe{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ye++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ne("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,r=!1,s,n,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof pe||(e instanceof Array&&(e=new Float32Array(e)),e=new pe(e));const l=t.split("|");if(l.length>1){for(let t=0;t<l.length;t++)this.addAttribute(l[t],e,i,r,s);return this}let h=this.buffers.indexOf(e);return-1===h&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new fe(h,i,r,s,n,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof pe||(t instanceof Array&&(t=new Uint16Array(t)),t=new pe(t)),t.type=x.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new pe;let r;for(r in this.attributes){const i=this.attributes[r],s=this.buffers[i.buffer];t.push(s.data),e.push(i.size*ge[i.type]/4),i.buffer=0}for(i.data=function(t,e){let i=0,r=0;const s={};for(let s=0;s<t.length;s++)r+=e[s],i+=t[s].length;const n=new ArrayBuffer(4*i);let o=null,a=0;for(let i=0;i<t.length;i++){const l=e[i],h=t[i],c=Mt(h);s[c]||(s[c]=new me[c](n)),o=s[c];for(let t=0;t<h.length;t++)o[(t/l|0)*r+a+t%l]=h[t];a+=l}return new Float32Array(n)}(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new xe;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new pe(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new fe(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new xe,i=[],r=[],s=[];let n;for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)r[t]=r[t]||0,r[t]+=n.buffers[t].data.length,s[t]=0}for(let t=0;t<n.buffers.length;t++)i[t]=new(ve[Mt(n.buffers[t].data)])(r[t]),e.buffers[t]=new pe(i[t]);for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)i[t].set(n.buffers[t].data,s[t]),s[t]+=n.buffers[t].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER;let i=0,r=0,s=0,o=0;for(let t=0;t<n.buffers.length;t++)if(n.buffers[t]!==n.indexBuffer){o=t;break}for(const t in n.attributes){const e=n.attributes[t];(0|e.buffer)===o&&(r+=e.size*ge[e.type]/4)}for(let n=0;n<t.length;n++){const a=t[n].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+s]+=i;i+=t[n].buffers[o].data.length/r,s+=a.length}}return e}}class be extends xe{constructor(t=!1){super(),this._buffer=new pe(null,t,!1),this._indexBuffer=new pe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,l.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,l.FLOAT).addAttribute("aColor",this._buffer,4,!0,l.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,l.FLOAT).addIndex(this._indexBuffer)}}const _e=2*Math.PI,we=180/Math.PI,Te=Math.PI/180;var Se=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Se||{});class Ee{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ee(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ae=[new Ee,new Ee,new Ee,new Ee];class Ce{constructor(t=0,e=0,i=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=Se.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ce(0,0,0,0)}clone(){return new Ce(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const i=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>i}const i=this.left,r=this.right,s=this.top,n=this.bottom;if(r<=i||n<=s)return!1;const o=Ae[0].set(t.left,t.top),a=Ae[1].set(t.left,t.bottom),l=Ae[2].set(t.right,t.top),h=Ae[3].set(t.right,t.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(l,l),e.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=i||Math.min(o.x,a.x,l.x,h.x)>=r||Math.max(o.y,a.y,l.y,h.y)<=s||Math.min(o.y,a.y,l.y,h.y)>=n)return!1;const u=c*(a.y-o.y),d=c*(o.x-a.x),p=u*i+d*s,f=u*r+d*s,m=u*i+d*n,g=u*r+d*n;if(Math.max(p,f,m,g)<=u*o.x+d*o.y||Math.min(p,f,m,g)>=u*h.x+d*h.y)return!1;const y=c*(o.y-l.y),v=c*(l.x-o.x),x=y*i+v*s,b=y*r+v*s,_=y*i+v*n,w=y*r+v*n;return!(Math.max(x,b,_,w)<=y*o.x+v*o.y||Math.min(x,b,_,w)>=y*h.x+v*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(s-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=s-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Pe{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Se.CIRC}clone(){return new Pe(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,s=this.y-e;return r*=r,s*=s,r+s<=i}getBounds(){return new Ce(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Re{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.width=i,this.height=r,this.type=Se.ELIP}clone(){return new Re(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,r=(e-this.y)/this.height;return i*=i,r*=r,i+r<=1}getBounds(){return new Ce(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Me{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,r=e.length;i<r;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.type=Se.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Me(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let s=0,n=r-1;s<r;n=s++){const r=this.points[2*s],o=this.points[2*s+1],a=this.points[2*n],l=this.points[2*n+1];o>e!=l>e&&t<(e-o)/(l-o)*(a-r)+r&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class Ie{constructor(t=0,e=0,i=0,r=0,s=20){this.x=t,this.y=e,this.width=i,this.height=r,this.radius=s,this.type=Se.RREC}clone(){return new Ie(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),s=e-(this.y+i);const n=i*i;if(r*r+s*s<=n)return!0;if(r=t-(this.x+this.width-i),r*r+s*s<=n)return!0;if(s=e-(this.y+this.height-i),r*r+s*s<=n)return!0;if(r=t-(this.x+i),r*r+s*s<=n)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class ke{constructor(t=1,e=0,i=0,r=1,s=0,n=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,s,n){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new Ee;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new Ee;const i=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return e.x=this.d*i*r+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,n=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,r,s,n,o,a,l){return this.a=Math.cos(o+l)*s,this.b=Math.sin(o+l)*s,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,i=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,s=this.d,n=t.pivot,o=-Math.atan2(-r,s),a=Math.atan2(i,e),l=Math.abs(o+a);return l<1e-5||Math.abs(_e-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+s*s),t.position.x=this.tx+(n.x*e+n.y*r),t.position.y=this.ty+(n.x*i+n.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,s=this.tx,n=t*r-e*i;return this.a=r/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-r*s)/n,this.ty=-(t*this.ty-e*s)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ke;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new ke}static get TEMP_MATRIX(){return new ke}}const Fe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],De=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Be=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Oe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Le=[],Ne=[],Ue=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Le.push(e);for(let i=0;i<16;i++){const r=Ue(Fe[t]*Fe[i]+Be[t]*De[i]),s=Ue(De[t]*Fe[i]+Oe[t]*De[i]),n=Ue(Fe[t]*Be[i]+Be[t]*Oe[i]),o=Ue(De[t]*Be[i]+Oe[t]*Oe[i]);for(let t=0;t<16;t++)if(Fe[t]===r&&De[t]===s&&Be[t]===n&&Oe[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new ke;e.set(Fe[t],De[t],Be[t],Oe[t],0,0),Ne.push(e)}}();const Ge={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Fe[t],uY:t=>De[t],vX:t=>Be[t],vY:t=>Oe[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Le[t][e],sub:(t,e)=>Le[t][Ge.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Ge.S:Ge.N:2*Math.abs(e)<=Math.abs(t)?t>0?Ge.E:Ge.W:e>0?t>0?Ge.SE:Ge.SW:t>0?Ge.NE:Ge.NW,matrixAppendRotationInv:(t,e,i=0,r=0)=>{const s=Ne[Ge.inv(e)];s.tx=i,s.ty=r,t.append(s)}};class ze{constructor(t,e,i=0,r=0){this._x=i,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ze(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const je=class{constructor(){this.worldTransform=new ke,this.localTransform=new ke,this.position=new ze(this.onChange,this,0,0),this.scale=new ze(this.onChange,this,1,1),this.pivot=new ze(this.onChange,this,0,0),this.skew=new ze(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let He=je;He.IDENTITY=new je;const Ve=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],We={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Xe={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},$e={};let Ye,qe=$e;const Ze={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ke(t){return Ze[t]}let Je=null;const Qe={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function ti(t,e){if(!Je){const e=Object.keys(Qe);Je={};for(let i=0;i<e.length;++i){const r=e[i];Je[t[r]]=Qe[r]}}return Je[e]}function ei(t,e,i){if("precision"!==t.substring(0,9)){let r=e;return e===g.HIGH&&i!==g.HIGH&&(r=g.MEDIUM),`precision ${r} float;\n${t}`}return i!==g.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let ii=0;const ri={},si=class{constructor(e,i,r="pixi-shader",s={}){this.extra={},this.id=ii++,this.vertexSrc=e||si.defaultVertexSrc,this.fragmentSrc=i||si.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),ri[r]?(ri[r]++,r+=`-${ri[r]}`):ri[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}\n${this.fragmentSrc}`,this.vertexSrc=ei(this.vertexSrc,si.defaultVertexPrecision,g.HIGH),this.fragmentSrc=ei(this.fragmentSrc,si.defaultFragmentPrecision,function(){if(!Ye){Ye=g.MEDIUM;const e=function(){if(qe===$e||qe?.isContextLost()){const e=_.ADAPTER.createCanvas();let i;_.PREFER_ENV>=t.WEBGL2&&(i=e.getContext("webgl2",{})),i||(i=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),i?i.getExtension("WEBGL_draw_buffers"):i=null),qe=i}return qe}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Ye=t.precision?g.HIGH:g.MEDIUM}}return Ye}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,i){const r=t+e;let s=Gt[r];return s||(Gt[r]=s=new si(t,e,i)),s}};let ni=si;ni.defaultVertexPrecision=g.HIGH,ni.defaultFragmentPrecision=U.apple.device?g.HIGH:g.MEDIUM;let oi=0;class ai{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=oi++,this.static=!!e,this.ubo=!!i,t instanceof pe?(this.buffer=t,this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new pe(new Float32Array(1)),this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new ai(e,i)}static from(t,e,i){return new ai(t,e,i)}static uboFrom(t,e){return new ai(t,e??!0,!0)}}class li{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof ai?e:new ai(e):new ai({}),this.disposeRunner=new ne("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const r=ni.from(t,e);return new li(r,i)}}class hi{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=ai.from({uSamplers:e},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ni(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ke,default:this.defaultGroupCache[t]};return new li(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class ci{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class ui{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const di=class extends ui{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=be,this.vertexSize=6,this.state=ie.for2d(),this.size=4*di.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const i=_.ADAPTER.getNavigator();if(U.tablet||U.phone){if(U.apple.device){const t=i.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(U.android.device){const t=i.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!U.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Y("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=di.defaultVertexSrc,fragment:e=di.defaultFragmentTemplate}={}){this.shaderGenerator=new hi(t,e)}contextChange(){const e=this.renderer.gl;_.PREFER_ENV===t.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),di.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=te.replace(/%forloop%/gi,ee(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=di,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new ue);for(;e.length<r;)e.push(new ci);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=di._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count;let o=++ce._globalBatch,a=0,l=i[0],h=0;r.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,h,c),h=c,l=i[++a],++o),u._batchEnabled=o,u.touched=n,l.elements[l.count++]=u)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let t=0;t<s.length;t++)s[t]=null;ce._globalBatch=o}buildDrawCalls(t,e,i){const{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=di._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=t;for(let d=e;d<i;++d){const i=r[d],p=i._texture.baseTexture,f=Pt[p.alphaMode?1:0][i.blendMode];r[d]=null,e<d&&u.blend!==f&&(u.size=c-u.start,e=d,u=a[++l],u.texArray=t,u.start=c),this.packInterleavedGeometry(i,s,n,h,c),h+=i.vertexData.length/2*o,c+=i.indices.length,u.blend=f}e<i&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;di.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,r=di._drawCallPool;let s=null;for(let n=0;n<t;n++){const{texArray:t,type:o,size:a,start:l,blend:h}=r[n];s!==t&&(s=t,this.bindAndClearTexArray(t)),this.state.blendMode=h,i.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),di.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=It(Math.ceil(t/8)),i=Ft(e),r=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Qt(r*this.vertexSize*4)),s}getIndexBuffer(t){const e=It(Math.ceil(t/12)),i=Ft(e),r=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(t,e,i,r,s){const{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,h=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=Et.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let t=0;t<c.length;t+=2)o[r++]=c[t],o[r++]=c[t+1],o[r++]=l[t],o[r++]=l[t+1],n[r++]=p,o[r++]=u;for(let t=0;t<h.length;t++)i[s++]=a+h[t]}};let pi=di;pi.defaultBatchSize=4096,pi.extension={name:"batch",type:qt.RendererPlugin},pi._drawCallPool=[],pi._textureArrayPool=[],Jt.add(pi);const fi=class extends li{constructor(t,e,i){super(ni.from(t||fi.defaultVertexSrc,e||fi.defaultFragmentSrc),i),this.padding=0,this.resolution=fi.defaultResolution,this.multisample=fi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ie}apply(t,e,i,r,s){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let mi=fi;mi.defaultResolution=1,mi.defaultMultisample=v.NONE;class gi{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Et(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:r}=t,s=i??e;void 0!==s&&(this.color=s),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}gi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},gi.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"background"},Jt.add(gi);class yi{constructor(t){this.renderer=t,this.emptyRenderer=new ui(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,i,r){const{elements:s,ids:n,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=s[t],l=o._batchLocation;if(l>=0&&l<r&&e[l]===o)n[t]=l;else for(;a<r;){const r=e[a];if(!r||r._batchEnabled!==i||r._batchLocation!==a){n[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}yi.extension={type:qt.RendererSystem,name:"batch"},Jt.add(yi);let vi=0;class xi{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=vi++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=vi++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(e,i){let r;if(_.PREFER_ENV>=t.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}xi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},xi.extension={type:qt.RendererSystem,name:"context"},Jt.add(xi);class bi extends ae{upload(t,e,i){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK);const s=e.realWidth,n=e.realHeight;return i.width===s&&i.height===n?r.texSubImage2D(e.target,0,0,0,s,n,e.format,i.type,this.data):(i.width=s,i.height=n,r.texImage2D(e.target,0,i.internalFormat,s,n,0,e.format,i.type,this.data)),!0}}class _i{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ne("disposeFramebuffer"),this.multisample=v.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ce(null,{scaleMode:c.NEAREST,resolution:1,mipmap:d.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ce(new bi(null,{width:this.width,height:this.height}),{scaleMode:c.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:d.OFF,format:o.DEPTH_COMPONENT,type:l.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const r=this.colorTextures[i],s=r.resolution;r.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class wi extends ce{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=v.NONE),super(null,t),this.mipmap=d.OFF,this.valid=!0,this._clear=new Et([0,0,0,0]),this.framebuffer=new _i(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ti extends oe{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,$t||($t=document.createElement("a")),$t.href=t;const i=H.parse($t.href),r=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&r&&i.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,i,r){const s=t.gl,n=e.realWidth,o=e.realHeight;if(r=r||this.source,"undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement&&r.readyState<=1&&0===r.buffered.length)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||i.width!==n||i.height!==o?(i.width=n,i.height=o,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,r)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,r),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Si extends Ti{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Ti.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??_.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const i=this.source;this.url=i.src;const r=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?r():(i.onload=r,i.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then((t=>t.blob())).then((i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let t=!0;const r=e._glTextures;for(const s in r){const n=r[s];if(n!==i&&n.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class Ei{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const r=e.width,s=e.height;if(i){const e=t.width/2/r,n=t.height/2/s,o=t.x/r+e,a=t.y/s+n;i=Ge.add(i,Ge.NW),this.x0=o+e*Ge.uX(i),this.y0=a+n*Ge.uY(i),i=Ge.add(i,2),this.x1=o+e*Ge.uX(i),this.y1=a+n*Ge.uY(i),i=Ge.add(i,2),this.x2=o+e*Ge.uX(i),this.y2=a+n*Ge.uY(i),i=Ge.add(i,2),this.x3=o+e*Ge.uX(i),this.y3=a+n*Ge.uY(i)}else this.x0=t.x/r,this.y0=t.y/s,this.x1=(t.x+t.width)/r,this.y1=t.y/s,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/s,this.x3=t.x/r,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Ai=new Ei;function Ci(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Pi extends G{constructor(t,e,i,r,s,n,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Ce(0,0,1,1)),t instanceof Pi&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this._uvs=Ai,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new Ee(n.x,n.y):new Ee(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&zt[t.url]&&Pi.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Pi.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Pi(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Ai&&(this._uvs=new Ei),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=_.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let s=null;if(r)s=t;else if(t instanceof ce){if(!t.cacheId){const i=e?.pixiIdPrefix||"pixiid";t.cacheId=`${i}-${Lt()}`,ce.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Lt()}`}s=t._pixiId}let n=zt[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return n||t instanceof ce?!n&&t instanceof ce&&(n=new Pi(t),Pi.addToCache(n,s)):(e.resolution||(e.resolution=Yt(t)),n=new Pi(new ce(t,e)),n.baseTexture.cacheId=s,ce.addToCache(n.baseTexture,s),Pi.addToCache(n,s)),n}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),r=Pi.from(t,Object.assign({resourceOptions:i},e),!1),s=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):s.load().then((()=>Promise.resolve(r)))}static fromBuffer(t,e,i,r){return new Pi(ce.fromBuffer(t,e,i,r))}static fromLoader(t,e,i,r){const s=new ce(t,Object.assign({scaleMode:ce.defaultOptions.scaleMode,resolution:Yt(e)},r)),{resource:n}=s;n instanceof Si&&(n.url=e);const o=new Pi(s);return i||(i=e),ce.addToCache(o.baseTexture,i),Pi.addToCache(o,i),i!==e&&(ce.addToCache(o.baseTexture,e),Pi.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),zt[e]&&zt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),zt[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=zt[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete zt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)zt[t.textureCacheIds[e]]===t&&delete zt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:r,height:s}=t,n=e+r>this.baseTexture.width,o=i+s>this.baseTexture.height;if(n||o){const t=n&&o?"and":"or",a=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,l=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${l}`)}this.valid=r&&s&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Pi._EMPTY||(Pi._EMPTY=new Pi(new ce),Ci(Pi._EMPTY),Ci(Pi._EMPTY.baseTexture)),Pi._EMPTY}static get WHITE(){if(!Pi._WHITE){const t=_.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Pi._WHITE=new Pi(ce.from(t)),Ci(Pi._WHITE),Ci(Pi._WHITE.baseTexture)}return Pi._WHITE}}class Ri extends Pi{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const r=this.baseTexture.resolution,s=Math.round(t*r)/r,n=Math.round(e*r)/r;this.valid=s>0&&n>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(s,n),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ri(new wi(t))}}class Mi{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=v.NONE){const r=new wi(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ri(r)}getOptimalTexture(t,e,i=1,r=v.NONE){let s;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?s=r>1?-r:-1:(s=((65535&(t=It(t)))<<16|65535&(e=It(e)))>>>0,r>1&&(s+=4294967296*r)),this.texturePool[s]||(this.texturePool[s]=[]);let n=this.texturePool[s].pop();return n||(n=this.createTexture(t,e,r)),n.filterPoolKey=s,n.setResolution(i),n}getFilterTexture(t,e,i){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||v.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Mi.SCREEN_KEY=-1;class Ii extends xe{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class ki extends xe{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pe(this.vertices),this.uvBuffer=new pe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Fi{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=v.NONE,this.sourceFrame=new Ce,this.destinationFrame=new Ce,this.bindingSourceFrame=new Ce,this.bindingDestinationFrame=new Ce,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Di=[new Ee,new Ee,new Ee,new Ee],Bi=new ke;class Oi{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Mi,this.statePool=[],this.quad=new Ii,this.quadUv=new ki,this.tempRect=new Ce,this.activeState={},this.globalUniforms=new ai({outputFrame:new Ce,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,r=this.defaultFilterStack,s=this.statePool.pop()||new Fi,n=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,l=e[0].padding,h=e[0].autoFit,c=e[0].legacy??!0;for(let t=1;t<e.length;t++){const i=e[t];o=Math.min(o,i.resolution),a=Math.min(a,i.multisample),l=this.useMaxPadding?Math.max(l,i.padding):l+i.padding,h=h&&i.autoFit,c=c||(i.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=n.current),r.push(s),s.resolution=o,s.multisample=a,s.legacy=c,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(l);const u=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(Bi.copyFrom(i.projection.transform).invert(),u),h?(s.sourceFrame.fit(u),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(u)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,o,a),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=s.sourceFrame.width,d.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(n.sourceFrame),s.bindingDestinationFrame.copyFrom(n.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,n.bind(s.renderTexture,s.sourceFrame,d),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const s=r.inputSize,n=r.inputPixel,o=r.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],n[0]=Math.round(s[0]*e.resolution),n[1]=Math.round(s[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=e.sourceFrame.width*s[2]-.5*n[2],o[3]=e.sourceFrame.height*s[3]-.5*n[3],e.legacy){const t=r.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,a.renderTexture,f.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,r=this.getOptimalFilterTexture(t.width,t.height,e.resolution);r.filterFrame=t.filterFrame;let s=0;for(s=0;s<i.length-1;++s){1===s&&e.multisample>1&&(r=this.getOptimalFilterTexture(t.width,t.height,e.resolution),r.filterFrame=t.filterFrame),i[s].apply(this,t,r,f.CLEAR,e);const n=t;t=r,r=n}i[s].apply(this,t,a.renderTexture,f.BLEND,e),s>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(r)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=f.CLEAR){const{renderTexture:i,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,i.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=1&r.stateId||this.forceClear;(e===f.CLEAR||e===f.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,r){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(n.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(n.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:r}=this.activeState,{orig:s}=e._texture,n=t.set(r.width,0,0,r.height,i.x,i.y),o=e.worldTransform.copyTo(ke.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/s.width,1/s.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,r=v.NONE){return this.texturePool.getOptimalTexture(t,e,i,r)}getFilterTexture(t,e,i){if("number"==typeof t){const i=t;t=e,e=i}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||v.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Di[0],r=Di[1],s=Di[2],n=Di[3];i.set(e.left,e.top),r.set(e.left,e.bottom),s.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(s,s),t.apply(n,n);const o=Math.min(i.x,r.x,s.x,n.x),a=Math.min(i.y,r.y,s.y,n.y),l=Math.max(i.x,r.x,s.x,n.x),h=Math.max(i.y,r.y,s.y,n.y);e.x=o,e.y=a,e.width=l-o,e.height=h-a}roundFrame(t,e,i,r,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:t,b:e,c:i,d:r}=s;if((Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4))return}(s=s?Bi.copyFrom(s):Bi.identity()).translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}Oi.extension={type:qt.RendererSystem,name:"filter"},Jt.add(Oi);class Li{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=v.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Ni=new Ce;class Ui{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new _i(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ce,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;_.PREFER_ENV===t.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=t=>i.drawBuffersWEBGL(t):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(t,e,i=0){const{gl:r}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const i=t.colorTextures[e];this.renderer.texture.unbind(i.parentTextureArray||i)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>i,r=e.height>>i,s=t/e.width;this.setViewport(e.x*s,e.y*s,t,r)}else{const e=t.width>>i,r=t.height>>i;this.setViewport(0,0,e,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,r){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),s.width===i&&s.height===r&&s.x===t&&s.y===e||(s.x=t,s.y=e,s.width=i,s.height=r,this.gl.viewport(t,e,i,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,n=r.COLOR|r.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,s),o.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new Li(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let s=r.length;e.drawBuffers||(s=Math.min(s,1));for(let n=0;n<s;n++){const s=r[n],o=s.parentTextureArray||s;this.renderer.texture.bind(o,0),0===n&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,r=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let n=s.length;i.drawBuffers||(n=Math.min(n,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer():r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let a=0;a<n;a++){const n=s[a],l=n.parentTextureArray||n;this.renderer.texture.bind(l,0),0===a&&r.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,n.target,l._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const r=t.depthTexture;this.renderer.texture.bind(r,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=v.NONE;if(t<=1||null===e)return i;for(let r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return 1===i&&(i=v.NONE),i}blit(t,e,i){const{current:r,renderer:s,gl:n,CONTEXT_UID:o}=this;if(2!==s.context.webGLVersion)return;if(!r)return;const a=r.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=r.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new _i(r.width,r.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||((e=Ni).width=r.width,e.height=r.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,r=t.height,s=this.gl,n=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,n),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,i,r):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,r),e.stencil=n,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ce}destroy(){this.renderer=null}}Ui.extension={type:qt.RendererSystem,name:"framebuffer"},Jt.add(Ui);const Gi={5126:4,5123:2,5121:1};class zi{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==i.webGLVersion){let i=this.renderer.context.extensions.vertexArrayObject;_.PREFER_ENV===t.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=t=>i.bindVertexArrayOES(t),e.deleteVertexArray=t=>i.deleteVertexArrayOES(t)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==i.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,i)=>t.vertexAttribDivisorANGLE(e,i),e.drawElementsInstanced=(e,i,r,s,n)=>t.drawElementsInstancedANGLE(e,i,r,s,n),e.drawArraysInstanced=(e,i,r,s)=>t.drawArraysInstancedANGLE(e,i,r,s)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===i.webGLVersion||!!i.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},s=!0);const n=r[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];e.update(r)}}checkCompatibility(t,e){const i=t.attributes,r=e.attributeData;for(const t in r)if(!i[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const i=t.attributes,r=e.attributeData,s=["g",t.id];for(const t in i)r[t]&&s.push(t,r[t].location);return s.join("-")}initGeometryVao(t,e,i=!0){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let h=l[a];if(h)return l[o.id]=h,h;const c=t.buffers,u=t.attributes,d={},p={};for(const t in c)d[t]=0,p[t]=0;for(const t in u)!u[t].size&&o.attributeData[t]?u[t].size=o.attributeData[t].size:u[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[t].buffer]+=u[t].size*Gi[u[t].type];for(const t in u){const e=u[t],i=e.size;void 0===e.stride&&(d[e.buffer]===i*Gi[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=i*Gi[e.type])}h=r.createVertexArray(),r.bindVertexArray(h);for(let t=0;t<c.length;t++){const e=c[t];n.bind(e),i&&e._glBuffers[s].refCount++}return this.activateVao(t,o),l[o.id]=h,l[a]=h,r.bindVertexArray(null),n.unbind(x.ARRAY_BUFFER),h}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,s=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(n)for(let t=0;t<s.length;t++){const i=s[t]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0!==i.refCount||e||n.dispose(s[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),r.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,r=this.CONTEXT_UID,s=this.renderer.buffer,n=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let a=null;for(const t in o){const l=o[t],h=n[l.buffer],c=h._glBuffers[r];if(e.attributeData[t]){a!==c&&(s.bind(h),a=c);const r=e.attributeData[t].location;if(i.enableVertexAttribArray(r),i.vertexAttribPointer(r,l.size,l.type||i.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(r,l.divisor)}}}}draw(t,e,i,r){const{gl:s}=this,n=this._activeGeometry;if(n.indexBuffer){const o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?n.instanced?s.drawElementsInstanced(t,e||n.indexBuffer.data.length,a,(i||0)*o,r||1):s.drawElements(t,e||n.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else n.instanced?s.drawArraysInstanced(t,i,e||n.getSize(),r||1):s.drawArrays(t,i,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}zi.extension={type:qt.RendererSystem,name:"geometry"},Jt.add(zi);const ji=new ke;class Hi{constructor(t,e){this._texture=t,this.mapCoord=new ke,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const s=t[r],n=t[r+1];e[r]=s*i.a+n*i.c+i.tx,e[r+1]=s*i.b+n*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const r=e.orig,s=e.trim;s&&(ji.set(r.width/s.width,0,0,r.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(ji));const n=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/n.width,o[1]=(e._frame.y+a+l)/n.height,o[2]=(e._frame.x+e._frame.width-a+l)/n.width,o[3]=(e._frame.y+e._frame.height-a+l)/n.height,this.uClampOffset[0]=l/n.realWidth,this.uClampOffset[1]=l/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&0===e.rotate,!0}}class Vi extends mi{constructor(t,e,i){let r=null;"string"!=typeof t&&void 0===e&&void 0===i&&(r=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=r,this.maskMatrix=new ke}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,r){const s=this._maskSprite,n=s._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Hi(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))}}class Wi{constructor(t=null){this.type=y.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=mi.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=y.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Xi{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const t=this.maskDataPool.pop()||new Wi;t.pooled=!0,t.maskObject=e,i=t}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i._colorMask=r?r._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==y.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case y.SCISSOR:this.renderer.scissor.push(i);break;case y.STENCIL:this.renderer.stencil.push(i);break;case y.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case y.COLOR:this.pushColorMask(i)}i.type===y.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case y.SCISSOR:this.renderer.scissor.pop(e);break;case y.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case y.SPRITE:this.popSpriteMask(e);break;case y.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===y.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=y.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=y.SCISSOR:t.type=y.STENCIL:t.type=y.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Vi]));const s=this.renderer,n=s.renderTexture;let o,a;if(n.current){const e=n.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||s.resolution,a=t.multisample??s.multisample;r[0].resolution=o,r[0].multisample=a,r[0].maskSprite=e;const l=i.filterArea;i.filterArea=e.getBounds(!0),s.filter.push(i,r),i.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Xi.extension={type:qt.RendererSystem,name:"mask"},Jt.add(Xi);class $i{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==i&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Yi=new ke,qi=[],Zi=class extends $i{constructor(t){super(t),this.glConst=_.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,qi.pop()??new Ce);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:r,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Zi.isMatrixRotated(e.worldTransform))return!1;if(Zi.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,s){Zi.isMatrixRotated(s)||((s=s?Yi.copyFrom(s):Yi.identity()).translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&qi.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Ki=Zi;Ki.extension={type:qt.RendererSystem,name:"scissor"},Jt.add(Ki);class Ji extends $i{constructor(t){super(t),this.glConst=_.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;0!==s&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==s&&(t._colorMask=s,i.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=i?i._colorMask:15;0!==r&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(i._colorMask=r,e.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ji.extension={type:qt.RendererSystem,name:"stencil"},Jt.add(Ji);class Qi{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Y("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(Y("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(Y("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Qi.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_plugin"},Jt.add(Qi);class tr{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ke,this.transform=null}update(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,r){const s=this.projectionMatrix,n=r?-1:1;s.identity(),s.a=1/e.width*2,s.d=n*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-n-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}tr.extension={type:qt.RendererSystem,name:"projection"},Jt.add(tr);const er=new He;class ir{constructor(t){this.renderer=t,this._tempMatrix=new ke}generateTexture(t,e){const{region:i,...r}=e||{},s=i||t.getLocalBounds(null,!0);0===s.width&&(s.width=1),0===s.height&&(s.height=1);const n=Ri.create({width:s.width,height:s.height,...r});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const o=t.transform;return t.transform=er,this.renderer.render(t,{renderTexture:n,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,n}destroy(){}}ir.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"textureGenerator"},Jt.add(ir);const rr=new Ce,sr=new Ce;class nr{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ce,this.destinationFrame=new Ce,this.viewportFrame=new Ce}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const r=this.renderer;let s,n,o;this.current=t,t?(s=t.baseTexture,o=s.resolution,e||(rr.width=t.frame.width,rr.height=t.frame.height,e=rr),i||(sr.x=t.frame.x,sr.y=t.frame.y,sr.width=e.width,sr.height=e.height,i=sr),n=s.framebuffer):(o=r.resolution,e||(rr.width=r._view.screen.width,rr.height=r._view.screen.height,e=rr),i||((i=rr).width=e.width,i.height=e.height));const a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,t||(a.y=r.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(i,e,o,!n),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=Et.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const s=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=s.width!==n.width||s.height!==n.height;if(o){let{x:t,y:e,width:i,height:r}=this.viewportFrame;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,i,r)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}nr.extension={type:qt.RendererSystem,name:"renderTexture"},Jt.add(nr);class or{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ar(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function lr(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function hr(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return lr(2*e);case"bvec3":return lr(3*e);case"bvec4":return lr(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function cr(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),r=t.getShaderInfoLog(e),s=r.split("\n"),n={},o=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||n[t]||(n[t]=!0,0)))),a=[""];o.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=i.join("\n");a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function ur(t,e,i,r,s){i.buffer.update(s)}const dr={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},pr={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let fr,mr=0;const gr={textureCount:0,uboCount:0};class yr{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=mr++}systemCheck(){if(!function(){if("boolean"==typeof fr)return fr;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");fr=!0===t({a:"b"},"a","b")}catch(t){fr=!1}return fr}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(gr.textureCount=0,gr.uboCount=0,this.syncUniformGroup(t.uniformGroup,gr)),r}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const r in t.uniforms){const s=e[r];if(!s){t.uniforms[r]?.group&&(t.uniforms[r].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${r}, syncData);\n                    `));continue}const n=t.uniforms[r];let o=!1;for(let t=0;t<Ve.length;t++)if(Ve[t].test(s,n)){i.push(Ve[t].code(r,n)),o=!0;break}if(!o){const t=(1!==s.size||s.isArray?Xe:We)[s.type].replace("location",`ud["${r}"].location`);i.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,gr,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[n];if(o||(o=this._uboCache[n]=function(t,e){if(!t.autoManage)return{size:0,syncFunc:ur};const i=function(t,e){const i=[];for(const r in t)e[r]&&i.push(e[r]);return i.sort(((t,e)=>t.index-e.index)),i}(t.uniforms,e),{uboElements:r,size:s}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let i=0,r=0,s=0;for(let t=0;t<e.length;t++){const n=e[t];if(i=pr[n.data.type],n.data.size>1&&(i=Math.max(i,16)*n.data.size),n.dataLen=i,r%i!=0&&r<16){const t=r%i%16;r+=t,s+=t}r+i>16?(s=16*Math.ceil(s/16),n.offset=s,s+=i,r=i):(n.offset=s,r+=i,s+=i)}return s=16*Math.ceil(s/16),{uboElements:e,size:s}}(i),n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<r.length;e++){const i=r[e],s=t.uniforms[i.data.name],o=i.data.name;let a=!1;for(let t=0;t<Ve.length;t++){const e=Ve[t];if(e.codeUbo&&e.test(i.data,s)){n.push(`offset = ${i.offset/4};`,Ve[t].codeUbo(i.data.name,s)),a=!0;break}}if(!a)if(i.data.size>1){const t=Ke(i.data.type),e=Math.max(pr[i.data.type]/16,1),r=t/e,s=(4-r%4)%4;n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${s};\n                }\n\n                `)}else{const t=dr[i.data.type];n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n                ${t};\n                `)}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const r=t.uniforms,s=[`${i}-`];for(const t in r)s.push(t),e[t]&&s.push(e[t].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,r=function(t,e){const i=ar(t,t.VERTEX_SHADER,e.vertexSrc),r=ar(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,r);const n=e.extra?.transformFeedbackVaryings;if(n&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,n.names,"separate"===n.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||cr(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||cr(t,r),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,s,i,r),e.attributeData=function(t,e){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const r=e.getActiveAttrib(t,s);if(r.name.startsWith("gl_"))continue;const n=ti(e,r.type),o={type:n,name:r.name,size:Ke(n),location:e.getAttribLocation(t,r.name)};i[r.name]=o}return i}(s,t),e.uniformData=function(t,e){const i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const r=e.getActiveUniform(t,s),n=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),a=ti(e,r.type);i[n]={name:n,index:s,type:a,size:r.size,isArray:o,value:hr(a,r.size)}}return i}(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const i=Object.keys(e.attributeData);i.sort(((t,e)=>t>e?1:-1));for(let r=0;r<i.length;r++)e.attributeData[i[r]].location=r,t.bindAttribLocation(s,r,i[r]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(r);const o={};for(const i in e.uniformData){const r=e.uniformData[i];o[i]={location:t.getUniformLocation(s,i),value:hr(r.type,r.size)}}return new or(s,o)}(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}yr.extension={type:qt.RendererSystem,name:"shader"},Jt.add(yr);class vr{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}vr.defaultOptions={hello:!1},vr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"startup"},Jt.add(vr);const xr=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=s.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ie,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[s.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.ADD]=[t.ONE,t.ONE],e[s.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.NONE]=[0,0],e[s.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[s.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[s.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[s.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[s.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[s.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[s.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[s.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[s.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[s.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(xr.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(xr.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let br=xr;br.extension={type:qt.RendererSystem,name:"state"},Jt.add(br);class _r extends G{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),i=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new ne(t)}))}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const t in this.runners)this.runners[t].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach((r=>{const s=i.find((t=>this._systemsHash[t]===r));r[t.name](e[s])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const wr=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=wr.defaultMaxIdle,this.checkCountMax=wr.defaultCheckCountMax,this.mode=wr.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==m.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let r=0;r<e.length;r++){const s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){let t=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[t++]=e[i]);e.length=t}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};let Tr=wr;Tr.defaultMode=m.AUTO,Tr.defaultMaxIdle=3600,Tr.defaultCheckCountMax=600,Tr.extension={type:qt.RendererSystem,name:"textureGC"},Jt.add(Tr);class Sr{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=l.UNSIGNED_BYTE,this.internalFormat=o.RGBA,this.samplerType=0}}class Er{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ce,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[l.UNSIGNED_BYTE]:{[o.RGBA]:t.RGBA8,[o.RGB]:t.RGB8,[o.RG]:t.RG8,[o.RED]:t.R8,[o.RGBA_INTEGER]:t.RGBA8UI,[o.RGB_INTEGER]:t.RGB8UI,[o.RG_INTEGER]:t.RG8UI,[o.RED_INTEGER]:t.R8UI,[o.ALPHA]:t.ALPHA,[o.LUMINANCE]:t.LUMINANCE,[o.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[l.BYTE]:{[o.RGBA]:t.RGBA8_SNORM,[o.RGB]:t.RGB8_SNORM,[o.RG]:t.RG8_SNORM,[o.RED]:t.R8_SNORM,[o.RGBA_INTEGER]:t.RGBA8I,[o.RGB_INTEGER]:t.RGB8I,[o.RG_INTEGER]:t.RG8I,[o.RED_INTEGER]:t.R8I},[l.UNSIGNED_SHORT]:{[o.RGBA_INTEGER]:t.RGBA16UI,[o.RGB_INTEGER]:t.RGB16UI,[o.RG_INTEGER]:t.RG16UI,[o.RED_INTEGER]:t.R16UI,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[l.SHORT]:{[o.RGBA_INTEGER]:t.RGBA16I,[o.RGB_INTEGER]:t.RGB16I,[o.RG_INTEGER]:t.RG16I,[o.RED_INTEGER]:t.R16I},[l.UNSIGNED_INT]:{[o.RGBA_INTEGER]:t.RGBA32UI,[o.RGB_INTEGER]:t.RGB32UI,[o.RG_INTEGER]:t.RG32UI,[o.RED_INTEGER]:t.R32UI,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[l.INT]:{[o.RGBA_INTEGER]:t.RGBA32I,[o.RGB_INTEGER]:t.RGB32I,[o.RG_INTEGER]:t.RG32I,[o.RED_INTEGER]:t.R32I},[l.FLOAT]:{[o.RGBA]:t.RGBA32F,[o.RGB]:t.RGB32F,[o.RG]:t.RG32F,[o.RED]:t.R32F,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[l.HALF_FLOAT]:{[o.RGBA]:t.RGBA16F,[o.RGB]:t.RGB16F,[o.RG]:t.RG16F,[o.RED]:t.R16F},[l.UNSIGNED_SHORT_5_6_5]:{[o.RGB]:t.RGB565},[l.UNSIGNED_SHORT_4_4_4_4]:{[o.RGBA]:t.RGBA4},[l.UNSIGNED_SHORT_5_5_5_1]:{[o.RGBA]:t.RGB5_A1},[l.UNSIGNED_INT_2_10_10_10_REV]:{[o.RGBA]:t.RGB10_A2,[o.RGBA_INTEGER]:t.RGB10_A2UI},[l.UNSIGNED_INT_10F_11F_11F_REV]:{[o.RGB]:t.R11F_G11F_B10F},[l.UNSIGNED_INT_5_9_9_9_REV]:{[o.RGB]:t.RGB9_E5},[l.UNSIGNED_INT_24_8]:{[o.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[l.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[o.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[l.UNSIGNED_BYTE]:{[o.RGBA]:t.RGBA,[o.RGB]:t.RGB,[o.ALPHA]:t.ALPHA,[o.LUMINANCE]:t.LUMINANCE,[o.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[l.UNSIGNED_SHORT_5_6_5]:{[o.RGB]:t.RGB},[l.UNSIGNED_SHORT_4_4_4_4]:{[o.RGBA]:t.RGBA},[l.UNSIGNED_SHORT_5_5_5_1]:{[o.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const i=new Sr(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Sr(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<i.length;t++)i[t]===this.unknownTexture&&this.bind(null,t)}for(let r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:r}=this;if(i)for(let i=t-1;i>=0;--i){const t=e[i];t&&t._glTextures[r].samplerType!==h.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new Sr(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===l.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==h.FLOAT&&(this.hasIntegerTextures=!0);else{const r=t.realWidth,s=t.realHeight,n=i.gl;(e.width!==r||e.height!==s||e.dirtyId<0)&&(e.width=r,e.height=s,n.texImage2D(t.target,0,e.internalFormat,r,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Dt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==d.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=u.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==d.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===c.LINEAR){const r=Math.min(t.anisotropicLevel,i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===c.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Er.extension={type:qt.RendererSystem,name:"texture"},Jt.add(Er);class Ar{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:r}=this;e&&r.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:r}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[r]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];n&&(i.buffer.update(n),n._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,n._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let i=0;i<t.buffers.length;i++){const r=t.buffers[i];if(!r)continue;const n=r._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||s.dispose(r,e))}i&&(e||r.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Ar.extension={type:qt.RendererSystem,name:"transformFeedback"},Jt.add(Ar);class Cr{constructor(t){this.renderer=t}init(t){this.screen=new Ce(0,0,t.width,t.height),this.element=t.view||_.ADAPTER.createCanvas(),this.resolution=t.resolution||_.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",i,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Cr.defaultOptions={width:800,height:600,resolution:_.RESOLUTION,autoDensity:!1},Cr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_view"},Jt.add(Cr),_.PREFER_ENV=t.WEBGL2,_.STRICT_TEXTURE_CACHE=!1,_.RENDER_OPTIONS={...xi.defaultOptions,...gi.defaultOptions,...Cr.defaultOptions,...vr.defaultOptions},Object.defineProperties(_,{WRAP_MODE:{get:()=>ce.defaultOptions.wrapMode,set(t){Y("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ce.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>ce.defaultOptions.scaleMode,set(t){Y("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ce.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>ce.defaultOptions.mipmap,set(t){Y("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ce.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>ce.defaultOptions.anisotropicLevel,set(t){Y("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ce.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(Y("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),mi.defaultResolution),set(t){mi.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(Y("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),mi.defaultMultisample),set(t){mi.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>pi.defaultMaxTextures,set(t){Y("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),pi.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>pi.defaultBatchSize,set(t){Y("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),pi.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>pi.canUploadSameBuffer,set(t){Y("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),pi.canUploadSameBuffer=t}},GC_MODE:{get:()=>Tr.defaultMode,set(t){Y("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Tr.defaultMode=t}},GC_MAX_IDLE:{get:()=>Tr.defaultMaxIdle,set(t){Y("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Tr.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Tr.defaultCheckCountMax,set(t){Y("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Tr.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>ni.defaultVertexPrecision,set(t){Y("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ni.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>ni.defaultFragmentPrecision,set(t){Y("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ni.defaultFragmentPrecision=t}}});var Pr=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Pr||{});class Rr{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Mr=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Rr(null,null,1/0),this.deltaMS=1/Mr.targetFPMS,this.elapsedMS=1/Mr.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Pr.NORMAL){return this._addListener(new Rr(t,e,i))}addOnce(t,e,i=Pr.NORMAL){return this._addListener(new Rr(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Mr.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Mr.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Mr._shared){const t=Mr._shared=new Mr;t.autoStart=!0,t._protected=!0}return Mr._shared}static get system(){if(!Mr._system){const t=Mr._system=new Mr;t.autoStart=!0,t._protected=!0}return Mr._system}};let Ir=Mr;Ir.targetFPMS=.06,Object.defineProperties(_,{TARGET_FPMS:{get:()=>Ir.targetFPMS,set(t){Y("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ir.targetFPMS=t}}});class kr{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Pr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ir.shared:new Ir,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}kr.extension=qt.Application,Jt.add(kr);const Fr=[];function Dr(t){for(const e of Fr)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}Jt.handleByList(qt.Renderer,Fr);const Br="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Or{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=v.HIGH?this.multisample=v.HIGH:e>=v.MEDIUM?this.multisample=v.MEDIUM:e>=v.LOW?this.multisample=v.LOW:this.multisample=v.NONE}destroy(){}}Or.extension={type:qt.RendererSystem,name:"_multisample"},Jt.add(Or);class Lr{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Nr{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:r,CONTEXT_UID:s}=this;i=i||0;const n=t._glBuffers[s]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,n.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,r=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new Lr(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Nr.extension={type:qt.RendererSystem,name:"buffer"},Jt.add(Nr);class Ur{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let r,s,n,o;if(e&&(r=e.renderTexture,s=e.clear,n=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!r,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(r||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}i.renderTexture.bind(r),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),r&&(e.blit&&i.framebuffer.blit(),r.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Ur.extension={type:qt.RendererSystem,name:"objectRenderer"},Jt.add(Ur);const Gr=class extends _r{constructor(t){super(),this.type=e.WEBGL,t=Object.assign({},_.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ai({projectionMatrix:new ke},!0);const i={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Gr.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(i),"useContextAlpha"in t&&(Y("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Gr.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(void 0===q&&(q=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:_.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!_.ADAPTER.getWebGLRenderingContext())return!1;const e=_.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const r=!!i?.getContextAttributes()?.stencil;if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,r}catch(t){return!1}}()),q)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Y("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Y("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Y("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Y("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Y("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Y("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Y("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Y("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let zr=Gr;zr.extension={type:qt.Renderer,priority:1},zr.__plugins={},zr.__systems={},Jt.handleByMap(qt.RendererPlugin,zr.__plugins),Jt.handleByMap(qt.RendererSystem,zr.__systems),Jt.add(zr);class jr extends oe{constructor(t,e){const{width:i,height:r}=e||{};super(i,r),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new ce;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof oe?this.addResourceAt(t[i],i):this.addResourceAt(se(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const Hr=class extends jr{constructor(t,e){const{width:i,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(t&&t.length!==Hr.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let t=0;t<Hr.SIDES;t++)this.items[t].target=a.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==n,t&&this.initFromArray(t,e),!1!==s&&this.load()}bind(t){super.bind(t),t.target=a.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=a.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const r=this.itemDirtyIds;for(let s=0;s<Hr.SIDES;s++){const n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),r[s]=n.dirtyId):r[s]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Hr.SIDES}};let Vr=Hr;Vr.SIDES=6;class Wr extends Ti{constructor(t,e){let i,r;e=e||{},"string"==typeof t?(i=Wr.EMPTY,r=t):(i=t,r=null),super(i),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await _.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await e.blob();if(this.destroyed)return;const r=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=r,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return Wr._EMPTY=Wr._EMPTY??_.ADAPTER.createCanvas(0,0),Wr._EMPTY}}const Xr=class extends Ti{constructor(t,e){e=e||{},super(_.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Xr.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Ti.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),s=Math.round(s);const n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${Lt()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(t){const e=Xr.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Xr.SVG_XML.test(t)}};let $r=Xr;$r.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,$r.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Yr=class extends Ti{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const r=t[0].src||t[0];Ti.crossOrigin(i,r,e.crossorigin);for(let e=0;e<t.length;++e){const r=document.createElement("source");let{src:s,mime:n}=t[e];s=s||t[e];const o=s.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);n=n||Yr.MIME_TYPES[a]||`video/${a}`,r.src=s,r.type=n,i.appendChild(r)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=Ir.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ir.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ir.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Ir.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ir.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ir.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Yr.TYPES.includes(e)}};let qr=Yr;qr.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qr.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},re.push(Wr,Si,class extends Ti{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},qr,$r,ae,Vr,class extends jr{constructor(t,e){const{width:i,height:r}=e||{};let s,n;Array.isArray(t)?(s=t,n=t.length):n=t,super(n,{width:i,height:r}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=a.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:r,itemDirtyIds:s,items:n}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,e.format,i.type,null);for(let t=0;t<r;t++){const r=n[t];s[t]<r.dirtyId&&(s[t]=r.dirtyId,r.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,r.resource.width,r.resource.height,1,e.format,i.type,r.resource.source))}return!0}});class Zr{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Ce.EMPTY:((t=t||new Ce(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:r,c:s,d:n,tx:o,ty:a}=t,l=i*e.x+s*e.y+o,h=r*e.x+n*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)}addQuad(t){let e=this.minX,i=this.minY,r=this.maxX,s=this.maxY,n=t[0],o=t[1];e=n<e?n:e,i=o<i?o:i,r=n>r?n:r,s=o>s?o:s,n=t[2],o=t[3],e=n<e?n:e,i=o<i?o:i,r=n>r?n:r,s=o>s?o:s,n=t[4],o=t[5],e=n<e?n:e,i=o<i?o:i,r=n>r?n:r,s=o>s?o:s,n=t[6],o=t[7],e=n<e?n:e,i=o<i?o:i,r=n>r?n:r,s=o>s?o:s,this.minX=e,this.minY=i,this.maxX=r,this.maxY=s}addFrame(t,e,i,r,s){this.addFrameMatrix(t.worldTransform,e,i,r,s)}addFrameMatrix(t,e,i,r,s){const n=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,c=t.ty;let u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=n*e+a*i+h,g=o*e+l*i+c;u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*r+a*i+h,g=o*r+l*i+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*e+a*s+h,g=o*e+l*s+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*r+a*s+h,g=o*r+l*s+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,this.minX=u,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(t,e,i){let r=this.minX,s=this.minY,n=this.maxX,o=this.maxY;for(let a=e;a<i;a+=2){const e=t[a],i=t[a+1];r=e<r?e:r,s=i<s?i:s,n=e>n?e:n,o=i>o?i:o}this.minX=r,this.minY=s,this.maxX=n,this.maxY=o}addVertices(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)}addVerticesMatrix(t,e,i,r,s=0,n=s){const o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,p=this.minY,f=this.maxX,m=this.maxY;for(let t=i;t<r;t+=2){const i=e[t],r=e[t+1],g=o*i+l*r+c,y=h*r+a*i+u;d=Math.min(d,g-s),f=Math.max(f,g+s),p=Math.min(p,y-n),m=Math.max(m,y+n)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addBounds(t){const e=this.minX,i=this.minY,r=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&r<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=r<e?r:e,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&r<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=r<e?r:e,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,r,s,n){t-=s,e-=n,i+=s,r+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class Kr extends G{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new He,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Zr,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(Kr.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ce),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ce),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Zr);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const n=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-s,n}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,r=1,s=0,n=0,o=0,a=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=r||1,this.rotation=s,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Jr),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*we}set angle(t){this.transform.rotation=t*Te}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Jr extends Kr{constructor(){super(...arguments),this.sortDirty=null}}Kr.prototype.displayObjectUpdateTransform=Kr.prototype.updateTransform;const Qr=new ke;function ts(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const es=class extends Kr{constructor(){super(),this.children=[],this.sortableChildren=es.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Dt(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,Dt(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Dt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,r=e-i;let s;if(r>0&&r<=e){s=this.children.splice(i,r);for(let t=0;t<s.length;++t)s[t].parent=null,s[t].transform&&(s[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<s.length;++t)s[t].emit("removed",this),this.emit("childRemoved",s[t],this,t);return s}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(ts),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==es.prototype._render&&(i=this.getBounds(!0));const s=t.projection.transform;if(s&&(r?(r=Qr.copyFrom(r),r.prepend(s)):r=s),i&&e.intersects(i,r))this._render(t);else if(this.cullArea)return;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e],r=i.cullable;i.cullable=r||!this.cullArea,i.render(t),i.cullable=r}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const r=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==y.NONE));if(r&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}r&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<i.length;++e)i[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let is=es;is.defaultSortableChildren=!1,is.prototype.containerUpdateTransform=is.prototype.updateTransform,Object.defineProperties(_,{SORTABLE_CHILDREN:{get:()=>is.defaultSortableChildren,set(t){Y("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),is.defaultSortableChildren=t}}});const rs=new Ee,ss=new Uint16Array([0,1,2,0,2,3]);class ns extends is{constructor(t){super(),this._anchor=new ze(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Et(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=s.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Pi.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ss,this.pluginName="batch",this.isSprite=!0,this._roundPixels=_.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Bt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Bt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=this.vertexData,h=t.trim,c=t.orig,u=this._anchor;let d=0,p=0,f=0,m=0;if(h?(p=h.x-u._x*c.width,d=p+h.width,m=h.y-u._y*c.height,f=m+h.height):(p=-u._x*c.width,d=p+c.width,m=-u._y*c.height,f=m+c.height),l[0]=i*p+s*m+o,l[1]=n*m+r*p+a,l[2]=i*d+s*m+o,l[3]=n*m+r*d+a,l[4]=i*d+s*f+o,l[5]=n*f+r*d+a,l[6]=i*p+s*f+o,l[7]=n*f+r*p+a,this._roundPixels){const t=_.RESOLUTION;for(let e=0;e<l.length;++e)l[e]=Math.round(l[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,r=this._anchor,s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,c=s.ty,u=-r._x*i.width,d=u+i.width,p=-r._y*i.height,f=p+i.height;e[0]=n*u+a*p+h,e[1]=l*p+o*u+c,e[2]=n*d+a*p+h,e[3]=l*p+o*d+c,e[4]=n*d+a*f+h,e[5]=l*f+o*d+c,e[6]=n*u+a*f+h,e[7]=l*f+o*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Zr),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ce),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,rs);const e=this._texture.orig.width,i=this._texture.orig.height,r=-e*this.anchor.x;let s=0;return rs.x>=r&&rs.x<r+e&&(s=-i*this.anchor.y,rs.y>=s&&rs.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof Pi?t:Pi.from(t,e);return new ns(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Bt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Bt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Pi.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const os=new ke;Kr.prototype._cacheAsBitmap=!1,Kr.prototype._cacheData=null,Kr.prototype._cacheAsBitmapResolution=null,Kr.prototype._cacheAsBitmapMultisample=null;class as{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Kr.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new as),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Kr.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Kr.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;i.pad(t)}i.ceil(_.RESOLUTION);const r=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),n=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=Ri.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${Lt()}`;this._cacheData.textureCacheId=l,ce.addToCache(a.baseTexture,l),Pi.addToCache(a,l);const h=this.transform.localTransform.copyTo(os).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(r,s,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new ns(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-i.x/i.width,c.anchor.y=-i.y/i.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},Kr.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Kr.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,s=t._projTransform;e.ceil(_.RESOLUTION);const n=Ri.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${Lt()}`;this._cacheData.textureCacheId=o,ce.addToCache(n.baseTexture,o),Pi.addToCache(n,o);const a=os;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:n,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const l=new ns(n);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},Kr.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Kr.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Kr.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ce.removeFromCache(this._cacheData.textureCacheId),Pi.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Kr.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Kr.prototype.name=null,is.prototype.getChildByName=function(t,e){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,i=this.children.length;e<i;e++){const i=this.children[e];if(!i.getChildByName)continue;const r=i.getChildByName(t,!0);if(r)return r}return null},Kr.prototype.getGlobalPosition=function(t=new Ee,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const ls={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},hs=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class cs extends mi{constructor(t,e=8,i=4,r=mi.defaultResolution,s=5){const n=function(t,e){const i=Math.ceil(t/2);let r,s="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=r.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(i-1)+".0"),n+=t,n+="\n"}return s=s.replace("%blur%",n),s=s.replace("%size%",t.toString()),s}(s,t),o=function(t){const e=ls[t],i=e.length;let r,s=hs,n="";for(let s=0;s<t;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());r=s,s>=i&&(r=t-s-1),o=o.replace("%value%",e[r].toString()),n+=o,n+="\n"}return s=s.replace("%blur%",n),s=s.replace("%size%",t.toString()),s}(s);super(n,o),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{const s=t.getFilterTexture(),n=t.renderer;let o=e,a=s;this.state.blend=!1,t.applyFilter(this,o,a,f.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,f.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,r),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class us extends mi{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Br,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,r,s]=Et.shared.setValue(t).toArray(),n=[i,0,0,0,0,0,r,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),r=Math.sin(t),s=1/3,n=(0,Math.sqrt)(s),o=[i+(1-i)*s,s*(1-i)-n*r,s*(1-i)+n*r,0,0,s*(1-i)+n*r,i+s*(1-i),s*(1-i)-n*r,0,0,s*(1-i)-n*r,s*(1-i)+n*r,i+s*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const i=(t||0)+1,r=-.5*(i-1),s=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=2*t/3+1,r=-.5*(i-1),s=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,r,s){t=t||.2,e=e||.15,i=i||16770432,r=r||3375104;const n=Et.shared,[o,a,l]=n.setValue(i).toArray(),[h,c,u]=n.setValue(r).toArray(),d=[.3,.59,.11,0,0,o,a,l,t,0,h,c,u,e,0,o-h,a-c,l-u,0,0];this._loadMatrix(d,s)}night(t,e){const i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}us.prototype.grayscale=us.prototype.greyscale;const ds={AlphaFilter:class extends mi{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends mi{constructor(t=8,e=4,i=mi.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new cs(!0,t,e,i,r),this.blurYFilter=new cs(!1,t,e,i,r),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,r){const s=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(s&&n){const s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,f.CLEAR),this.blurYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}else n?this.blurYFilter.apply(t,e,i,r):this.blurXFilter.apply(t,e,i,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:cs,ColorMatrixFilter:us,DisplacementFilter:class extends mi{constructor(t,e){const i=new ke;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new Ee(e,e)}apply(t,e,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,n=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=s.a/n,this.uniforms.rotation[1]=s.b/n,this.uniforms.rotation[2]=s.c/o,this.uniforms.rotation[3]=s.d/o),t.applyFilter(this,e,i,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends mi{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends mi{constructor(t=.5,e=Math.random()){super(Br,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(ds).forEach((([t,e])=>{Object.defineProperty(ds,t,{get:()=>(Y("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const ps=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(Ir.system.add(this.tickerUpdate,this,Pr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ir.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class fs{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=fs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ee,this.page=new Ee,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,r,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class ms extends fs{constructor(){super(...arguments),this.client=new Ee,this.movement=new Ee,this.offset=new Ee,this.global=new Ee,this.screen=new Ee}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,s,n,o,a,l,h,c,u,d,p,f){throw new Error("Method not implemented.")}}class gs extends ms{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ys extends ms{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}ys.DOM_DELTA_PIXEL=0,ys.DOM_DELTA_LINE=1,ys.DOM_DELTA_PAGE=2;const vs=new Ee,xs=new Ee;class bs{constructor(t){this.dispatch=new G,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,r=e.length;i<r;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){ps.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,vs.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,s=i.length-1;r<s;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(0===i.length)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(e)?e:[e];for(let e=i.length-1;e>=0;e--)r.forEach((r=>{t.currentTarget=i[e],this.notifyTarget(t,r)}))}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,r,s,n=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(ps.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let l=a.length-1;l>=0;l--){const h=a[l],c=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,i,r,s,n||s(t,i));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),o=!0}}}const a=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:o?this._hitElements:a&&!s(t,i)&&r(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,r,s){if(this._interactivePrune(t)||s(t,i))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(ps.pauseUpdate=!1),t.interactiveChildren&&t.children){const n=t.children;for(let o=n.length-1;o>=0;o--){const a=n[o],l=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,i,r,s);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const e=t.isInteractive();return(l.length>0||e)&&l.push(t),l}}}const n=this._isInteractive(e),o=t.isInteractive();return n&&r(t,i)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||"none"===t.eventMode||"passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,xs),!t.hitArea.contains(xs.x,xs.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const i=`on${e=e??t.type}`;t.currentTarget[i]?.(t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i="mouse"===e.pointerType||"pen"===e.pointerType,r=this.trackingData(t.pointerId),s=this.findMountedTarget(r.overTargets);if(r.overTargets?.length>0&&s!==e.target){const r="mousemove"===t.type?"mouseout":"pointerout",n=this.createPointerEvent(t,r,s);if(this.dispatchEvent(n,"pointerout"),i&&this.dispatchEvent(n,"mouseout"),!e.composedPath().includes(s)){const r=this.createPointerEvent(t,"pointerleave",s);for(r.eventPhase=r.AT_TARGET;r.target&&!e.composedPath().includes(r.target);)r.currentTarget=r.target,this.notifyTarget(r),i&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;this.freeEvent(r)}this.freeEvent(n)}if(s!==e.target){const r="mousemove"===t.type?"mouseover":"pointerover",n=this.clonePointerEvent(e,r);this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover");let o=s?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==s&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(n)}const n=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&n.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&n.push("globaltouchmove")),i&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&n.push("globalmousemove"),this.cursor=e.target?.cursor),n.length>0&&this.all(e,n),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),r="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),r&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,r=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const n=this.createPointerEvent(t,"pointerleave",r);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),s=this.findMountedTarget(r.pressTargetsByButton[t.button]);let n=s;if(s&&!i.composedPath().includes(s)){let e=s;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],n=e}if(n){const s=this.clonePointerEvent(i,"click");s.target=n,s.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:e});const o=r.clicksByButton[t.button];if(o.target===s.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=e,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof gs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(i){let s=i;for(;s;)r.currentTarget=s,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof ys))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const r=this.allocateEvent(gs);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],"string"==typeof e&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(ys);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(gs);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof gs&&e instanceof gs&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof ms&&e instanceof ms&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let r=0,s=i.length;r<s&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeListener(e,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,t)}}const _s={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ws=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new bs(null),ps.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new gs(null),this.rootWheelEvent=new ys(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ws.defaultEventFeatures},{set:(t,e,i)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,ws._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],r=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;ps.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let t=0,e=r.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,r[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,ps.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;ps.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;ps.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let r;r=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const s=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*s,t.y=(i-r.top)*(this.domElement.height/r.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,r=t.changedTouches.length;i<r;i++){const r=t.changedTouches[i];void 0===r.button&&(r.button=0),void 0===r.buttons&&(r.buttons=1),void 0===r.isPrimary&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===r.width&&(r.width=r.radiusX||1),void 0===r.height&&(r.height=r.radiusY||1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="touch"),void 0===r.pointerId&&(r.pointerId=r.identifier||0),void 0===r.pressure&&(r.pressure=r.force||.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),void 0===r.layerX&&(r.layerX=r.offsetX=r.clientX),void 0===r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const i=t;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=_s[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Ts=ws;function Ss(t){return"dynamic"===t||"static"===t}Ts.extension={name:"events",type:[qt.RendererSystem,qt.CanvasRendererSystem]},Ts.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Jt.add(Ts);const Es={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Ss(Ts.defaultEventMode)},set interactive(t){Y("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ts.defaultEventMode},set eventMode(t){this._internalInteractive=Ss(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const r="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,r)},removeEventListener(t,e,i){const r="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,r)},dispatchEvent(t){if(!(t instanceof fs))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Kr.mixin(Es),Kr.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class As{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(U.tablet||U.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(U.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:r,height:s}=this.renderer.view.getBoundingClientRect(),{width:n,height:o,resolution:a}=this.renderer,l=r/n*a,h=s/o*a;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${n}px`,c.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,Dt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(c.style.left=(i.tx+t.x*i.a)*l+"px",c.style.top=(i.ty+t.y*i.d)*h+"px",c.style.width=t.width*i.a*l+"px",c.style.height=t.height*i.d*h+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*l+"px",c.style.top=t.y*h+"px",c.style.width=t.width*l+"px",c.style.height=t.height*h+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),e.accessibleTitle===c.title&&e.tabIndex===c.tabIndex||(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,r=this.renderer.events.rootBoundary,s=Object.assign(new fs(r),{target:i});r.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>r.dispatchEvent(s,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}As.extension={name:"accessibility",type:[qt.RendererPlugin,qt.CanvasRendererPlugin]},Jt.add(As);const Cs=class{constructor(t){this.stage=new is,t=Object.assign({forceCanvas:!1},t),this.renderer=Dr(t),Cs._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const i=Cs._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Ps=Cs;Ps._plugins=[],Jt.handleByList(qt.Application,Ps._plugins);class Rs{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:r}=this._resizeTo;t=i,e=r}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Rs.extension=qt.Application,Jt.add(Rs);const Ms={loader:qt.LoadParser,resolver:qt.ResolveParser,cache:qt.CacheParser,detection:qt.DetectionParser};Jt.handle(qt.Asset,(t=>{const e=t.ref;Object.entries(Ms).filter((([t])=>!!e[t])).forEach((([t,i])=>Jt.add(Object.assign(e[t],{extension:e[t].extension??i}))))}),(t=>{const e=t.ref;Object.keys(Ms).filter((t=>!!e[t])).forEach((t=>Jt.remove(e[t])))}));class Is{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function ks(t,e){const i=t.split("?")[0],r=X.extname(i).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const Fs=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),Ds=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Fs(t);let r;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];if(s.test(e)){r=s.getCacheableAssets(i,e);break}}r||(r={},i.forEach((t=>{r[t]=e})));const s=Object.keys(r),n={cacheKeys:s,keys:i};if(i.forEach((t=>{this._cacheMap.set(t,n)})),s.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,r[t])})),e instanceof Pi){const t=e;i.forEach((e=>{t.baseTexture!==Pi.EMPTY.baseTexture&&ce.addToCache(t.baseTexture,e),Pi.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},Bs=t=>!Array.isArray(t);class Os{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let r=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let i=0;i<this.parsers.length;i++){const r=this.parsers[i];if(r.load&&r.test?.(t,e,this)){s=r;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await s.load(t,e,this),i.parser=s;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];s.parse&&s.parse&&await(s.testParse?.(r,e,this))&&(r=await s.parse(r,e,this)||r,i.parser=s)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const r={},s=Bs(t),n=Fs(t,(t=>({src:t}))),o=n.length,a=n.map((async t=>{const s=X.toAbsolute(t.src);if(!r[t.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,t)),r[t.src]=await this.promiseCache[s].promise,e&&e(++i/o)}catch(e){throw delete this.promiseCache[s],delete r[t.src],new Error(`[Loader.load] Failed to load ${s}.\n${e}`)}}));return await Promise.all(a),s?r[n[0].src]:r}async unload(t){const e=Fs(t,(t=>({src:t}))).map((async t=>{const e=X.toAbsolute(t.src),i=this.promiseCache[e];if(i){const r=await i.promise;i.parser?.unload?.(r,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var Ls=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ls||{});function Ns(t,e){if(Array.isArray(e)){for(const i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}const Us={extension:{type:qt.LoadParser,priority:Ls.Low},name:"loadJson",test:t=>Ns(t,"application/json")||ks(t,".json"),async load(t){const e=await _.ADAPTER.fetch(t);return await e.json()}};Jt.add(Us);const Gs={name:"loadTxt",extension:{type:qt.LoadParser,priority:Ls.Low},test:t=>Ns(t,"text/plain")||ks(t,".txt"),async load(t){const e=await _.ADAPTER.fetch(t);return await e.text()}};Jt.add(Gs);const zs=["normal","bold","100","200","300","400","500","600","700","800","900"],js=[".ttf",".otf",".woff",".woff2"],Hs=["font/ttf","font/otf","font/woff","font/woff2"],Vs=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,Ws={extension:{type:qt.LoadParser,priority:Ls.Low},name:"loadWebFont",test:t=>Ns(t,Hs)||ks(t,js),async load(t,e){const i=_.ADAPTER.getFontFaceSet();if(i){const r=[],s=e.data?.family??function(t){const e=X.extname(t),i=X.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let r=i.length>0;for(const t of i)if(!t.match(Vs)){r=!1;break}let s=i.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}(t),n=e.data?.weights?.filter((t=>zs.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<n.length;e++){const a=n[e],l=new FontFace(s,`url(${encodeURI(t)})`,{...o,weight:a});await l.load(),i.add(l),r.push(l)}return 1===r.length?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>_.ADAPTER.getFontFaceSet().delete(t)))}};Jt.add(Ws);let Xs,$s=0;const Ys="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",qs="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let Zs;const Ks=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([Ys],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",(r=>{i.terminate(),URL.revokeObjectURL(e),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Xs&&(Xs=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Xs&&(Zs||(Zs=URL.createObjectURL(new Blob([qs],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Zs),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise(((i,r)=>{this.queue.push({id:t,arguments:e,resolve:i,reject:r})}));return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[$s]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:$s++,id:i})}};function Js(t,e,i){const r=new Pi(t);return r.baseTexture.on("dispose",(()=>{delete e.promiseCache[i]})),r}const Qs=[".jpeg",".jpg",".png",".webp",".avif"],tn=["image/jpeg","image/png","image/webp","image/avif"],en={name:"loadTextures",extension:{type:qt.LoadParser,priority:Ls.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Ns(t,tn)||ks(t,Qs),async load(t,e,i){let r=null;r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Ks.isImageBitmapSupported()?await Ks.loadImageBitmap(t):await async function(t){const e=await _.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const i=await e.blob();return await createImageBitmap(i)}(t):await new Promise((e=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?e(r):r.onload=()=>{e(r)}}));const s=new ce(r,{resolution:Yt(t),...e.data});return s.resource.src=t,Js(s,i,t)},unload(t){t.destroy(!0)}};Jt.add(en);const rn={extension:{type:qt.LoadParser,priority:Ls.High},name:"loadSVG",test:t=>Ns(t,"image/svg+xml")||ks(t,".svg"),testParse:async t=>$r.test(t),async parse(t,e,i){const r=new $r(t,e?.data?.resourceOptions);await r.load();const s=new ce(r,{resolution:Yt(t),...e?.data});return s.resource.src=t,Js(s,i,t)},load:async(t,e)=>(await _.ADAPTER.fetch(t)).text(),unload:en.unload};function sn(t,e,i,r,s){const n=e[i];for(let o=0;o<n.length;o++){const a=n[o];i<e.length-1?sn(t.replace(r[i],a),e,i+1,r,s):s.push(t.replace(r[i],a))}}function nn(t){const e=t.match(/\{(.*?)\}/g),i=[];if(e){const r=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");r.push(e)})),sn(t,r,0,e,i)}else i.push(t);return i}Jt.add(rn);class on{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const r=this._createBundleAssetId(t,e.name);i.push(r),this.add([e.name,r],e.srcs,e.data)}else{const r=e.name.map((e=>this._createBundleAssetId(t,e)));r.forEach((t=>{i.push(t)})),this.add([...e.name,...r],e.srcs)}})):Object.keys(e).forEach((r=>{i.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],e[r])})),this._bundles[t]=i}add(t,e,i){const r=Fs(t);r.forEach((t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)})),Array.isArray(e)||(e="string"==typeof e?nn(e):[e]);const s=e.map((t=>{let e=t;if("string"==typeof t){let i=!1;for(let r=0;r<this._parsers.length;r++){const s=this._parsers[r];if(s.test(t)){e=s.parse(t),i=!0;break}}i||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=r),(this._basePath||this._rootPath)&&(e.src=X.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??i,e}));r.forEach((t=>{this._assetMap[t]=s}))}resolveBundle(t){const e=Bs(t);t=Fs(t);const i={};return t.forEach((t=>{const e=this._bundles[t];if(e){const r=this.resolve(e),s={};for(const e in r){const i=r[e];s[this._extractAssetIdFromBundle(t,e)]=i}i[t]=s}})),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const i in e)t[i]=e[i].src;return t}return e.src}resolve(t){const e=Bs(t);t=Fs(t);const i={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const i=this._getPreferredOrder(e),r=e[0];i?.priority.forEach((t=>{i.params[t].forEach((i=>{const r=e.filter((e=>!!e[t]&&e[t]===i));r.length&&(e=r)}))})),this._resolverHash[t]=e[0]??r}else{let e=t;(this._basePath||this._rootPath)&&(e=X.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}i[t]=this._resolverHash[t]})),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],i=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){return this._defaultSearchParams?`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`:t}}const an=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new on,this.loader=new Os,this.cache=Ds,this._backgroundLoader=new Is(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,i="number"==typeof e?[e]:e;let r=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;r="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(r=await t.remove(r))}else for(const t of this._detections)await t.test()&&(r=await t.add(r));this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=Bs(t),r=Fs(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),s=this.resolver.resolve(r),n=await this._mapLoadToResolve(s,e);return i?n[r[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;"string"==typeof t&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),s={},n=Object.keys(r);let o=0,a=0;const l=()=>{e?.(++o/a)},h=n.map((t=>{const e=r[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,l).then((e=>{s[t]=e}))}));return await Promise.all(h),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Ds.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Ds.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const n={};return i.forEach(((t,e)=>{const i=s[t.src],o=[t.src];t.alias&&o.push(...t.alias),n[r[e]]=i,Ds.set(o,i)})),n}async unload(t){this._initialized||await this.init();const e=Fs(t).map((t=>"string"!=typeof t?t.src:t)),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Fs(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Ds.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return en.config.preferWorkers}set preferWorkers(t){Y("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((i=>{e.config[i]=t[i]}))}))}};Jt.handleByList(qt.LoadParser,an.loader.parsers).handleByList(qt.ResolveParser,an.resolver.parsers).handleByList(qt.CacheParser,an.cache.parsers).handleByList(qt.DetectionParser,an.detections);const ln={extension:qt.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Pi)),getCacheableAssets:(t,e)=>{const i={};return t.forEach((t=>{e.forEach(((e,r)=>{i[t+(0===r?"":r+1)]=e}))})),i}};Jt.add(ln);const hn={extension:{type:qt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await _.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};Jt.add(hn);const cn={extension:{type:qt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await _.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};Jt.add(cn);const un=["png","jpg","jpeg"],dn={extension:{type:qt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...un],remove:async t=>t.filter((t=>!un.includes(t)))};Jt.add(dn);const pn={extension:qt.ResolveParser,test:en.test,parse:t=>({resolution:parseFloat(_.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};Jt.add(pn);const fn=(t,e)=>{const i=e.split("?")[1];return i&&(t+=`?${i}`),t};var mn=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(mn||{});const gn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let yn,vn;function xn(){vn={s3tc:yn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:yn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:yn.getExtension("WEBGL_compressed_texture_etc"),etc1:yn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:yn.getExtension("WEBGL_compressed_texture_pvrtc")||yn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:yn.getExtension("WEBGL_compressed_texture_atc"),astc:yn.getExtension("WEBGL_compressed_texture_astc")}}const bn={extension:{type:qt.DetectionParser,priority:2},test:async()=>{const t=_.ADAPTER.createCanvas().getContext("webgl");return t?(yn=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{vn||xn();const e=[];for(const t in vn)vn[t]&&e.push(t);return[...e,...t]},remove:async t=>(vn||xn(),t.filter((t=>!(t in vn))))};Jt.add(bn);class _n extends ae{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,r;"string"==typeof t?(i=t,r=new Uint8Array):(i=null,r=t),super(r,e),this.origin=i,this.buffer=r?new Qt(r):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Qt(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class wn extends _n{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=wn._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||wn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:i,levelHeight:s,levelBuffer:n}=this._levelBuffers[t];r.compressedTexImage2D(r.TEXTURE_2D,e,this.format,i,s,0,n)}return!0}onBlobLoaded(){this._levelBuffers=wn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,r,s,n,o){const a=new Array(i);let l=t.byteOffset,h=n,c=o,u=h+r-1&~(r-1),d=c+s-1&~(s-1),p=u*d*gn[e];for(let n=0;n<i;n++)a[n]={levelID:n,levelWidth:i>1?h:u,levelHeight:i>1?c:d,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,h=h>>1||1,c=c>>1||1,u=h+r-1&~(r-1),d=c+s-1&~(s-1),p=u*d*gn[e];return a}}const Tn={827611204:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT},Sn={70:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},En=[171,75,84,88,32,49,49,187,13,10,26,10],An={[l.UNSIGNED_BYTE]:1,[l.UNSIGNED_SHORT]:2,[l.INT]:4,[l.UNSIGNED_INT]:4,[l.FLOAT]:4,[l.HALF_FLOAT]:8},Cn={[o.RGBA]:4,[o.RGB]:3,[o.RG]:2,[o.RED]:1,[o.LUMINANCE]:1,[o.LUMINANCE_ALPHA]:2,[o.ALPHA]:1},Pn={[l.UNSIGNED_SHORT_4_4_4_4]:2,[l.UNSIGNED_SHORT_5_5_5_1]:2,[l.UNSIGNED_SHORT_5_6_5]:2};function Rn(t){switch(t){case o.RGBA:return o.RGBA_INTEGER;case o.RGB:return o.RGB_INTEGER;case o.RG:return o.RG_INTEGER;case o.RED:return o.RED_INTEGER;default:return t}}const Mn={extension:{type:qt.LoadParser,priority:Ls.High},name:"loadDDS",test:t=>ks(t,".dds"),async load(t,e,i){const r=await _.ADAPTER.fetch(t),s=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),r=i[3],s=i[4],n=i[7],o=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const i=o[2];if(808540228!==i){const e=Tn[i],o=new Uint8Array(t,128);return[new wn(o,{format:e,width:s,height:r,levels:n})]}const a=128,l=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),h=l[0],c=l[1],u=l[2],d=l[3],p=Sn[h];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,m=148;if(1===d)f.push(new Uint8Array(t,m));else{const e=gn[p];let i=0,o=s,a=r;for(let t=0;t<n;t++)i+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let l=m;for(let e=0;e<d;e++)f.push(new Uint8Array(t,l,i)),l+=i}return f.map((t=>new wn(t,{format:p,width:s,height:r,levels:n})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await r.arrayBuffer()).map((r=>Js(new ce(r,{mipmap:d.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:Yt(t),...e.data}),i,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jt.add(Mn);const In={extension:{type:qt.LoadParser,priority:Ls.High},name:"loadKTX",test:t=>ks(t,".ktx"),async load(t,e,i){const r=await _.ADAPTER.fetch(t),s=await r.arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=function(t,e,i=!1){const r=new DataView(e);if(!function(t,e){for(let i=0;i<En.length;i++)if(e.getUint8(i)!==En[i])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,r))return null;const s=67305985===r.getUint32(12,!0),n=r.getUint32(16,s),o=r.getUint32(24,s),a=r.getUint32(28,s),h=r.getUint32(36,s),c=r.getUint32(40,s)||1,u=r.getUint32(44,s)||1,d=r.getUint32(48,s)||1,p=r.getUint32(52,s),f=r.getUint32(56,s),m=r.getUint32(60,s);if(0===c||1!==u)throw new Error("Only 2D textures are supported");if(1!==p)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw new Error("WebGL does not support array textures");const g=h+3&-4,y=c+3&-4,v=new Array(d);let x,b=h*c;if(0===n&&(b=g*y),x=0!==n?An[n]?An[n]*Cn[o]:Pn[n]:gn[a],void 0===x)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const _=i?function(t,e,i){const r=new Map;let s=0;for(;s<e;){const n=t.getUint32(64+s,i),o=64+s+4,a=3-(n+3)%4;if(0===n||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&0!==t.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=(new TextDecoder).decode(new Uint8Array(t.buffer,o,l)),c=new DataView(t.buffer,o+l+1,n-l-1);r.set(h,c),s+=4+n+a}return r}(r,m,s):null;let w=b*x,T=h,S=c,E=g,A=y,C=64+m;for(let t=0;t<f;t++){const i=r.getUint32(C,s);let o=C+4;for(let i=0;i<d;i++){let r=v[i];r||(r=v[i]=new Array(f)),r[t]={levelID:t,levelWidth:f>1||0!==n?T:E,levelHeight:f>1||0!==n?S:A,levelBuffer:new Uint8Array(e,o,w)},o+=w}C+=i+4,C=C%4!=0?C+4-C%4:C,T=T>>1||1,S=S>>1||1,E=T+4-1&-4,A=S+4-1&-4,w=E*A*x}return 0!==n?{uncompressed:v.map((t=>{let e=t[0].levelBuffer,i=!1;return n===l.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):n===l.UNSIGNED_INT?(i=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):n===l.INT&&(i=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new ae(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:n,format:i?Rn(o):o}})),kvData:_}:{compressed:v.map((t=>new wn(null,{format:a,width:h,height:c,levels:f,levelBuffers:t}))),kvData:_}}(t,s),h=n??o,c={mipmap:d.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:Yt(t),...e.data},u=h.map((e=>{h===o&&Object.assign(c,{type:e.type,format:e.format});const r=new ce(e,c);return r.ktxKeyValueData=a,Js(r,i,t)}));return 1===u.length?u[0]:u},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jt.add(In);const kn={extension:qt.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(_.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(_.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};Jt.add(kn);const Fn=new Ce,Dn=class{constructor(t){this.renderer=t}async image(t,e,i){const r=new Image;return r.src=await this.base64(t,e,i),r}async base64(t,e,i){const r=this.canvas(t);if(void 0!==r.toBlob)return new Promise(((t,s)=>{r.toBlob((e=>{if(!e)return void s(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s,i.readAsDataURL(e)}),e,i)}));if(void 0!==r.toDataURL)return r.toDataURL(e,i);if(void 0!==r.convertToBlob){const t=await r.convertToBlob({type:e,quality:i});return new Promise(((e,i)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=i,r.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);n&&Dn._flipY(i,r,s),Dn._unpremultiplyAlpha(i);const o=new Vt(r,s,1),a=new ImageData(new Uint8ClampedArray(i.buffer),r,s);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);return n&&Dn._flipY(i,r,s),Dn._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let r,s,n=!1,o=!1;if(t&&(t instanceof Ri?s=t:(s=i.generateTexture(t,{resolution:i.resolution,multisample:i.multisample}),o=!0)),s){if(r=s.baseTexture.resolution,e=e??s.frame,n=!1,!o){i.renderTexture.bind(s);const t=s.framebuffer.glFramebuffers[i.CONTEXT_UID];t.blitFramebuffer&&i.framebuffer.bind(t.blitFramebuffer)}}else r=i.resolution,e||((e=Fn).width=i.width/r,e.height=i.height/r),n=!0,i.renderTexture.bind();const a=Math.round(e.width*r),l=Math.round(e.height*r),h=new Uint8Array(4*a*l),c=i.gl;return c.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,c.RGBA,c.UNSIGNED_BYTE,h),o&&s?.destroy(!0),{pixels:h,width:a,height:l,flipY:n}}destroy(){this.renderer=null}static _flipY(t,e,i){const r=e<<2,s=i>>1,n=new Uint8Array(r);for(let e=0;e<s;e++){const s=e*r,o=(i-e-1)*r;n.set(t.subarray(s,s+r)),t.copyWithin(s,o,o+r),t.set(n,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const e=t[i+3];if(0!==e){const r=255.001/e;t[i]=t[i]*r+.5,t[i+1]=t[i+1]*r+.5,t[i+2]=t[i+2]*r+.5}}}};let Bn=Dn;Bn.extension={name:"extract",type:qt.RendererSystem},Jt.add(Bn);const On={build(t){const e=t.points;let i,r,s,n,o,a;if(t.type===Se.CIRC){const e=t.shape;i=e.x,r=e.y,o=a=e.radius,s=n=0}else if(t.type===Se.ELIP){const e=t.shape;i=e.x,r=e.y,o=e.width,a=e.height,s=n=0}else{const e=t.shape,l=e.width/2,h=e.height/2;i=e.x+l,r=e.y+h,o=a=Math.max(0,Math.min(e.radius,Math.min(l,h))),s=l-o,n=h-a}if(!(o>=0&&a>=0&&s>=0&&n>=0))return void(e.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(s?4:0)+(n?4:0);if(e.length=h,0===h)return;if(0===l)return e.length=8,e[0]=e[6]=i+s,e[1]=e[3]=r+n,e[2]=e[4]=i-s,void(e[5]=e[7]=r-n);let c=0,u=4*l+(s?2:0)+2,d=u,p=h;{const t=s+o,a=n,l=i+t,h=i-t,f=r+a;if(e[c++]=l,e[c++]=f,e[--u]=f,e[--u]=h,n){const t=r-a;e[d++]=h,e[d++]=t,e[--p]=t,e[--p]=l}}for(let t=1;t<l;t++){const h=Math.PI/2*(t/l),f=s+Math.cos(h)*o,m=n+Math.sin(h)*a,g=i+f,y=i-f,v=r+m,x=r-m;e[c++]=g,e[c++]=v,e[--u]=v,e[--u]=y,e[d++]=y,e[d++]=x,e[--p]=x,e[--p]=g}{const t=n+a,o=i+s,l=i-s,h=r+t,u=r-t;e[c++]=o,e[c++]=h,e[--p]=u,e[--p]=o,s&&(e[c++]=l,e[c++]=h,e[--p]=u,e[--p]=l)}},triangulate(t,e){const i=t.points,r=e.points,s=e.indices;if(0===i.length)return;let n=r.length/2;const o=n;let a,l;if(t.type!==Se.RREC){const e=t.shape;a=e.x,l=e.y}else{const e=t.shape;a=e.x+e.width/2,l=e.y+e.height/2}const h=t.matrix;r.push(t.matrix?h.a*a+h.c*l+h.tx:a,t.matrix?h.b*a+h.d*l+h.ty:l),n++,r.push(i[0],i[1]);for(let t=2;t<i.length;t+=2)r.push(i[t],i[t+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function Ln(t,e=!1){const i=t.length;if(i<6)return;let r=0;for(let e=0,s=t[i-2],n=t[i-1];e<i;e+=2){const i=t[e],o=t[e+1];r+=(i-s)*(o+n),s=i,n=o}if(!e&&r>0||e&&r<=0){const e=i/2;for(let r=e+e%2;r<i;r+=2){const e=i-r-2,s=i-r-1,n=r,o=r+1;[t[e],t[n]]=[t[n],t[e]],[t[s],t[o]]=[t[o],t[s]]}}}const Nn={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points;const r=t.holes,s=e.points,n=e.indices;if(i.length>=6){Ln(i,!1);const t=[];for(let e=0;e<r.length;e++){const s=r[e];Ln(s.points,!0),t.push(i.length/2),i=i.concat(s.points)}const e=z(i,t,2);if(!e)return;const o=s.length/2;for(let t=0;t<e.length;t+=3)n.push(e[t]+o),n.push(e[t+1]+o),n.push(e[t+2]+o);for(let t=0;t<i.length;t++)s.push(i[t])}}},Un={build(t){const e=t.shape,i=e.x,r=e.y,s=e.width,n=e.height,o=t.points;o.length=0,s>=0&&n>=0&&o.push(i,r,i+s,r,i+s,r+n,i,r+n)},triangulate(t,e){const i=t.points,r=e.points;if(0===i.length)return;const s=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Gn={build(t){On.build(t)},triangulate(t,e){On.triangulate(t,e)}};var zn=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(zn||{}),jn=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(jn||{});const Hn={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class Vn{static curveTo(t,e,i,r,s,n){const o=n[n.length-2],a=n[n.length-1]-e,l=o-t,h=r-e,c=i-t,u=Math.abs(a*c-l*h);if(u<1e-8||0===s)return n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e),null;const d=a*a+l*l,p=h*h+c*c,f=a*h+l*c,m=s*Math.sqrt(d)/u,g=s*Math.sqrt(p)/u,y=m*f/d,v=g*f/p,x=m*c+g*l,b=m*h+g*a,_=l*(g+y),w=a*(g+y),T=c*(m+v),S=h*(m+v);return{cx:x+t,cy:b+e,radius:s,startAngle:Math.atan2(w-b,_-x),endAngle:Math.atan2(S-b,T-x),anticlockwise:l*h>c*a}}static arc(t,e,i,r,s,n,o,a,l){const h=o-n,c=Hn._segmentsCount(Math.abs(h)*s,40*Math.ceil(Math.abs(h)/_e)),u=h/(2*c),d=2*u,p=Math.cos(u),f=Math.sin(u),m=c-1,g=m%1/m;for(let t=0;t<=m;++t){const e=u+n+d*(t+g*t),o=Math.cos(e),a=-Math.sin(e);l.push((p*o+f*a)*s+i,(p*-a+f*o)*s+r)}}}class Wn{static curveLength(t,e,i,r,s,n,o,a){let l=0,h=0,c=0,u=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0,x=t,b=e;for(let _=1;_<=10;++_)h=_/10,c=h*h,u=c*h,d=1-h,p=d*d,f=p*d,m=f*t+3*p*h*i+3*d*c*s+u*o,g=f*e+3*p*h*r+3*d*c*n+u*a,y=x-m,v=b-g,x=m,b=g,l+=Math.sqrt(y*y+v*v);return l}static curveTo(t,e,i,r,s,n,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const h=Hn._segmentsCount(Wn.curveLength(a,l,t,e,i,r,s,n));let c=0,u=0,d=0,p=0,f=0;o.push(a,l);for(let m=1,g=0;m<=h;++m)g=m/h,c=1-g,u=c*c,d=u*c,p=g*g,f=p*g,o.push(d*a+3*u*g*t+3*c*p*i+f*s,d*l+3*u*g*e+3*c*p*r+f*n)}}function Xn(t,e,i,r,s,n,o,a){let l,h;o?(l=r,h=-i):(l=-r,h=i);const c=t-i*s+l,u=e-r*s+h,d=t+i*n+l,p=e+r*n+h;return a.push(c,u,d,p),2}function $n(t,e,i,r,s,n,o,a){const l=i-t,h=r-e;let c=Math.atan2(l,h),u=Math.atan2(s-t,n-e);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(l*l+h*h),g=1+(15*f*Math.sqrt(m)/Math.PI>>0),y=p/g;if(d+=y,a){o.push(t,e,i,r);for(let i=1,r=d;i<g;i++,r+=y)o.push(t,e,t+Math.sin(r)*m,e+Math.cos(r)*m);o.push(t,e,s,n)}else{o.push(i,r,t,e);for(let i=1,r=d;i<g;i++,r+=y)o.push(t+Math.sin(r)*m,e+Math.cos(r)*m,t,e);o.push(s,n,t,e)}return 2*g}function Yn(t,e){t.lineStyle.native?function(t,e){let i=0;const r=t.shape,s=t.points||r.points,n=r.type!==Se.POLY||r.closeStroke;if(0===s.length)return;const o=e.points,a=e.indices,l=s.length/2,h=o.length/2;let c=h;for(o.push(s[0],s[1]),i=1;i<l;i++)o.push(s[2*i],s[2*i+1]),a.push(c,c+1),c++;n&&a.push(c,h)}(t,e):function(t,e){const i=t.shape;let r=t.points||i.points.slice();const s=e.closePointEps;if(0===r.length)return;const n=t.lineStyle,o=new Ee(r[0],r[1]),a=new Ee(r[r.length-2],r[r.length-1]),l=i.type!==Se.POLY||i.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),h&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);r.unshift(t,e),r.push(t,e)}const c=e.points,u=r.length/2;let d=r.length;const p=c.length/2,f=n.width/2,m=f*f,g=n.miterLimit*n.miterLimit;let y=r[0],v=r[1],x=r[2],b=r[3],_=0,w=0,T=-(v-b),S=y-x,E=0,A=0,C=Math.sqrt(T*T+S*S);T/=C,S/=C,T*=f,S*=f;const P=n.alignment,R=2*(1-P),M=2*P;l||(n.cap===jn.ROUND?d+=$n(y-T*(R-M)*.5,v-S*(R-M)*.5,y-T*R,v-S*R,y+T*M,v+S*M,c,!0)+2:n.cap===jn.SQUARE&&(d+=Xn(y,v,T,S,R,M,!0,c))),c.push(y-T*R,v-S*R,y+T*M,v+S*M);for(let t=1;t<u-1;++t){y=r[2*(t-1)],v=r[2*(t-1)+1],x=r[2*t],b=r[2*t+1],_=r[2*(t+1)],w=r[2*(t+1)+1],T=-(v-b),S=y-x,C=Math.sqrt(T*T+S*S),T/=C,S/=C,T*=f,S*=f,E=-(b-w),A=x-_,C=Math.sqrt(E*E+A*A),E/=C,A/=C,E*=f,A*=f;const e=x-y,i=v-b,s=x-_,o=w-b,a=e*s+i*o,l=i*s-o*e,h=l<0;if(Math.abs(l)<.001*Math.abs(a)){c.push(x-T*R,b-S*R,x+T*M,b+S*M),a>=0&&(n.join===zn.ROUND?d+=$n(x,b,x-T*R,b-S*R,x-E*R,b-A*R,c,!1)+4:d+=2,c.push(x-E*M,b-A*M,x+E*R,b+A*R));continue}const u=(-T+y)*(-S+b)-(-T+x)*(-S+v),p=(-E+_)*(-A+b)-(-E+x)*(-A+w),P=(e*p-s*u)/l,I=(o*u-i*p)/l,k=(P-x)*(P-x)+(I-b)*(I-b),F=x+(P-x)*R,D=b+(I-b)*R,B=x-(P-x)*M,O=b-(I-b)*M,L=h?R:M,N=k<=Math.min(e*e+i*i,s*s+o*o)+L*L*m;let U=n.join;if(U===zn.MITER&&k/m>g&&(U=zn.BEVEL),N)switch(U){case zn.MITER:c.push(F,D,B,O);break;case zn.BEVEL:h?c.push(F,D,x+T*M,b+S*M,F,D,x+E*M,b+A*M):c.push(x-T*R,b-S*R,B,O,x-E*R,b-A*R,B,O),d+=2;break;case zn.ROUND:h?(c.push(F,D,x+T*M,b+S*M),d+=$n(x,b,x+T*M,b+S*M,x+E*M,b+A*M,c,!0)+4,c.push(F,D,x+E*M,b+A*M)):(c.push(x-T*R,b-S*R,B,O),d+=$n(x,b,x-T*R,b-S*R,x-E*R,b-A*R,c,!1)+4,c.push(x-E*R,b-A*R,B,O))}else{switch(c.push(x-T*R,b-S*R,x+T*M,b+S*M),U){case zn.MITER:h?c.push(B,O,B,O):c.push(F,D,F,D),d+=2;break;case zn.ROUND:d+=h?$n(x,b,x+T*M,b+S*M,x+E*M,b+A*M,c,!0)+2:$n(x,b,x-T*R,b-S*R,x-E*R,b-A*R,c,!1)+2}c.push(x-E*R,b-A*R,x+E*M,b+A*M),d+=2}}y=r[2*(u-2)],v=r[2*(u-2)+1],x=r[2*(u-1)],b=r[2*(u-1)+1],T=-(v-b),S=y-x,C=Math.sqrt(T*T+S*S),T/=C,S/=C,T*=f,S*=f,c.push(x-T*R,b-S*R,x+T*M,b+S*M),l||(n.cap===jn.ROUND?d+=$n(x-T*(R-M)*.5,b-S*(R-M)*.5,x-T*R,b-S*R,x+T*M,b+S*M,c,!1)+2:n.cap===jn.SQUARE&&(d+=Xn(x,b,T,S,R,M,!1,c)));const I=e.indices,k=Hn.epsilon*Hn.epsilon;for(let t=p;t<d+p-2;++t)y=c[2*t],v=c[2*t+1],x=c[2*(t+1)],b=c[2*(t+1)+1],_=c[2*(t+2)],w=c[2*(t+2)+1],Math.abs(y*(b-w)+x*(w-v)+_*(v-b))<k||I.push(t,t+1,t+2)}(t,e)}class qn{static curveLength(t,e,i,r,s,n){const o=t-2*i+s,a=e-2*r+n,l=2*i-2*t,h=2*r-2*e,c=4*(o*o+a*a),u=4*(o*l+a*h),d=l*l+h*h,p=2*Math.sqrt(c+u+d),f=Math.sqrt(c),m=2*c*f,g=2*Math.sqrt(d),y=u/f;return(m*p+f*u*(p-g)+(4*d*c-u*u)*Math.log((2*f+y+p)/(y+g)))/(4*m)}static curveTo(t,e,i,r,s){const n=s[s.length-2],o=s[s.length-1],a=Hn._segmentsCount(qn.curveLength(n,o,t,e,i,r));let l=0,h=0;for(let c=1;c<=a;++c){const u=c/a;l=n+(t-n)*u,h=o+(e-o)*u,s.push(l+(t+(i-t)*u-l)*u,h+(e+(r-e)*u-h)*u)}}}const Zn={[Se.POLY]:Nn,[Se.CIRC]:On,[Se.ELIP]:On,[Se.RECT]:Un,[Se.RREC]:Gn},Kn=[],Jn=[];class Qn{constructor(t,e=null,i=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new Qn(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class to{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const eo=new Ee,io=class extends be{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Zr,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jn.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Kn.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,r=null){const s=new Qn(t,e,i,r);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Qn(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const r=e[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,eo):eo.copyFrom(t),r.shape.contains(eo.x,eo.y))){let t=!1;if(r.holes)for(let e=0;e<r.holes.length;e++)if(r.holes[e].shape.contains(eo.x,eo.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let s=this.shapeIndex;s<e.length;s++){this.shapeIndex++;const n=e[s],o=n.fillStyle,a=n.lineStyle;Zn[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(o.visible||a.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const s=0===e?o:a;if(!s.visible)continue;const l=s.texture.baseTexture,h=this.indices.length,c=this.points.length/2;l.wrapMode=u.REPEAT,0===e?this.processFill(n):this.processLine(n);const d=this.points.length/2-c;0!==d&&(i&&!this._compareStyles(r,s)&&(i.end(h,c),i=null),i||(i=Kn.pop()||new to,i.begin(s,h,c),this.batches.push(i),r=s),this.addUvs(this.points,t,s.texture,c,d,s.matrix))}}const s=this.indices.length,n=this.points.length/2;if(i&&i.end(s,n),0===this.batches.length)return void(this.batchable=!0);const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,r=e.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*io.BATCHABLE_SIZE}buildDrawCalls(){let t=++ce._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jn.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let r=Jn.pop();r||(r=new ue,r.texArray=new ci),r.texArray.count=0,r.start=0,r.size=0,r.type=n.TRIANGLES;let s=0,o=null,a=0,l=!1,h=n.TRIANGLES,c=0;this.drawCalls.push(r);for(let d=0;d<this.batches.length;d++){const p=this.batches[d],f=8,m=p.style,g=m.texture.baseTexture;l!==!!m.native&&(l=!!m.native,h=l?n.LINES:n.TRIANGLES,o=null,s=f,t++),o!==g&&(o=g,g._batchEnabled!==t&&(s===f&&(t++,s=0,r.size>0&&(r=Jn.pop(),r||(r=new ue,r.texArray=new ci),this.drawCalls.push(r)),r.start=c,r.size=0,r.texArray.count=0,r.type=h),g.touched=1,g._batchEnabled=t,g._batchLocation=s,g.wrapMode=u.REPEAT,r.texArray.elements[r.texArray.count++]=g,s++)),r.size+=p.size,c+=p.size,a=g._batchLocation,this.addColors(e,m.color,m.alpha,p.attribSize,p.attribStart),this.addTextureIds(i,a,p.attribSize,p.attribStart)}ce._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,s=new ArrayBuffer(3*t.length*4),n=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let s=0;s<t.length/2;s++)n[a++]=t[2*s],n[a++]=t[2*s+1],n[a++]=e[2*s],n[a++]=e[2*s+1],o[a++]=i[s],n[a++]=r[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Nn.triangulate(t,this):Zn[t.type].triangulate(t,this)}processLine(t){Yn(t,this);for(let e=0;e<t.holes.length;e++)Yn(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];Zn[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const r=t[2*i],s=t[2*i+1];t[2*i]=e.a*r+e.c*s+e.tx,t[2*i+1]=e.b*r+e.d*s+e.ty}}addColors(t,e,i,r,s=0){const n=Et.shared.setValue(e).toLittleEndianNumber(),o=Et.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,s+r);for(let e=0;e<r;e++)t[s+e]=o}addTextureIds(t,e,i,r=0){t.length=Math.max(t.length,r+i);for(let s=0;s<i;s++)t[r+s]=e}addUvs(t,e,i,r,s,n=null){let o=0;const a=e.length,l=i.frame;for(;o<s;){let i=t[2*(r+o)],s=t[2*(r+o)+1];if(n){const t=n.a*i+n.c*s+n.tx;s=n.b*i+n.d*s+n.ty,i=t}o++,e.push(i/l.width,s/l.height)}const h=i.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(e,i,a,s)}adjustUvs(t,e,i,r){const s=e.baseTexture,n=1e-6,o=i+2*r,a=e.frame,l=a.width/s.width,h=a.height/s.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(t[i]+n),p=Math.floor(t[i+1]+n);for(let e=i+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+n)),p=Math.min(p,Math.floor(t[e+1]+n));c-=d,u-=p;for(let e=i;e<o;e+=2)t[e]=(t[e]+c)*l,t[e+1]=(t[e+1]+u)*h}};let ro=io;ro.BATCHABLE_SIZE=100;class so{constructor(){this.color=16777215,this.alpha=1,this.texture=Pi.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new so;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Pi.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class no extends so{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=jn.BUTT,this.join=zn.MITER,this.miterLimit=10}clone(){const t=new no;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const oo={},ao=class extends is{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new so,this._lineStyle=new no,this._matrix=null,this._holeMode=!1,this.state=ie.for2d(),this._geometry=t||new ro,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Et(16777215),this.blendMode=s.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ao(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,r=.5,s=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:r,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Pi.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:jn.BUTT,join:zn.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Me,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Me,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,r=i[i.length-2],s=i[i.length-1];return r===t&&s===e||i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,r){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),qn.curveTo(t,e,i,r,s),this}bezierCurveTo(t,e,i,r,s,n){return this._initCurve(),Wn.curveTo(t,e,i,r,s,n,this.currentPath.points),this}arcTo(t,e,i,r,s){this._initCurve(t,e);const n=this.currentPath.points,o=Vn.curveTo(t,e,i,r,s,n);if(o){const{cx:t,cy:e,radius:i,startAngle:r,endAngle:s,anticlockwise:n}=o;this.arc(t,e,i,r,s,n)}return this}arc(t,e,i,r,s,n=!1){if(r===s)return this;if(!n&&s<=r?s+=_e:n&&r<=s&&(r+=_e),0==s-r)return this;const o=t+Math.cos(r)*i,a=e+Math.sin(r)*i,l=this._geometry.closePointEps;let h=this.currentPath?this.currentPath.points:null;if(h){const t=Math.abs(h[h.length-2]-o),e=Math.abs(h[h.length-1]-a);t<l&&e<l||h.push(o,a)}else this.moveTo(o,a),h=this.currentPath.points;return Vn.arc(o,a,t,e,i,r,s,n,h),this}beginFill(t=0,e){return this.beginTextureFill({texture:Pi.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Et.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Pi.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,r){return this.drawShape(new Ce(t,e,i,r))}drawRoundedRect(t,e,i,r,s){return this.drawShape(new Ie(t,e,i,r,s))}drawCircle(t,e,i){return this.drawShape(new Pe(t,e,i))}drawEllipse(t,e,i,r){return this.drawShape(new Re(t,e,i,r))}drawPolygon(...t){let e,i=!0;const r=t[0];r.points?(i=r.closeStroke,e=r.points):e=Array.isArray(t[0])?t[0]:t;const s=new Me(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Se.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let r=0;r<i;r++){const i=t.batches[r],s=i.style.color,n=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),a={vertexData:n,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:Et.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[r]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,r=this.worldAlpha,s=e.uniforms,n=i.drawCalls;s.translationMatrix=this.transform.worldTransform,Et.shared.setValue(this._tintColor).premultiply(r).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let e=0,r=n.length;e<r;e++)this._renderDrawCallDirect(t,i.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:i,type:r,size:s,start:n}=e,o=i.count;for(let e=0;e<o;e++)t.texture.bind(i.elements[e],e);t.geometry.draw(r,s,n)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!oo[i]){const{maxTextures:e}=t.plugins[i],r=new Int32Array(e);for(let t=0;t<e;t++)r[t]=t;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new ke,default:ai.from({uSamplers:r},!0)},n=t.plugins[i]._shader.program;oo[i]=new li(n,s)}e=oo[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:r,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,r,s)}containsPoint(t){return this.worldTransform.applyInverse(t,ao._TEMP_POINT),this._geometry.containsPoint(ao._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Et.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let t=0;t<l.length;t+=2){const e=l[t],u=l[t+1];h[c++]=i*e+s*u+o,h[c++]=n*u+r*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let lo=ao;lo.curves=Hn,lo._TEMP_POINT=new Ee;class ho{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const co=new Ee,uo=new Me,po=class extends is{constructor(t,e,i,r=n.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||ie.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=_.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===n.TRIANGLES&&e.length<2*po.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,s=r.a,n=r.b,o=r.c,a=r.d,l=r.tx,h=r.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const i=e[2*t],r=e[2*t+1];c[2*t]=s*i+o*r+l,c[2*t+1]=n*i+a*r+h}if(this._roundPixels){const t=_.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ho(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,co);const e=this.geometry.getBuffer("aVertexPosition").data,i=uo.points,r=this.geometry.getIndex().data,s=r.length,n=4===this.drawMode?3:1;for(let t=0;t+2<s;t+=n){const s=2*r[t],n=2*r[t+1],o=2*r[t+2];if(i[0]=e[s],i[1]=e[s+1],i[2]=e[n],i[3]=e[n+1],i[4]=e[o],i[5]=e[o+1],uo.contains(co.x,co.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let fo=po;fo.BATCHABLE_SIZE=100;class mo extends xe{constructor(t,e,i){super();const r=new pe(t),s=new pe(e,!0),n=new pe(i,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,l.FLOAT).addAttribute("aTextureCoord",s,2,!1,l.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class go extends li{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:ke.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||ni.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new Hi(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Et(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Et.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class yo{constructor(t,e,i){this.geometry=new xe,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let r=t[i];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||l.FLOAT,offset:r.offset},e[i]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new pe(function(t,e=null){const i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let t=0,r=0;t<i;t+=6,r+=4)e[t+0]=r+0,e[t+1]=r+1,e[t+2]=r+2,e[t+3]=r+0,e[t+4]=r+2,e[t+5]=r+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];i.offset=e,e+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new pe(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=r,r+=e.size,this.staticStride+=e.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new pe(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];t.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===l.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let e=0;e<this.staticProperties.length;++e){const i=this.staticProperties[e];t.addAttribute(i.attributeName,this.staticBuffer,0,i.type===l.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(t,e,i){for(let r=0;r<this.dynamicProperties.length;r++){const s=this.dynamicProperties[r];s.uploadFunction(t,e,i,s.type===l.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let r=0;r<this.staticProperties.length;r++){const s=this.staticProperties[r];s.uploadFunction(t,e,i,s.type===l.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class vo extends ui{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ke,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:l.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=li.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ie.for2d()}render(t){const e=t.children,i=t._maxSize,r=t._batchSize,s=this.renderer;let n=e.length;if(0===n)return;n>i&&!t.autoResize&&(n=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,l=a.alphaMode>0;this.state.blendMode=Rt(t.blendMode,l),s.state.set(this.state);const h=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Et.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let u=!1;for(let i=0,a=0;i<n;i+=r,a+=1){let l=n-i;l>r&&(l=r),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const c=o[a];c.uploadDynamic(e,i,l);const d=t._bufferUpdateIDs[a]||0;u=u||c._updateID<d,u&&(c._updateID=t._updateID,c.uploadStatic(e,i,l)),s.geometry.bind(c.geometry),h.drawElements(h.TRIANGLES,6*l,h.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,r=t._batchSize,s=t._properties;for(let t=0;t<i;t+=r)e.push(new yo(this.properties,s,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new yo(this.properties,i,e)}uploadVertices(t,e,i,r,s,n){let o=0,a=0,l=0,h=0;for(let c=0;c<i;++c){const i=t[e+c],u=i._texture,d=i.scale.x,p=i.scale.y,f=u.trim,m=u.orig;f?(a=f.x-i.anchor.x*m.width,o=a+f.width,h=f.y-i.anchor.y*m.height,l=h+f.height):(o=m.width*(1-i.anchor.x),a=m.width*-i.anchor.x,l=m.height*(1-i.anchor.y),h=m.height*-i.anchor.y),r[n]=a*d,r[n+1]=h*p,r[n+s]=o*d,r[n+s+1]=h*p,r[n+2*s]=o*d,r[n+2*s+1]=l*p,r[n+3*s]=a*d,r[n+3*s+1]=l*p,n+=4*s}}uploadPosition(t,e,i,r,s,n){for(let o=0;o<i;o++){const i=t[e+o].position;r[n]=i.x,r[n+1]=i.y,r[n+s]=i.x,r[n+s+1]=i.y,r[n+2*s]=i.x,r[n+2*s+1]=i.y,r[n+3*s]=i.x,r[n+3*s+1]=i.y,n+=4*s}}uploadRotation(t,e,i,r,s,n){for(let o=0;o<i;o++){const i=t[e+o].rotation;r[n]=i,r[n+s]=i,r[n+2*s]=i,r[n+3*s]=i,n+=4*s}}uploadUvs(t,e,i,r,s,n){for(let o=0;o<i;++o){const i=t[e+o]._texture._uvs;i?(r[n]=i.x0,r[n+1]=i.y0,r[n+s]=i.x1,r[n+s+1]=i.y1,r[n+2*s]=i.x2,r[n+2*s+1]=i.y2,r[n+3*s]=i.x3,r[n+3*s+1]=i.y3,n+=4*s):(r[n]=0,r[n+1]=0,r[n+s]=0,r[n+s+1]=0,r[n+2*s]=0,r[n+2*s+1]=0,r[n+3*s]=0,r[n+3*s+1]=0,n+=4*s)}}uploadTint(t,e,i,r,s,n){for(let o=0;o<i;++o){const i=t[e+o],a=Et.shared.setValue(i._tintRGB).toPremultiplied(i.alpha,i.texture.baseTexture.alphaMode>0);r[n]=a,r[n+s]=a,r[n+2*s]=a,r[n+3*s]=a,n+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}vo.extension={name:"particle",type:qt.RendererPlugin},Jt.add(vo);var xo=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(xo||{});const bo={willReadFrequently:!0},_o=class{static get experimentalLetterSpacingSupported(){let t=_o._experimentalLetterSpacingSupported;if(void 0!==t){const e=_.ADAPTER.getCanvasRenderingContext2D().prototype;t=_o._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,s,n,o,a,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,i,r=_o._canvas){i=null==i?e.wordWrap:i;const s=e.toFontString(),n=_o.measureFont(s);0===n.fontSize&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);const o=r.getContext("2d",bo);o.font=s;const a=(i?_o.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),l=new Array(a.length);let h=0;for(let t=0;t<a.length;t++){const i=_o._measureText(a[t],e.letterSpacing,o);l[t]=i,h=Math.max(h,i)}let c=h+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||n.fontSize+e.strokeThickness;let d=Math.max(u,n.fontSize+2*e.strokeThickness)+(a.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new _o(t,e,c,d,a,l,u+e.leading,h,n)}static _measureText(t,e,i){let r=!1;_o.experimentalLetterSpacingSupported&&(_o.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(r?s-=e:s+=(_o.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=_o._canvas){const r=i.getContext("2d",bo);let s=0,n="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:h}=e,c=_o.collapseSpaces(h),u=_o.collapseNewlines(h);let d=!c;const p=e.wordWrapWidth+l,f=_o.tokenize(t);for(let t=0;t<f.length;t++){let i=f[t];if(_o.isNewline(i)){if(!u){o+=_o.addLine(n),d=!c,n="",s=0;continue}i=" "}if(c){const t=_o.isBreakingSpace(i),e=_o.isBreakingSpace(n[n.length-1]);if(t&&e)continue}const h=_o.getFromCache(i,l,a,r);if(h>p)if(""!==n&&(o+=_o.addLine(n),n="",s=0),_o.canBreakWords(i,e.breakWords)){const t=_o.wordWrapSplit(i);for(let h=0;h<t.length;h++){let c=t[h],u=c,f=1;for(;t[h+f];){const r=t[h+f];if(_o.canBreakChars(u,r,i,h,e.breakWords))break;c+=r,u=r,f++}h+=f-1;const m=_o.getFromCache(c,l,a,r);m+s>p&&(o+=_o.addLine(n),d=!1,n="",s=0),n+=c,s+=m}}else{n.length>0&&(o+=_o.addLine(n),n="",s=0);const e=t===f.length-1;o+=_o.addLine(i,!e),d=!1,n="",s=0}else h+s>p&&(d=!1,o+=_o.addLine(n),n="",s=0),(n.length>0||!_o.isBreakingSpace(i)||d)&&(n+=i,s+=h)}return o+=_o.addLine(n,!1),o}static addLine(t,e=!0){return t=_o.trimRight(t),e?`${t}\n`:t}static getFromCache(t,e,i,r){let s=i[t];return"number"!=typeof s&&(s=_o._measureText(t,e,r)+e,i[t]=s),s}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!_o.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&_o._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&_o._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if("string"!=typeof t)return e;for(let r=0;r<t.length;r++){const s=t[r],n=t[r+1];_o.isBreakingSpace(s,n)||_o.isNewline(s)?(""!==i&&(e.push(i),i=""),e.push(s)):i+=s}return""!==i&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,s){return!0}static wordWrapSplit(t){return _o.graphemeSegmenter(t)}static measureFont(t){if(_o._fonts[t])return _o._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=_o._canvas,r=_o._context;r.font=t;const s=_o.METRICS_STRING+_o.BASELINE_SYMBOL,n=Math.ceil(r.measureText(s).width);let o=Math.ceil(r.measureText(_o.BASELINE_SYMBOL).width);const a=Math.ceil(_o.HEIGHT_MULTIPLIER*o);if(o=o*_o.BASELINE_MULTIPLIER|0,0===n||0===a)return _o._fonts[t]=e,e;i.width=n,i.height=a,r.fillStyle="#f00",r.fillRect(0,0,n,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(s,0,o);const l=r.getImageData(0,0,n,a).data,h=l.length,c=4*n;let u=0,d=0,p=!1;for(u=0;u<o;++u){for(let t=0;t<c;t+=4)if(255!==l[d+t]){p=!0;break}if(p)break;d+=c}for(e.ascent=o-u,d=h-c,p=!1,u=a;u>o;--u){for(let t=0;t<c;t+=4)if(255!==l[d+t]){p=!0;break}if(p)break;d-=c}return e.descent=u-o,e.fontSize=e.ascent+e.descent,_o._fonts[t]=e,e}static clearMetrics(t=""){t?delete _o._fonts[t]:_o._fonts={}}static get _canvas(){if(!_o.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",bo);if(i?.measureText)return _o.__canvas=e,e;t=_.ADAPTER.createCanvas()}catch(e){t=_.ADAPTER.createCanvas()}t.width=t.height=10,_o.__canvas=t}return _o.__canvas}static get _context(){return _o.__context||(_o.__context=_o._canvas.getContext("2d",bo)),_o.__context}};let wo=_o;wo.METRICS_STRING="|q",wo.BASELINE_SYMBOL="M",wo.BASELINE_MULTIPLIER=1.4,wo.HEIGHT_MULTIPLIER=2,wo.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),wo.experimentalLetterSpacing=!1,wo._fonts={},wo._newlines=[10,13],wo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const To=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],So=class{constructor(t){this.styleID=0,this.reset(),Co(this,t,t)}clone(){const t={};return Co(t,this,So.defaultStyle),new So(t)}reset(){Co(this,So.defaultStyle,So.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Ao(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Ao(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Ao(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();/([\"\'])[^\'\"]+\1/.test(i)||To.includes(i)||(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Eo=So;function Ao(t){const e=Et.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Co(t,e,i){for(const r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}Eo.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:xo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Po={texture:!0,children:!1,baseTexture:!0},Ro=class extends ns{constructor(t,e,i){let r=!1;i||(i=_.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;const s=Pi.from(i);s.orig=new Ce,s.trim=new Ce,super(s),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Ro.defaultResolution??_.RESOLUTION,this._autoResolution=Ro.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return wo.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Y("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),wo.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,r=wo.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,h=r.maxLineWidth,c=r.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let t=0;t<p;++t){const s=e.dropShadow&&0===t,p=s?Math.ceil(Math.max(1,n)+2*e.padding):0,f=p*this._resolution;if(s){i.fillStyle="black",i.strokeStyle="black";const t=e.dropShadowColor,r=e.dropShadowBlur*this._resolution,s=e.dropShadowDistance*this._resolution;i.shadowColor=Et.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=r,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*s,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*s+f}else i.fillStyle=this._generateFillStyle(e,o,r),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let m=(a-c.fontSize)/2;a-c.fontSize<0&&(m=0);for(let t=0;t<o.length;t++)u=e.strokeThickness/2,d=e.strokeThickness/2+t*a+c.ascent+m,"right"===e.align?u+=h-l[t]:"center"===e.align&&(u+=(h-l[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-p,!0),e.fill&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-p)}this.updateTexture()}drawLetterSpacing(t,e,i,r=!1){const s=this._style.letterSpacing;let n=!1;if(wo.experimentalLetterSpacingSupported&&(wo.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||n)return void(r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));let o=e;const a=wo.graphemeSegmenter(t);let l=this.context.measureText(t).width,h=0;for(let t=0;t<a.length;++t){const e=a[t];r?this.context.strokeText(e,o,i):this.context.fillText(e,o,i);let n="";for(let e=t+1;e<a.length;++e)n+=a[e];h=this.context.measureText(n).width,o+=l-h+s,l=h}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=function(t){const e=function(t){const{width:e,height:i}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const s=r.getImageData(0,0,e,i).data;let n=0,o=0,a=e-1,l=i-1;for(;o<i&&Wt(s,e,o);)++o;if(o===i)return Ut.EMPTY;for(;Wt(s,e,l);)--l;for(;Xt(s,e,n,o,l);)++n;for(;Xt(s,e,a,o,l);)--a;return++a,++l,new Ut(n,o,a,l)}(t),{width:i,height:r}=e;let s=null;if(!e.isEmpty()){const n=t.getContext("2d");if(null===n)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,i,r)}return{width:i,height:r,data:s}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,i=this._style,r=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let s;const n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-n-2*o,l=this.canvas.height/this._resolution-n-2*o,h=r.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=h.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(h.unshift(r[0]),c.unshift(0),h.push(r[r.length-1]),c.push(1),t.fillGradientType===xo.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);const r=i.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const n=i.lineHeight*(t-1)+r,o=i.lineHeight*t;let a=o;t>0&&n>o&&(a=(o+n)/2);const u=o+r,d=i.lineHeight*(t+1);let p=u;t+1<e.length&&d<u&&(p=(u+d)/2);const f=(p-a)/l;for(let t=0;t<h.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/h.length;let i=Math.min(1,Math.max(0,a/l+e*f));i=Number(i.toFixed(5)),s.addColorStop(i,h[t])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);const t=h.length+1;let e=1;for(let i=0;i<h.length;i++){let r;r="number"==typeof c[i]?c[i]:e/t,s.addColorStop(r,h[i]),e++}}return s}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Po,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Bt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Bt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Eo?t:new Eo(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Mo=Ro;Mo.defaultAutoResolution=!0;class Io{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function ko(t,e){let i=!1;if(t?._textures?.length)for(let r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Pi){const s=t._textures[r].baseTexture;e.includes(s)||(e.push(s),i=!0)}return i}function Fo(t,e){if(t.baseTexture instanceof ce){const i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Do(t,e){if(t._texture&&t._texture instanceof Pi){const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Bo(t,e){return e instanceof Mo&&(e.updateText(!0),!0)}function Oo(t,e){if(e instanceof Eo){const t=e.toFontString();return wo.measureFont(t),!0}return!1}function Lo(t,e){if(t instanceof Mo){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function No(t,e){return t instanceof Eo&&(e.includes(t)||e.push(t),!0)}const Uo=class{constructor(t){this.limiter=new Io(Uo.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Lo),this.registerFindHook(No),this.registerFindHook(ko),this.registerFindHook(Fo),this.registerFindHook(Do),this.registerUploadHook(Bo),this.registerUploadHook(Oo)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Ir.system.addOnce(this.tick,this,Pr.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Ir.system.addOnce(this.tick,this,Pr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof is)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Ir.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Go=Uo;function zo(t,e){return e instanceof ce&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function jo(t,e){if(!(e instanceof lo))return!1;const{geometry:i}=e;e.finishPoly(),i.updateBatches();const{batches:r}=i;for(let e=0;e<r.length;e++){const{texture:i}=r[e].style;i&&zo(t,i.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function Ho(t,e){return t instanceof lo&&(e.push(t),!0)}Go.uploadsPerFrame=4,Object.defineProperties(_,{UPLOADS_PER_FRAME:{get:()=>Go.uploadsPerFrame,set(t){Y("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Go.uploadsPerFrame=t}}});class Vo extends Go{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Ho),this.registerUploadHook(zo),this.registerUploadHook(jo)}}Vo.extension={name:"prepare",type:qt.RendererSystem},Jt.add(Vo),new Ee;var Wo="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Xo=new ke;class $o extends ui{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new ki,this.state=ie.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=li.from(Wo,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?li.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):li.from(Wo,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let r=i.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;r=i.uvs,r[0]=r[6]=-s,r[1]=r[3]=-n,r[2]=r[4]=1-s,r[5]=r[7]=1-n,i.invalidate();const o=t._texture,a=o.baseTexture,l=a.alphaMode>0,h=t.tileTransform.localTransform,c=t.uvMatrix;let d=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;d&&(a._glTextures[e.CONTEXT_UID]?d=a.wrapMode!==u.CLAMP:a.wrapMode===u.CLAMP&&(a.wrapMode=u.REPEAT));const p=d?this.simpleShader:this.shader,f=o.width,m=o.height,g=t._width,y=t._height;Xo.set(h.a*f/g,h.b*f/y,h.c*m/g,h.d*m/y,h.tx/g,h.ty/y),Xo.invert(),d?Xo.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=Xo.toArray(!0),p.uniforms.uColor=Et.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=o,e.shader.bind(p),e.geometry.bind(i),this.state.blendMode=Rt(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}$o.extension={name:"tilingSprite",type:qt.RendererPlugin},Jt.add($o);const Yo=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof Pi?t:null,this.baseTexture=t instanceof ce?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=Yt(t,null);return null===i&&(i=parseFloat(e??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Yo.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const i=Yo.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const t=this._frameKeys[e],i=this._frames[t],r=i.frame;if(r){let e=null,s=null;const n=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,o=new Ce(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);e=i.rotated?new Ce(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Ce(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(s=new Ce(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[t]=new Pi(this.baseTexture,e,o,s,i.rotated?2:0,i.anchor,i.borders),Pi.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Yo.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*Yo.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let qo=Yo;qo.BATCH_SIZE=1e3;const Zo=["jpg","png","jpeg","avif","webp"];function Ko(t,e,i){const r={};if(t.forEach((t=>{r[t]=e})),Object.keys(e.textures).forEach((t=>{r[t]=e.textures[t]})),!i){const i=X.dirname(t[0]);e.linkedSheets.forEach(((t,s)=>{const n=Ko([`${i}/${e.data.meta.related_multi_packs[s]}`],t,!0);Object.assign(r,n)}))}return r}const Jo={extension:qt.Asset,cache:{test:t=>t instanceof qo,getCacheableAssets:(t,e)=>Ko(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),i=e.pop(),r=e.pop();return"json"===i&&Zo.includes(r)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(_.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:qt.LoadParser,priority:Ls.Normal},testParse:async(t,e)=>".json"===X.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,i){let r=X.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+t.meta.image;s=fn(s,e.src);const n=(await i.load([s]))[s],o=new qo(n.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const s of a){if("string"!=typeof s)continue;let n=r+s;e.data?.ignoreMultiPack||(n=fn(n,e.src),t.push(i.load({src:n,data:{ignoreMultiPack:!0}})))}const s=await Promise.all(t);o.linkedSheets=s,s.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};Jt.add(Jo);class Qo{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ta{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const r=e[t].match(/^[a-z]+/gm)[0],s=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const t in s){const e=s[t].split("="),i=e[0],r=e[1].replace(/"/gm,""),o=parseFloat(r),a=isNaN(o)?r:o;n[i]=a}i[r].push(n)}const r=new Qo;return i.info.forEach((t=>r.info.push({face:t.face,size:parseInt(t.size,10)}))),i.common.forEach((t=>r.common.push({lineHeight:parseInt(t.lineHeight,10)}))),i.page.forEach((t=>r.page.push({id:parseInt(t.id,10),file:t.file}))),i.char.forEach((t=>r.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),i.kerning.forEach((t=>r.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),i.distanceField.forEach((t=>r.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),r}}class ea{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Qo,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<i.length;t++)e.info.push({face:i[t].getAttribute("face"),size:parseInt(i[t].getAttribute("size"),10)});for(let t=0;t<r.length;t++)e.common.push({lineHeight:parseInt(r[t].getAttribute("lineHeight"),10)});for(let t=0;t<s.length;t++)e.page.push({id:parseInt(s[t].getAttribute("id"),10)||0,file:s[t].getAttribute("file")});for(let t=0;t<n.length;t++){const i=n[t];e.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class ia{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&ea.test(_.ADAPTER.parseXML(t))}static parse(t){return ea.parse(_.ADAPTER.parseXML(t))}}const ra=[ta,ea,ia];function sa(t,e,i,r,s,n,o){const a=i.text,l=i.fontProperties;e.translate(r,s),e.scale(n,n);const h=o.strokeThickness/2,c=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,i,r,s,n){const o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,c=t.width/r-l-2*h,u=t.height/r-l-2*h,d=o.slice(),p=i.fillGradientStops.slice();if(!p.length){const t=d.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),i.fillGradientType===xo.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,h,c/2,u+h);let t=0;const r=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let e=0;e<s.length;e++){const i=n.lineHeight*e;for(let e=0;e<d.length;e++){let s=0;s="number"==typeof p[e]?p[e]:e/d.length;const n=i/u+s*r;let o=Math.max(t,n);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(h,u/2,c+h,u/2);const t=d.length+1;let i=1;for(let e=0;e<d.length;e++){let r;r="number"==typeof p[e]?p[e]:i/t,a.addColorStop(r,d[e]),i++}}return a}(t,e,o,n,[a],i),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,i=o.dropShadowBlur*n,r=o.dropShadowDistance*n;e.shadowColor=Et.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=i,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*r,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*r}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,h,c+i.lineHeight-l.descent),o.fill&&e.fillText(a,h,c+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function na(t){return Array.from?Array.from(t):t.split("")}function oa(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const aa=class{constructor(t,e,i){const[r]=t.info,[s]=t.common,[n]=t.page,[o]=t.distanceField,a=Yt(n.file),l={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let i=0;i<t.page.length;i++){const{id:r,file:s}=t.page[i];l[r]=e instanceof Array?e[i]:e[s],o?.fieldType&&"none"!==o.fieldType&&(l[r].baseTexture.alphaMode=p.NO_PREMULTIPLIED_ALPHA,l[r].baseTexture.mipmap=d.OFF)}for(let e=0;e<t.char.length;e++){const{id:i,page:r}=t.char[e];let{x:s,y:n,width:o,height:h,xoffset:c,yoffset:u,xadvance:d}=t.char[e];s/=a,n/=a,o/=a,h/=a,c/=a,u/=a,d/=a;const p=new Ce(s+l[r].frame.x/a,n+l[r].frame.y/a,o,h);this.chars[i]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Pi(l[r].baseTexture,p),page:r}}for(let e=0;e<t.kerning.length;e++){let{first:i,second:r,amount:s}=t.kerning[e];i/=a,r/=a,s/=a,this.chars[r]&&(this.chars[r].kerning[i]=s)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let r;if(t instanceof Qo)r=t;else{const e=function(t){for(let e=0;e<ra.length;e++)if(ra[e].test(t))return ra[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(t)}e instanceof Pi&&(e=[e]);const s=new aa(r,e,i);return aa.available[s.font]=s,s}static uninstall(t){const e=aa.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete aa.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:s,resolution:n,textureWidth:o,textureHeight:a,...l}=Object.assign({},aa.defaultOptions,i),h=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const t=r[0].charCodeAt(0),i=r[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let r=t,s=i;r<=s;r++)e.push(String.fromCharCode(r))}else e.push(...na(r))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(r),c=e instanceof Eo?e:new Eo(e),u=o,d=new Qo;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let p,f,m,g=0,y=0,v=0;const x=[],b=[];for(let t=0;t<h.length;t++){p||(p=_.ADAPTER.createCanvas(),p.width=o,p.height=a,f=p.getContext("2d"),m=new ce(p,{resolution:n,...l}),x.push(m),b.push(new Pi(m)),d.page.push({id:b.length-1,file:""}));const e=h[t],i=wo.measureText(e,c,!1,p),r=i.width,w=Math.ceil(i.height),T=Math.ceil(("italic"===c.fontStyle?2:1)*r);if(y>=a-w*n){if(0===y)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,p=null,f=null,m=null,y=0,g=0,v=0;continue}if(v=Math.max(w+i.fontProperties.descent,v),T*n+g>=u){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,y+=v*n,y=Math.ceil(y),g=0,v=0;continue}sa(p,f,i,g,y,n,c);const S=oa(i.text);d.char.push({id:S,page:b.length-1,x:g/n,y:y/n,width:T,height:w,xoffset:0,yoffset:0,xadvance:r-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),g+=(T+2*s)*n,g=Math.ceil(g)}for(let t=0,e=h.length;t<e;t++){const i=h[t];for(let t=0;t<e;t++){const e=h[t],r=f.measureText(i).width,s=f.measureText(e).width,n=f.measureText(i+e).width-(r+s);n&&d.kerning.push({first:oa(i),second:oa(e),amount:n})}}const w=new aa(d,b,!0);return void 0!==aa.available[t]&&aa.uninstall(t),aa.available[t]=w,w}};let la=aa;la.ALPHA=[["a","z"],["A","Z"]," "],la.NUMERIC=[["0","9"]],la.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],la.ASCII=[[" ","~"]],la.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:aa.ALPHANUMERIC},la.available={};const ha=[],ca=[],ua=[],da=class extends is{constructor(t,e={}){super();const{align:i,tint:r,maxWidth:s,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},da.styleDefaults,e);if(!la.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Et(r),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new ze((()=>{this.dirty=!0}),this,0,0),this._roundPixels=_.ROUND_PIXELS,this.dirty=!0,this._resolution=_.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=la.available[this._fontName],e=this.fontSize,i=e/t.size,r=new Ee,n=[],o=[],a=[],l=na(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*t.size/e,c="none"===t.distanceFieldType?ha:ca;let u=null,d=0,p=0,f=0,m=-1,g=0,y=0,v=0,x=0;for(let e=0;e<l.length;e++){const i=l[e],s=oa(i);if(/(?:\s)/.test(i)&&(m=e,g=d,x++),"\r"===i||"\n"===i){o.push(d),a.push(-1),p=Math.max(p,d),++f,++y,r.x=0,r.y+=t.lineHeight,u=null,x=0;continue}const c=t.chars[s];if(!c)continue;u&&c.kerning[u]&&(r.x+=c.kerning[u]);const b=ua.pop()||{texture:Pi.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ee};b.texture=c.texture,b.line=f,b.charCode=s,b.position.x=Math.round(r.x+c.xOffset+this._letterSpacing/2),b.position.y=Math.round(r.y+c.yOffset),b.prevSpaces=x,n.push(b),d=b.position.x+Math.max(c.xAdvance-c.xOffset,c.texture.orig.width),r.x+=c.xAdvance+this._letterSpacing,v=Math.max(v,c.yOffset+c.texture.height),u=s,-1!==m&&h>0&&r.x>h&&(++y,Dt(n,1+m-y,1+e-m),e=m,m=-1,o.push(g),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,g),f++,r.x=0,r.y+=t.lineHeight,u=null,x=0)}const b=l[l.length-1];"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(d=g),o.push(d),p=Math.max(p,d),a.push(-1));const _=[];for(let t=0;t<=f;t++){let e=0;"right"===this._align?e=p-o[t]:"center"===this._align?e=(p-o[t])/2:"justify"===this._align&&(e=a[t]<0?0:(p-o[t])/a[t]),_.push(e)}const w=n.length,T={},S=[],E=this._activePagesMeshData;c.push(...E);for(let e=0;e<w;e++){const i=n[e].texture,r=i.baseTexture.uid;if(!T[r]){let e=c.pop();if(!e){const i=new mo;let r,n;"none"===t.distanceFieldType?(r=new go(Pi.EMPTY),n=s.NORMAL):(r=new go(Pi.EMPTY,{program:ni.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),n=s.NORMAL_NPM);const o=new fo(i,r);o.blendMode=n,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:n}=this;n[r]=n[r]||new Pi(i.baseTexture),e.mesh.texture=n[r],e.mesh.tint=this._tintColor.value,S.push(e),T[r]=e}T[r].total++}for(let t=0;t<E.length;t++)S.includes(E[t])||this.removeChild(E[t].mesh);for(let t=0;t<S.length;t++)S[t].mesh.parent!==this&&this.addChild(S[t].mesh);this._activePagesMeshData=S;for(const t in T){const e=T[t],i=e.total;if(!(e.indices?.length>6*i)||e.vertices.length<2*fo.BATCHABLE_SIZE)e.vertices=new Float32Array(8*i),e.uvs=new Float32Array(8*i),e.indices=new Uint16Array(6*i);else{const t=e.total,i=e.vertices;for(let e=4*t*2;e<i.length;e++)i[e]=0}e.mesh.size=6*i}for(let t=0;t<w;t++){const e=n[t];let r=e.position.x+_[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(r=Math.round(r));const s=r*i,o=e.position.y*i,a=e.texture,l=T[a.baseTexture.uid],h=a.frame,c=a._uvs,u=l.index++;l.indices[6*u+0]=0+4*u,l.indices[6*u+1]=1+4*u,l.indices[6*u+2]=2+4*u,l.indices[6*u+3]=0+4*u,l.indices[6*u+4]=2+4*u,l.indices[6*u+5]=3+4*u,l.vertices[8*u+0]=s,l.vertices[8*u+1]=o,l.vertices[8*u+2]=s+h.width*i,l.vertices[8*u+3]=o,l.vertices[8*u+4]=s+h.width*i,l.vertices[8*u+5]=o+h.height*i,l.vertices[8*u+6]=s,l.vertices[8*u+7]=o+h.height*i,l.uvs[8*u+0]=c.x0,l.uvs[8*u+1]=c.y0,l.uvs[8*u+2]=c.x1,l.uvs[8*u+3]=c.y1,l.uvs[8*u+4]=c.x2,l.uvs[8*u+5]=c.y2,l.uvs[8*u+6]=c.x3,l.uvs[8*u+7]=c.y3}this._textWidth=p*i,this._textHeight=(r.y+t.lineHeight)*i;for(const t in T){const e=T[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const i=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let s=0;s<e.total;s++)e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r}this._maxLineHeight=v*i;const r=e.mesh.geometry.getBuffer("aVertexPosition"),s=e.mesh.geometry.getBuffer("aTextureCoord"),n=e.mesh.geometry.getIndex();r.data=e.vertices,s.data=e.uvs,n.data=e.indices,r.update(),s.update(),n.update()}for(let t=0;t<n.length;t++)ua.push(n[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:r}=la.available[this._fontName];if("none"!==i){const{a:i,b:s,c:n,d:o}=this.worldTransform,a=Math.sqrt(i*i+s*s),l=Math.sqrt(n*n+o*o),h=(Math.abs(a)+Math.abs(l))/2,c=this.fontSize/r,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=h*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=la.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!la.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??la.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i="none"===la.available[this._fontName].distanceFieldType?ha:ca;i.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],i.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Pi.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};da.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const pa=[".xml",".fnt"],fa={extension:{type:qt.LoadParser,priority:Ls.Normal},name:"loadBitmapFont",test:t=>pa.includes(X.extname(t).toLowerCase()),testParse:async t=>ta.test(t)||ia.test(t),async parse(t,e,i){const r=ta.test(t)?ta.parse(t):ia.parse(t),{src:s}=e,{page:n}=r,o=[];for(let t=0;t<n.length;++t){const e=n[t].file;let i=X.join(X.dirname(s),e);i=fn(i,s),o.push(i)}const a=await i.load(o),l=o.map((t=>a[t]));return la.install(r,l,!0)},load:async(t,e)=>(await _.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};Jt.add(fa);const ma=class extends Eo{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new ma(Object.keys(ma.defaultOptions).reduce(((e,i)=>({...e,[i]:t[i]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete ma.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=ma;if(i[t]){const e=i[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return _.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,i)=>{const r=URL.createObjectURL(t),s=new FileReader;s.onload=()=>e([r,s.result]),s.onerror=i,s.readAsDataURL(t)})))).then((async([r,s])=>{const n=Object.assign({family:X.basename(t,X.extname(t)),weight:"normal",style:"normal",src:r,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Ct(t)),"number"==typeof t?(e=t,Y("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Et.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const s=`${i}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,ma.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=_.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let ga=ma;ga.availableFonts={},ga.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const ya=class extends ns{constructor(t="",e={}){super(Pi.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const i=new Image,r=Pi.from(i,{scaleMode:_.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Ce,r.trim=new Ce,this.texture=r;const s="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject"),l=document.createElementNS(n,"div"),h=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=ya.defaultMaxWidth,this.maxHeight=ya.defaultMaxHeight,this._domElement=l,this._styleElement=h,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(h),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=ya.defaultAutoResolution,this._resolution=ya.defaultResolution??_.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:i,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(r)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const n=Math.min(this.maxWidth,Math.ceil(s.width)),o=Math.min(this.maxHeight,Math.ceil(s.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:n+2*i.padding,height:o+2*i.padding}}async updateText(t=!0){const{style:e,_image:i,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:n}=this.measureText();i.width=r.width=Math.ceil(Math.max(1,s)),i.height=r.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise((t=>{r.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,i.src=r.src,r.onload=null,r.src="",this.updateTexture(),t()};const s=(new XMLSerializer).serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:r}=this,{padding:s}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/r,e.trim.height=e._frame.height=i.height/r,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),n.setRealSize(i.width,i.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},ya.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Bt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Bt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof ga?(this.ownsStyle=!1,this._style=t):t instanceof Eo?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=ga.from(t)):(this.ownsStyle=!0,this._style=new ga(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let va=ya;va.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},va.defaultMaxWidth=2024,va.defaultMaxHeight=2024,va.defaultAutoResolution=!0,ce.defaultOptions.scaleMode=c.NEAREST,document.addEventListener("wheel",(t=>t.ctrlKey&&t.preventDefault()),{passive:!1});class xa{constructor(t,e){this.x=t,this.y=e}get r(){return this.x}get th(){return this.y}get isNull(){return 0===this.x&&0===this.y}get isNaN(){return Number.isNaN(this.y+this.x)}set(t){this.x=t.x,this.y=t.y}abs(){return new xa(Math.abs(this.x),Math.abs(this.y))}negate(){return new xa(-this.x,-this.y)}add(t){return new xa(this.x+t.x,this.y+t.y)}sub(t){return new xa(this.x-t.x,this.y-t.y)}elementwiseMul(t){return new xa(this.x*t.x,this.y*t.y)}elementwiseDiv(t){return new xa(this.x/t.x,this.y/t.y)}mul(t){return new xa(this.x*t,this.y*t)}div(t){return new xa(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}unit(){const t=1/(this.isNull?1:this.length());return new xa(this.x*t,this.y*t)}project(t){const e=new xa(t.x,t.y);return e.isNull?e:this.dot(e.unit())}equals(t){return this.x===t.x&&this.y===t.y}toPolar(){return new xa(this.length(),Math.atan2(this.y,this.x))}toCartesian(){return new xa(this.x*Math.cos(this.y),this.x*Math.sin(this.y))}}function ba(t,e){return!(t.x<=e.pos.x||t.x>=e.pos.x+e.size.x||t.y<=e.pos.y||t.y>=e.pos.y+e.size.y)}function _a(t,e){return!(t.pos.x+t.size.x<=e.pos.x||t.pos.x>=e.pos.x+e.size.x||t.pos.y+t.size.y<=e.pos.y||t.pos.y>=e.pos.y+e.size.y)}function wa(t,e){if(t.direction.isNull)return[!1,null];const i=e.pos.sub(t.origin).elementwiseDiv(t.direction),r=e.pos.add(e.size).sub(t.origin).elementwiseDiv(t.direction);if(i.isNaN||r.isNaN)return[!1,null];if(i.x>r.x&&([r.x,i.x]=[i.x,r.x]),i.y>r.y&&([r.y,i.y]=[i.y,r.y]),i.x>r.y||i.y>r.x)return[!1,null];const s=Math.max(i.x,i.y);if(Math.min(r.x,r.y)<0)return[!1,null];const n=t.direction.mul(s).add(t.origin),o=e.pos.sub(n).length(),a=e.pos.add(e.size).sub(n).length(),l=e.pos.add(new xa(e.size.x,0)).sub(n).length(),h=e.pos.add(new xa(0,e.size.y)).sub(n).length(),c=Math.min(o,a,l,h);let u=new xa(0,0);return i.x>i.y?t.direction.x<0?u.x=1:u.x=-1:t.direction.y<0?u.y=1:u.y=-1,[!0,{point:n,normal:u,time:s,edginess:c}]}function Ta(t,e){if(t.dr.isNull)return[!1,null];const i={pos:t.size.mul(-.5).add(e.pos),size:t.size.add(e.size)},r=t.pos.add(t.size.div(2)),s=wa({origin:r,direction:t.dr},i);if(s[0]){const e=-3e-12;if(0===s[1].edginess){const e=i.pos.add(i.size.div(2)),s=r.sub(e);if(s.x>0){if(s.y>0){if(t.dr.x>=0||t.dr.y>=0)return[!1,null]}else if(t.dr.x>=0||t.dr.y<=0)return[!1,null]}else if(s.y>0){if(t.dr.x<=0||t.dr.y>=0)return[!1,null]}else if(t.dr.x<=0||t.dr.y<=0)return[!1,null]}return s[1].time>=e&&s[1].time<1?s:[!1,null]}return s}function Sa(t,e){return Ta({pos:t.pos,size:t.size,dr:t.dr.sub(e.dr)},e)}const Ea={pointVsRect:ba,rectVsRect:_a,rayVsRect:wa,dynamicRectVsRect:Ta,dynamicRectVsDynamicRect:Sa},Aa=new class{changeResolution(t){const e=t/this.baseWidth;this.stage.scale.set(e);const i=t/this.aspectRatio;this.renderer.resize(t,i)}updateFps(t){const e=Math.floor(1/t);this.currentFPS=e,this.smallestFPS>e&&(this.smallestFPS=e),this.biggestFPS<e&&(this.biggestFPS=e),this.fpsDisplay&&(this.fpsDisplay.innerHTML="fps: "+e+"<br>max-fps: "+this.biggestFPSView+"<br>min-fps: "+this.smallestFPSView),void 0!==this.fpsInterval&&requestAnimationFrame((t=>{const e=(t-this.prev)/1e3;this.prev=t,this.updateFps(e)}))}getFps(){return this.currentFPS}getMaxFps(){return this.biggestFPSView}getMinFps(){return this.smallestFPSView}showFps(){this.fpsDisplay=document.createElement("div"),this.fpsDisplay.style.color="red",this.fpsDisplay.style.position="fixed",this.fpsDisplay.style.left="0px",this.fpsDisplay.style.top="0px";const t=document.getElementById("display");t&&t.append(this.fpsDisplay)}hideFps(){var t;null===(t=this.fpsDisplay)||void 0===t||t.remove(),this.fpsDisplay=void 0}countFps(){void 0===this.fpsInterval&&(this.fpsInterval=window.setInterval((()=>{this.biggestFPSView=this.biggestFPS,this.biggestFPS=0,this.smallestFPSView=this.smallestFPS,this.smallestFPS=1/0}),1e3),this.updateFps(1/0))}stopFpsCount(){clearInterval(this.fpsInterval),this.fpsInterval=void 0}constructor(){this.baseWidth=1280,this.baseHeight=720,this.aspectRatio=this.baseWidth/this.baseHeight,this.px=0,this.py=0,this.width=this.baseWidth,this.height=this.baseHeight,this.mousex=0,this.mousey=0,this.pivotx=0,this.pivoty=0,this.scale=1,this.angle=0,this.boundingBox={l:0,t:0,r:0,b:0,w:0,h:0},this.boundingBoxRectData={pos:{x:0,y:0},size:{x:0,y:0}},this.posLerp=700,this.posPerc=2.7,this.scalePerc=.99*6,this.transformEffects=new Set,this.renderer=Dr({width:this.baseWidth,height:this.baseHeight,backgroundColor:"#900C3F"}),this.stage=new is,this.effects=new is,this.view=new is,this.currentFPS=0,this.biggestFPS=0,this.smallestFPS=1/0,this.biggestFPSView=this.biggestFPS,this.smallestFPSView=this.biggestFPS,this.prev=performance.now(),this.view.eventMode="none",this.view.sortableChildren=!0,this.view.position.set(this.baseWidth/2,this.baseHeight/2);const t=this.renderer.view;if(!(t instanceof HTMLCanvasElement))return;const e=document.getElementById("display");e&&(e.append(t),this.stage.addChild(this.effects),this.effects.addChild(this.view),new ResizeObserver((t=>{for(const e of t){const t=e.contentRect.width,i=e.contentRect.height;if(t/i>this.aspectRatio){const t=i*this.aspectRatio;this.width=t,this.height=i}else{const e=t/this.aspectRatio;this.width=t,this.height=e}this.px=.5*(t-this.width),this.py=.5*(i-this.height)}this.computeBoundingBox()})).observe(t),t.addEventListener("mousemove",(t=>{if(t.offsetX>this.px+this.width)return;if(t.offsetY>this.py+this.height)return;const e=t.offsetX-this.px,i=t.offsetY-this.py;e<0||i<0||(this.mousex=e/this.width,this.mousey=i/this.height)})),this.computeBoundingBox())}getCanvas(){const t=this.renderer.view;if(t instanceof HTMLCanvasElement)return t}setBGColor(t){this.renderer.background.backgroundColor.setValue(t)}setBGAlpha(t){this.renderer.background.alpha=t}toViewport(t,e){const i=this.view.rotation;return[(((t-this.view.pivot.x)*Math.cos(i)-(e-this.view.pivot.y)*Math.sin(i))*this.view.scale.x+this.view.position.x)*(this.width/this.baseWidth),(((t-this.view.pivot.x)*Math.sin(i)+(e-this.view.pivot.y)*Math.cos(i))*this.view.scale.y+this.view.position.y)*(this.height/this.baseHeight)]}fromViewport(t,e){const i=(this.baseWidth*t/this.width-this.view.position.x)/this.view.scale.x,r=(this.baseHeight*e/this.height-this.view.position.y)/this.view.scale.y,s=this.view.rotation,n=i*Math.cos(s)+r*Math.sin(s),o=r*Math.cos(s)-i*Math.sin(s);return[this.view.pivot.x+n,this.view.pivot.y+o]}getMousePos(){return this.fromViewport(this.mousex*this.width,this.mousey*this.height)}getMouseViewportPos(){return[this.mousex*this.width,this.mousey*this.height]}getCenterX(){return this.pivotx}getCenterY(){return this.pivoty}_setCenter(t,e){this.pivotx=t,this.pivoty=e,this.view.pivot.set(t,e),this.computeBoundingBox()}setCenter(t,e){this._setCenter(t,e),this.targetX=this.pivotx,this.targetY=this.pivoty}moveToCenter(t,e){this.targetX=t,this.targetY=e}getViewportWidth(){return this.width}getViewportHeight(){return this.height}getScale(){return this.scale}_setScale(t){this.scale=t,this.view.scale.set(t,t),this.computeBoundingBox()}setScale(t){this._setScale(t),this.targetScale=this.scale}moveToScale(t){this.targetScale=t}setAngle(t){this.angle=t,this.view.rotation=t,this.computeBoundingBox()}getAngle(){return this.angle}add(t){this.view.addChild(t)}computeBoundingBox(){const[t,e]=this.fromViewport(0,0),[i,r]=this.fromViewport(this.width,0),[s,n]=this.fromViewport(this.width,this.height),[o,a]=this.fromViewport(0,this.height),l=Math.min(t,i,s,o),h=Math.min(e,r,n,a),c=Math.max(t,i,s,o),u=Math.max(e,r,n,a);this.boundingBox.l=l,this.boundingBox.r=c,this.boundingBox.t=h,this.boundingBox.b=u,this.boundingBox.w=c-l,this.boundingBox.h=u-h,this.boundingBoxRectData.pos.x=l,this.boundingBoxRectData.pos.y=h,this.boundingBoxRectData.size.x=c-l,this.boundingBoxRectData.size.y=u-h}getBoundingBox(){return this.boundingBox}containsBroad(t){return ba(t,this.boundingBoxRectData)}overlapsRectBroad(t){return _a(t,this.boundingBoxRectData)}clamp(t,e,i,r){const s=this.scale,n=this.pivotx,o=this.pivoty,a=this.computeClamp(this.pivotx,this.pivoty,this.scale,t,e,i,r);n===a.targetX&&o===a.targetY||this.setCenter(a.targetX,a.targetY),this.targetX=a.targetX,this.targetY=a.targetY,s!==a.targetScale&&this.setScale(a.targetScale),this.targetScale=a.targetScale}moveToClamp(t,e,i,r,s,n,o){const a=this.getCenterX(),l=this.getCenterY(),h=this.getScale();this._setCenter(t,e),this._setScale(i);const c=this.computeClamp(t,e,i,r,s,n,o);this.targetX=c.targetX,this.targetY=c.targetY,this.targetScale=c.targetScale,this._setCenter(a,l),this._setScale(h)}computeClamp(t,e,i,r,s,n,o){const a=n>this.boundingBox.w,l=o>this.boundingBox.h;if(a&&l)this.boundingBox.l<r&&(t=r+.5*this.boundingBox.w),this.boundingBox.r>r+n&&(t=r+n-.5*this.boundingBox.w),this.boundingBox.t<s&&(e=s+.5*this.boundingBox.h),this.boundingBox.b>s+o&&(e=s+o-.5*this.boundingBox.h);else if(a||l)if(a){e=s+.5*o;const a=this.scale;i=this.scale*this.boundingBox.h/o,this._setScale(i),this.boundingBox.l<r&&(t=r+.5*this.boundingBox.w),this.boundingBox.r>r+n&&(t=r+n-.5*this.boundingBox.w),this._setScale(a)}else{t=r+.5*n;const a=this.scale;i=this.scale*this.boundingBox.w/n,this._setScale(i),this.boundingBox.t<s&&(e=s+.5*this.boundingBox.h),this.boundingBox.b>s+o&&(e=s+o-.5*this.boundingBox.h),this._setScale(a)}else{const a=Math.max(this.boundingBox.w/n,this.boundingBox.h/o);i=this.scale*a;const l=this.scale;this._setScale(i),this.boundingBox.l<r&&(t=r+.5*this.boundingBox.w),this.boundingBox.r>r+n&&(t=r+n-.5*this.boundingBox.w),this.boundingBox.t<s&&(e=s+.5*this.boundingBox.h),this.boundingBox.b>s+o&&(e=s+o-.5*this.boundingBox.h),this._setScale(l)}return{targetX:t,targetY:e,targetScale:i}}pushEffect(t){this.transformEffects.add(t)}stopMoveTo(){this.targetScale=void 0,this.targetX=void 0,this.targetY=void 0}computeDeltaOf(t,e){let i=0,r="x"===t?this.targetX:this.targetY;if(void 0!==r){const s=r-("x"===t?this.pivotx:this.pivoty);if(this.posPerc&&(i=s*this.posPerc*e),this.posLerp){const t=Math.sign(s)*this.posLerp*e;Math.abs(i)<Math.abs(t)&&(i=t)}Math.abs(s)<Math.abs(i)&&(i=s)}return i}update(t){let e=this.computeDeltaOf("x",t),i=this.computeDeltaOf("y",t),r=0;if(this._setCenter(this.pivotx+e,this.pivoty+i),this.targetScale){const e=this.targetScale-this.scale;this.scalePerc&&(r=Math.sign(e)*this.scalePerc*t),Math.abs(e)<Math.abs(r)&&(r=e)}this._setScale(this.scale+r)}render(){this.effects.position.set(0),this.effects.scale.set(1),this.effects.rotation=0;for(const t of this.transformEffects){const e=t.next();e.done?this.transformEffects.delete(t):(e.value.x&&(this.effects.position.x+=e.value.x),e.value.y&&(this.effects.position.y+=e.value.y),e.value.angle&&(this.effects.rotation+=e.value.angle),e.value.scale&&(this.effects.scale.x+=e.value.scale,this.effects.scale.y+=e.value.scale))}this.renderer.render(this.stage)}},Ca=Aa;class Pa{constructor(){this.deltaTime=0,this.frame=void 0,this.prevRafTimestamp=0,this.isRunning=!1}get dt(){return this.deltaTime}start(){this.isRunning||(this.isRunning=!0,this.onStart(),this.onFrameDraw!==Pa.prototype.onFrameDraw&&this.rafCallback(0))}onStart(){}onStop(){}onFrameDraw(){}rafCallback(t=0){const e=t-this.prevRafTimestamp;this.prevRafTimestamp=t,this.deltaTime=.001*Math.min(500,e),this.onFrameDraw(),this.isRunning&&(this.frame=requestAnimationFrame((t=>this.rafCallback(t))))}stop(){this.isRunning&&(this.isRunning=!1,this.frame&&cancelAnimationFrame(this.frame),this.onStop())}isStopped(){return!this.isRunning}}class Ra{constructor(t){this.prev=new Set,this.current=new Set,this.held=new Set,this.stopper=()=>{},this.isRunning=!1,this.mouseTarget=t,this.mouseTarget&&this.mouseTarget.addEventListener("contextmenu",(t=>t.preventDefault())),this.start()}update(){this.prev.clear();for(const t of this.current)this.prev.add(t);this.current.clear();for(const t of this.held)this.current.add(t);this.wheel=this.nextWheel,this.nextWheel=void 0}getWheel(){return this.wheel}isPressed(t){return this.current.has(t)&&!this.prev.has(t)}isHeld(t){return this.current.has(t)&&this.prev.has(t)}isReleased(t){return!this.current.has(t)&&this.prev.has(t)}start(){this.isRunning=!0;const t=t=>this.nextWheel=t,e=t=>{const e=1===t.button?"MouseAuxiliary":2===t.button?"MouseSecondary":"MouseMain";this.held.add(e)},i=t=>{const e=1===t.button?"MouseAuxiliary":2===t.button?"MouseSecondary":"MouseMain";this.held.delete(e)},r=t=>{this.held.add(t.code)},s=t=>{this.held.delete(t.code)};addEventListener("keydown",r),addEventListener("keyup",s),this.mouseTarget&&(this.mouseTarget.addEventListener("mousedown",e),this.mouseTarget.addEventListener("mouseup",i),this.mouseTarget.addEventListener("wheel",t)),this.stopper=()=>{this.isRunning=!1,removeEventListener("keydown",r),removeEventListener("keyup",s),this.mouseTarget&&(this.mouseTarget.removeEventListener("mousedown",e),this.mouseTarget.removeEventListener("mouseup",i),this.mouseTarget.addEventListener("wheel",t))}}stop(){this.stopper()}isStopped(){return!this.isRunning}}const Ma=Symbol("null-query-id");let Ia=Number.MIN_SAFE_INTEGER;class ka{constructor(t){this.cells=new Map,this.size=t}getCells(){return this.cells}clear(){return this.cells.clear()}initCell(t,e){const i=[];return this.cells.set(t+"."+e,i),i}getCell(t,e){return this.cells.get(t+"."+e)}toGridBounds(t,e,i,r){return{imin:Math.floor(t/this.size),imax:Math.floor((t+i)/this.size),jmin:Math.floor(e/this.size),jmax:Math.floor((e+r)/this.size)}}removeFromCell(t,e,i){const r=t[t.length-1];if(r){t[e]=r;const i=r._cellsData.get(t);i&&(i[0]=e)}t.pop(),i._cellsData.delete(t)}set(t){var e;const i=this.toGridBounds(t.l,t.t,t.w,t.h);for(let r=i.jmin;r<=i.jmax;r++)for(let s=i.imin;s<=i.imax;s++){const i=null!==(e=this.getCell(s,r))&&void 0!==e?e:this.initCell(s,r);if(void 0===t._cellsData.get(i)){const e=i.push(t);t._cellsData.set(i,[e-1,s,r])}}}unset(t){const e=this.toGridBounds(t.l,t.t,t.w,t.h);for(const[i,[r,s,n]]of t._cellsData)(s<e.imin||s>e.imax||n<e.jmin||n>e.jmax)&&this.removeFromCell(i,r,t)}create(t,e,i,r,s){const n={_cellsData:new Map,_queryID:Ma,l:t,t:e,w:i,h:r,userData:s};return this.set(n),n}update(t){this.unset(t),this.set(t)}remove(t){for(const[e,[i]]of t._cellsData)this.removeFromCell(e,i,t)}*findNear(t,e,i,r){const s=Symbol(String(Ia++)),n=this.toGridBounds(t,e,i,r);for(let t=n.jmin;t<=n.jmax;t++)for(let e=n.imin;e<=n.imax;e++){const i=this.getCell(e,t);if(i)for(const t of i)t._queryID!==s&&(t._queryID=s,yield t)}}*findNearCells(t,e,i,r){const s=this.toGridBounds(t,e,i,r);for(let t=s.jmin;t<=s.jmax;t++)for(let e=s.imin;e<=s.imax;e++)yield[e,t]}}function Fa(t,...e){let i=t;for(const t of e)i=i.connect(t);return i}class Da{constructor(t,e){this.loadingProgress=1,this.loaded={},this.loadingProgress=0;const i=[];for(const r of Object.keys(e)){const s=e[r];i.push(fetch(s).then((t=>{if(!t.ok)throw Error(s+" preload failed.");return t.arrayBuffer()})).then((e=>t.decodeAudioData(e))).then((t=>(this.loadingProgress+=1/i.length,[r,t]))))}this.loading=Promise.all(i).then((t=>{this.loadingProgress=1;for(const[e,i]of t)this.loaded[e]=i}))}getloadingProgress(){return this.loadingProgress}loadingDone(){return this.loading}}class Ba extends Da{constructor(t,e,i){super(e,i),this.context=e,this.parent=t}}class Oa extends Ba{setVolume(t){t=Math.min(1,Math.max(0,t)),this.volume=t,this.volNode.gain.value=t*this.parent.getVolume()}getVolume(){return this.volume}constructor(t,e,i){super(t,e,i),this.volume=1,this.context=e,this.volNode=e.createGain(),this.fade=e.createGain();let r=0,s=performance.now();setInterval((()=>{var t,e,i,n,o;const a=performance.now(),l=(a-s)/1e3;s=a,"changed"===this.state&&(this.state="fadeout",(null===(t=this.nextData)||void 0===t?void 0:t.name)===(null===(e=this.currentData)||void 0===e?void 0:e.name)&&(this.currentData=this.nextData,this.currentData&&(this.currentData.fadeIn=this.currentData.fadeOutPrev),this.nextData=void 0,this.state="fadein")),"fadeout"===this.state&&(this.nextData?this.fade.gain.value?this.nextData.fadeOutPrev?(this.fade.gain.value-=l/this.nextData.fadeOutPrev,this.fade.gain.value=Math.min(Math.max(0,this.fade.gain.value),1)):this.nextData.silence?(this.fade.gain.value=0,this.state="silenceStart"):this.state="ready":this.state="silenceStart":this.state="fadein"),"silenceStart"===this.state&&(r=0,this.state="silence"),"silence"===this.state&&(r+=l,r>=(null!==(n=null===(i=this.nextData)||void 0===i?void 0:i.silence)&&void 0!==n?n:0)&&(this.state="ready")),"ready"===this.state&&(this.currentData=this.nextData,this.nextData=void 0,this.playCurrent(),this.state="fadein"),"fadein"===this.state&&((null===(o=this.currentData)||void 0===o?void 0:o.fadeIn)?(this.fade.gain.value+=l/this.currentData.fadeIn,this.fade.gain.value=Math.min(Math.max(0,this.fade.gain.value),1),1===this.fade.gain.value&&(this.state=void 0)):(this.fade.gain.value=1,this.state=void 0))}))}playCurrent(){var t,e,i,r,s,n;const o=this.setActiveAudio(null===(t=this.currentData)||void 0===t?void 0:t.name);o&&(o.loop=!0,void 0!==(null===(e=this.currentData)||void 0===e?void 0:e.loopStart)&&(o.loopStart=this.currentData.loopStart),o.loopEnd=null!==(n=null!==(r=null===(i=o.buffer)||void 0===i?void 0:i.duration)&&void 0!==r?r:null===(s=this.currentData)||void 0===s?void 0:s.loopEnd)&&void 0!==n?n:0,o.start())}setActiveAudio(t){if(this.activeAudio&&(this.activeAudio.stop(),this.activeAudio.disconnect()),!t)return;const e=this.loaded[t];if(!e)return;const i=this.context.createBufferSource();return i.buffer=e,this.activeAudio=i,Fa(i,this.volNode,this.fade,this.context.destination),i}setMusic(t){const e=Object.assign({},t);this.nextData=e,"silence"!==this.state&&(this.state="changed")}getMusic(){return this.currentData}}class La extends Ba{getFinalVolume(){return this.volume*this.parent.getVolume()}getVolume(){return this.volume}setVolume(t){t=Math.min(1,Math.max(0,t)),this.volume=t;const e=this.getFinalVolume();for(const[t,{volume:i}]of this.playing)i.gain.value=e}constructor(t,e,i){super(t,e,i),this.cached=new Set,this.playing=new Map,this.volume=1}play(t,e){if(t){if(this.cached.has(t))return;this.cached.add(t),setTimeout((()=>{this.cached.delete(t)}),(null==e?void 0:e.sleep)?1e3*e.sleep:void 0)}const{stopPrev:i}=null!=e?e:{};if(i&&this.activeSound){const e=this.activeSound;if(!0===i)e.stop(),e.disconnect(),e.onended=null,this.playing.delete(e);else{const r=i.timeout;let s=!0;if(i.same){s=!1;for(const e of this.playing.values())if(e.name===t){s=!0;break}}if(i.name)for(const t of this.playing.values())if("string"==typeof i.name?i.name===t.name:-1!==i.name.findIndex((e=>t.name===e))){t.volume.gain.value=0;break}s&&(void 0!==r?setTimeout((()=>{e.stop(),e.disconnect(),e.onended=null,this.playing.delete(e)}),1e3*r):(e.stop(),e.disconnect(),e.onended=null,this.playing.delete(e)))}}if(!t)return;const r=this.loaded[t];if(!r)return;const s=this.context.createBufferSource();s.buffer=r,this.activeSound=s;const n=this.context.createGain();n.gain.value=this.getFinalVolume(),Fa(s,n,this.context.destination),this.playing.set(s,{volume:n,name:t}),s.onended=()=>{this.playing.delete(s),s.disconnect(),s.onended=null},s.start()}}class Na{constructor(){this.context=new AudioContext,this.containers=[],this.loaded=Promise.resolve(),this.volume=1}resetLoaded(){this.loaded=Promise.all(this.containers.map((t=>t.loadingDone()))).then((()=>{}))}init(){this.context.resume()}getloadingProgress(){const t=this.containers.length;return t?this.containers.reduce(((t,e)=>t+e.getloadingProgress()),0)/t:1}loadingDone(){return this.loaded}createMusicPlayer(t){const e=new Oa(this,this.context,t);return e.setVolume(this.volume),this.containers.push(e),this.resetLoaded(),e}createSoundPlayer(t){const e=new La(this,this.context,t);return e.setVolume(this.volume),this.containers.push(e),this.resetLoaded(),e}setVolume(t){this.volume=t,this.containers.forEach((t=>t.setVolume(t.getVolume())))}getVolume(){return this.volume}}class Ua{constructor(){this.connections=new Map}connect(t,e){if(this.connections.has(e))throw Error("Connection already exists");this.connections.set(e,t)}start(t){let e=null;return i=>{e||(this.onStart(t),t=null,e=this),!1===e.onUpdate(i)&&(e=e.end())}}end(){const[t,e]=this.onEnd(),i=this.connections.get(e);return i?(i.onStart(t),i):null}}const Ga=i.p+"d7c6917b696090bc804d.mp3",za=i.p+"02a7ee083b54a54cbac5.mp3",ja=i.p+"45d4bd467612e2822a67.mp3",Ha=i.p+"449f49fc5754270bc1a2.mp3",Va=i.p+"440658c944620548a9bf.mp3",Wa=i.p+"52de0b602e59aa10317a.mp3",Xa=i.p+"3baa116d804590f4be5d.mp3",$a=i.p+"05186d3e7be1699ee412.mp3",Ya=i.p+"4cd28ba6800c564dfa3e.mp3",qa=i.p+"f2226aaed2bfb0f5afcf.mp3",Za=i.p+"fc6cd0272cdf39ecfcdd.mp3",Ka=i.p+"cece351d7b914950cacc.mp3",Ja=i.p+"5688c504509d9a42e80f.mp3",Qa=i.p+"41c93f7fd19b2b2c692f.mp3",tl=i.p+"2a8e305b372e64d2b2e2.mp3",el=i.p+"c299ae27ebbac6de38c2.mp3",il=i.p+"d5be7445eff6bb7a41ba.mp3",rl=i.p+"9dd4a061713cd3ee19e8.mp3",sl=i.p+"3e32a9dbb839ae418477.mp3",nl=i.p+"e804121c0c35e732f7ac.mp3",ol=i.p+"3e72d507ea5ccc31f0ae.mp3",al=i.p+"3c66f462280717322261.mp3",ll=i.p+"de5188b6a40f04325303.mp3",hl=i.p+"a33a7c21bc52128263c1.mp3";let cl=null;function ul(){if(cl)return cl;const t=new Na,e=t.createSoundPlayer({oneUp:Ga,bowserfalls:za,bowserfire:ja,breakblock:Ha,bump:Va,coin:Wa,fireball:Xa,fireworks:$a,flagpole:Ya,gameover:qa,jumpSmall:Za,jumpBig:Ka,kick:Ja,mariodie:Qa,pause:tl,pipe:el,powerup:il,powerup_appears:rl,stage_clear:sl,stomp:nl,vine:ol,warning:al,world_clear:ll}),i=t.createMusicPlayer({mustest:hl}),r={controller:t,sounds:e,music:i};return cl=r,t.setVolume(.5),r}function dl(t){const e={positionStart:new xa(0,0),positionPrev:new xa(0,0),position:new xa(0,0),size:new xa(0,0),dynamicIndex:-1,staticIndex:-1,kinematicIndex:-1};return Object.assign(e,t),e}const pl=new class{constructor(){this.entities=[],this.entToIndex=new Map,this.targetToProxy=new WeakMap,this.views={},this.queuedActions=[],this.hadCompsAdded=new Set,this.hadCompsRemoved=new Set,this.toBeRemoved=new Set,this.toBeAdded=new Set,this.propChangeHandlers=new Map,this.viewToOnAddingHandlers=new Map,this.viewToOnRemovingHandlers=new Map}number(){return this.entities.length}hasComponent(t,e){return void 0!==t[e]}*toBeRemovedIterator(){for(const t of this.toBeRemoved)if(this.entityExists(t)){yield[t,null];for(const e of Object.values(this.views))e.entToIndex.has(t)&&(yield[t,e])}}*hadCompsRemovedIterator(t){for(const e of this.hadCompsRemoved)if(this.entityExists(e)&&!(null==t?void 0:t.has(e)))for(const[t,i]of Object.entries(this.views))i.entToIndex.has(e)&&t.split("/").some((t=>!this.hasComponent(e,t)))&&(yield[e,i])}*toBeAddedIterator(t){for(const e of this.toBeAdded)if(!this.entityExists(e)&&!(null==t?void 0:t.has(e))){yield[e,null];for(const[t,i]of Object.entries(this.views))t.split("/").every((t=>this.hasComponent(e,t)))&&(yield[e,i])}}*hadCompsAddedIterator(...t){for(const e of this.hadCompsAdded)if(this.entityExists(e)){for(const i of t)if(i.has(e))continue;for(const[t,i]of Object.entries(this.views))!i.entToIndex.has(e)&&t.split("/").every((t=>this.hasComponent(e,t)))&&(yield[e,i])}}update(){var t,e,i,r;for(const[e,i]of this.toBeRemovedIterator()){const r=null!==(t=null==i?void 0:i.entities)&&void 0!==t?t:this.entities,s=this.viewToOnRemovingHandlers.get(r);if(s)for(const t of s)t(e)}for(const[t,e]of this.hadCompsRemovedIterator(this.toBeRemoved)){const i=this.viewToOnRemovingHandlers.get(e.entities);if(i)for(const e of i)e(t)}for(const[t,i]of this.toBeAddedIterator(this.toBeRemoved)){const r=null!==(e=null==i?void 0:i.entities)&&void 0!==e?e:this.entities,s=this.viewToOnAddingHandlers.get(r);if(s)for(const e of s)e(t)}for(const[t,e]of this.hadCompsAddedIterator(this.toBeRemoved,this.toBeAdded)){const i=this.viewToOnAddingHandlers.get(e.entities);if(i)for(const e of i)e(t)}for(const[t,e]of this.toBeRemovedIterator())this.removeFromView(t,null!=e?e:void 0);for(const[t,e]of this.hadCompsRemovedIterator(this.toBeRemoved))this.removeFromView(t,e);for(const[t,e]of this.toBeAddedIterator(this.toBeRemoved)){const s=null!==(i=null==e?void 0:e.entities)&&void 0!==i?i:this.entities,n=null!==(r=null==e?void 0:e.entToIndex)&&void 0!==r?r:this.entToIndex,o=s.push(t);n.set(t,o-1)}for(const[t,e]of this.hadCompsAddedIterator(this.toBeRemoved,this.toBeAdded)){const i=e.entities.push(t);e.entToIndex.set(t,i-1)}this.toBeRemoved.clear(),this.hadCompsRemoved.clear(),this.toBeAdded.clear(),this.hadCompsAdded.clear();for(const t of this.queuedActions)t.cancelled||t.action();this.queuedActions=[]}enqueue(t){const e={action:t,cancelled:!1};return this.queuedActions.push(e),()=>e.cancelled=!0}createEntity(t){const e=Object.assign({},t),i=this;for(const r of Object.keys(t)){const t=i.propChangeHandlers.get(r);if(t){const i=e[r];t(Object.assign({},e),i)}}const r=new Proxy(e,{deleteProperty:(t,e)=>{const r=i.propChangeHandlers.get(e),s=t[e],n=delete t[e];r&&r(Object.assign({},t),s);const o=i.targetToProxy.get(t);return n&&o&&i.hadCompsRemoved.add(o),n},defineProperty(t,e,r){const s=r.get?r.get():r.value,n=t[e];t[e]=s;const o=i.targetToProxy.get(t);void 0!==n&&void 0===s?o&&i.hadCompsRemoved.add(o):void 0!==s&&void 0===n&&o&&i.hadCompsAdded.add(o);const a=i.propChangeHandlers.get(e);if(a){const i=t[e];a(Object.assign({},t),i)}return!0}});return this.targetToProxy.set(e,r),this.toBeAdded.add(r),r}onPropChange(t,e){this.propChangeHandlers.set(t,e)}entityExists(t){return this.entToIndex.has(t)}removeFromView(t,e){var i,r;const s=null!==(i=null==e?void 0:e.entities)&&void 0!==i?i:this.entities,n=null!==(r=null==e?void 0:e.entToIndex)&&void 0!==r?r:this.entToIndex,o=n.get(t);if(void 0===o)return!1;n.delete(t);const a=s.length-1,l=s[a];return!!l&&(s[a]=t,s[o]=l,s.pop()!==l&&n.set(l,o),!0)}clear(){for(const t of this.entities)this.remove(t)}remove(t){return this.toBeRemoved.add(t)}constructViewKey(t){return[...new Set(t)].sort().join("/")}view(t){if(!t)return this.entities;const e=this.constructViewKey(t);if(""===e)return this.entities;let i=this.views[e];if(i)return i.entities;const r=t.some((t=>/\//.test(t)));if(r)throw Error("Illegal character in component: '/'. Please do not use this character in your component name.");return i={entities:this.entities.filter((e=>!t.some((t=>!this.hasComponent(e,t))))),entToIndex:new Map},i.entities.forEach(((t,e)=>null==i?void 0:i.entToIndex.set(t,e))),this.views[e]=i,i.entities}onAdding(t,e){const i=this.view(t),r=this.viewToOnAddingHandlers.get(i)||[];this.viewToOnAddingHandlers.set(i,r),r.push(e)}onRemoving(t,e){const i=this.view(t),r=this.viewToOnRemovingHandlers.get(i)||[];this.viewToOnRemovingHandlers.set(i,r),r.push(e)}},fl=pl;function ml(t){var e;for(const i of fl.view(["kinematic"])){const r=i.dynamic?16776960:65535;t.lineStyle(0,0,0).beginFill(r,1).drawCircle(i.position.x,i.position.y,2).endFill(),(null===(e=i.mario)||void 0===e?void 0:e.facing)&&t.lineStyle(1,r,1).beginFill(0,0).moveTo(i.position.x,i.position.y).lineTo(i.position.x+10*i.mario.facing,i.position.y).endFill(),t.lineStyle(1,r,1).beginFill(0,0).drawRect(i.position.x-.5*i.size.x,i.position.y-.5*i.size.y,i.size.x,i.size.y).endFill()}}const gl={red:.71},yl=new mi(void 0,"\n  varying vec2 vTextureCoord;\n  uniform sampler2D uSampler;\n  uniform float red;\n  void main(void)\n  {\n    vec4 c = texture2D(uSampler, vTextureCoord);\n    if (\n      (c.x > 0.70 && c.y < 0.20 && c.z < 0.13)\n    ) {\n      gl_FragColor = vec4(0.969,0.847,0.647,c.a);\n    } else if (\n      (c.x < 0.43 && c.x > 0.4 && c.y < 0.43 && c.z < 0.02)\n    ) {\n      gl_FragColor = vec4(red,0.192,0.125,c.a);\n    }  else {\n      gl_FragColor = texture2D(uSampler, vTextureCoord);\n    }\n  }\n",gl);class vl extends mi{constructor(t=4,e=3,i=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",i?"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}\n":"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}"),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new Ee,this.pixelSize=1,this._clamp=i,Array.isArray(t)?this.kernels=t:(this._blur=t,this.quality=e)}apply(t,e,i,r){const s=this._pixelSize.x/e._frame.width,n=this._pixelSize.y/e._frame.height;let o;if(1===this._quality||0===this._blur)o=this._kernels[0]+.5,this.uniforms.uOffset[0]=o*s,this.uniforms.uOffset[1]=o*n,t.applyFilter(this,e,i,r);else{const a=t.getFilterTexture();let l,h=e,c=a;const u=this._quality-1;for(let e=0;e<u;e++)o=this._kernels[e]+.5,this.uniforms.uOffset[0]=o*s,this.uniforms.uOffset[1]=o*n,t.applyFilter(this,h,c,1),l=h,h=c,c=l;o=this._kernels[u]+.5,this.uniforms.uOffset[0]=o*s,this.uniforms.uOffset[1]=o*n,t.applyFilter(this,h,i,r),t.returnFilterTexture(a)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce(((t,e)=>t+e+.5),0))}_generateKernels(){const t=this._blur,e=this._quality,i=[t];if(t>0){let r=t;const s=t/e;for(let t=1;t<e;t++)r-=s,i.push(r)}this._kernels=i,this._updatePadding()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(t){"number"==typeof t?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof Ee?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get blur(){return this._blur}set blur(t){this._blur=t,this._generateKernels()}}var xl="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";class bl extends mi{constructor(t=.5){super(xl,"\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform float threshold;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    // A simple & fast algorithm for getting brightness.\n    // It's inaccuracy , but good enought for this feature.\n    float _max = max(max(color.r, color.g), color.b);\n    float _min = min(min(color.r, color.g), color.b);\n    float brightness = (_max + _min) * 0.5;\n\n    if(brightness > threshold) {\n        gl_FragColor = color;\n    } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}\n"),this.threshold=t}get threshold(){return this.uniforms.threshold}set threshold(t){this.uniforms.threshold=t}}const _l=class extends mi{constructor(t){super(xl,"uniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D bloomTexture;\nuniform float bloomScale;\nuniform float brightness;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    color.rgb *= brightness;\n    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);\n    bloomColor.rgb *= bloomScale;\n    gl_FragColor = color + bloomColor;\n}\n"),this.bloomScale=1,this.brightness=1,this._resolution=_.FILTER_RESOLUTION,"number"==typeof t&&(t={threshold:t});const e=Object.assign(_l.defaults,t);this.bloomScale=e.bloomScale,this.brightness=e.brightness;const{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._extractFilter=new bl(e.threshold),this._extractFilter.resolution=o,this._blurFilter=i?new vl(i):new vl(r,s),this.pixelSize=n,this.resolution=o}apply(t,e,i,r,s){const n=t.getFilterTexture();this._extractFilter.apply(t,e,n,1,s);const o=t.getFilterTexture();this._blurFilter.apply(t,n,o,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=o,t.applyFilter(this,e,i,r),t.returnFilterTexture(o),t.returnFilterTexture(n)}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._extractFilter&&(this._extractFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};_l.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:_.FILTER_RESOLUTION};const wl=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","uniform float radius;\nuniform float strength;\nuniform vec2 center;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nvoid main()\n{\n    vec2 coord = vTextureCoord * filterArea.xy;\n    coord -= center * dimensions.xy;\n    float distance = length(coord);\n    if (distance < radius) {\n        float percent = distance / radius;\n        if (strength > 0.0) {\n            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n        } else {\n            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n        }\n    }\n    coord += center * dimensions.xy;\n    coord /= filterArea.xy;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    gl_FragColor = color;\n}\n"),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,wl.defaults,t)}apply(t,e,i,r){const{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,t.applyFilter(this,e,i,r)}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get strength(){return this.uniforms.strength}set strength(t){this.uniforms.strength=t}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}};var Tl,Sl;wl.defaults={center:[.5,.5],radius:100,strength:1},(Tl=Tl||{}).stringify=(Sl={"visit_linear-gradient":function(t){return Sl.visit_gradient(t)},"visit_repeating-linear-gradient":function(t){return Sl.visit_gradient(t)},"visit_radial-gradient":function(t){return Sl.visit_gradient(t)},"visit_repeating-radial-gradient":function(t){return Sl.visit_gradient(t)},visit_gradient:function(t){var e=Sl.visit(t.orientation);return e&&(e+=", "),t.type+"("+e+Sl.visit(t.colorStops)+")"},visit_shape:function(t){var e=t.value,i=Sl.visit(t.at),r=Sl.visit(t.style);return r&&(e+=" "+r),i&&(e+=" at "+i),e},"visit_default-radial":function(t){var e="",i=Sl.visit(t.at);return i&&(e+=i),e},"visit_extent-keyword":function(t){var e=t.value,i=Sl.visit(t.at);return i&&(e+=" at "+i),e},"visit_position-keyword":function(t){return t.value},visit_position:function(t){return Sl.visit(t.value.x)+" "+Sl.visit(t.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(t){return Sl.visit_color(t.value,t)},visit_hex:function(t){return Sl.visit_color("#"+t.value,t)},visit_rgb:function(t){return Sl.visit_color("rgb("+t.value.join(", ")+")",t)},visit_rgba:function(t){return Sl.visit_color("rgba("+t.value.join(", ")+")",t)},visit_color:function(t,e){var i=t,r=Sl.visit(e.length);return r&&(i+=" "+r),i},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(t){var e="",i=t.length;return t.forEach((function(t,r){e+=Sl.visit(t),r<i-1&&(e+=", ")})),e},visit:function(t){if(!t)return"";if(t instanceof Array)return Sl.visit_array(t,"");if(t.type){var e=Sl["visit_"+t.type];if(e)return e(t);throw Error("Missing visitor visit_"+t.type)}throw Error("Invalid node.")}},function(t){return Sl.visit(t)}),(Tl=Tl||{}).parse=function(){var t={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function i(t){var i=new Error(e+": "+t);throw i.source=e,i}function r(){return s("linear-gradient",t.linearGradient,o)||s("repeating-linear-gradient",t.repeatingLinearGradient,o)||s("radial-gradient",t.radialGradient,a)||s("repeating-radial-gradient",t.repeatingRadialGradient,a)}function s(e,r,s){return n(r,(function(r){var n=s();return n&&(v(t.comma)||i("Missing comma before color stops")),{type:e,orientation:n,colorStops:d(p)}}))}function n(e,r){var s=v(e);if(s){v(t.startCall)||i("Missing (");var n=r(s);return v(t.endCall)||i("Missing )"),n}}function o(){return y("directional",t.sideOrCorner,1)||y("angular",t.angleValue,1)}function a(){var i,r,s=l();return s&&((i=[]).push(s),r=e,v(t.comma)&&((s=l())?i.push(s):e=r)),i}function l(){var t=function(){var t=y("shape",/^(circle)/i,0);return t&&(t.style=g()||h()),t}()||function(){var t=y("shape",/^(ellipse)/i,0);return t&&(t.style=m()||h()),t}();if(t)t.at=c();else{var e=h();if(e){t=e;var i=c();i&&(t.at=i)}else{var r=u();r&&(t={type:"default-radial",at:r})}}return t}function h(){return y("extent-keyword",t.extentKeywords,1)}function c(){if(y("position",/^at/,0)){var t=u();return t||i("Missing positioning value"),t}}function u(){var t={x:m(),y:m()};if(t.x||t.y)return{type:"position",value:t}}function d(e){var r=e(),s=[];if(r)for(s.push(r);v(t.comma);)(r=e())?s.push(r):i("One extra comma");return s}function p(){var e=y("hex",t.hexColor,1)||n(t.rgbaColor,(function(){return{type:"rgba",value:d(f)}}))||n(t.rgbColor,(function(){return{type:"rgb",value:d(f)}}))||y("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=m(),e}function f(){return v(t.number)[1]}function m(){return y("%",t.percentageValue,1)||y("position-keyword",t.positionKeywords,1)||g()}function g(){return y("px",t.pixelValue,1)||y("em",t.emValue,1)}function y(t,e,i){var r=v(e);if(r)return{type:t,value:r[i]}}function v(t){var i,r;return(r=/^[\n\r\t\s]+/.exec(e))&&x(r[0].length),(i=t.exec(e))&&x(i[0].length),i}function x(t){e=e.substr(t)}return function(t){return e=t.toString(),function(){var t=d(r);return e.length>0&&i("Invalid input not EOF"),t}()}}();var El=Tl.parse;Tl.stringify;var Al={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Cl={red:0,orange:60,yellow:120,green:180,blue:240,purple:300},Pl={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},Rl={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e,i,r,s,n,o=t[0]/360,a=t[1]/100,l=t[2]/100;if(0===a)return[n=255*l,n,n];e=2*l-(i=l<.5?l*(1+a):l+a-l*a),s=[0,0,0];for(var h=0;h<3;h++)(r=o+1/3*-(h-1))<0?r++:r>1&&r--,n=6*r<1?e+6*(i-e)*r:2*r<1?i:3*r<2?e+(i-e)*(2/3-r)*6:e,s[h]=255*n;return s}};function Ml(t){switch(typeof t){case"string":return function(t){const e=function(t){Array.isArray(t)&&t.raw&&(t=String.raw(...arguments));var e,i=function(t){var e,i,r=[],s=1;if("string"==typeof t)if(Al[t])r=Al[t].slice(),i="rgb";else if("transparent"===t)s=0,i="rgb",r=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var n=t.slice(1);s=1,(l=n.length)<=4?(r=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],4===l&&(s=parseInt(n[3]+n[3],16)/255)):(r=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],8===l&&(s=parseInt(n[6]+n[7],16)/255)),r[0]||(r[0]=0),r[1]||(r[1]=0),r[2]||(r[2]=0),i="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var o=e[1],a="rgb"===o;i=n=o.replace(/a$/,"");var l="cmyk"===n?4:"gray"===n?1:3;r=e[2].trim().split(/\s*[,\/]\s*|\s+/).map((function(t,e){if(/%$/.test(t))return e===l?parseFloat(t)/100:"rgb"===n?255*parseFloat(t)/100:parseFloat(t);if("h"===n[e]){if(/deg$/.test(t))return parseFloat(t);if(void 0!==Cl[t])return Cl[t]}return parseFloat(t)})),o===n&&r.push(1),s=a||void 0===r[l]?1:r[l],r=r.slice(0,l)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(r=t.match(/([0-9]+)/g).map((function(t){return parseFloat(t)})),i=t.match(/([a-z])/gi).join("").toLowerCase());else isNaN(t)?Array.isArray(t)||t.length?(r=[t[0],t[1],t[2]],i="rgb",s=4===t.length?t[3]:1):t instanceof Object&&(null!=t.r||null!=t.red||null!=t.R?(i="rgb",r=[t.r||t.red||t.R||0,t.g||t.green||t.G||0,t.b||t.blue||t.B||0]):(i="hsl",r=[t.h||t.hue||t.H||0,t.s||t.saturation||t.S||0,t.l||t.lightness||t.L||t.b||t.brightness]),s=t.a||t.alpha||t.opacity||1,null!=t.opacity&&(s/=100)):(i="rgb",r=[t>>>16,(65280&t)>>>8,255&t]);return{space:i,values:r,alpha:s}}(t);if(!i.space)return[];const r="h"===i.space[0]?Rl.min:Pl.min,s="h"===i.space[0]?Rl.max:Pl.max;return(e=Array(3))[0]=Math.min(Math.max(i.values[0],r[0]),s[0]),e[1]=Math.min(Math.max(i.values[1],r[1]),s[1]),e[2]=Math.min(Math.max(i.values[2],r[2]),s[2]),"h"===i.space[0]&&(e=Rl.rgb(e)),e.push(Math.min(Math.max(i.alpha,0),1)),e}(t);if(!e)throw new Error(`Unable to parse color "${t}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}(t);case"number":return At(t);default:return t}}function Il(t){return Ml(function(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}(t))}function kl(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}Pl.hsl=function(t){var e,i,r=t[0]/255,s=t[1]/255,n=t[2]/255,o=Math.min(r,s,n),a=Math.max(r,s,n),l=a-o;return a===o?e=0:r===a?e=(s-n)/l:s===a?e=2+(n-r)/l:n===a&&(e=4+(r-s)/l),(e=Math.min(60*e,360))<0&&(e+=360),i=(o+a)/2,[e,100*(a===o?0:i<=.5?l/(a+o):l/(2-a-o)),100*i]};var Fl=Object.defineProperty,Dl=Object.defineProperties,Bl=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,Ll=Object.prototype.hasOwnProperty,Nl=Object.prototype.propertyIsEnumerable,Ul=(t,e,i)=>e in t?Fl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Gl=(t,e)=>{for(var i in e||(e={}))Ll.call(e,i)&&Ul(t,i,e[i]);if(Ol)for(var i of Ol(e))Nl.call(e,i)&&Ul(t,i,e[i]);return t};const zl=class extends mi{constructor(t){t&&"css"in t&&(t=((t,e)=>Dl(t,Bl(e)))(Gl({},function(t){const e=El(function(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}(t));if(0===e.length)throw new Error("Invalid CSS gradient.");if(1!==e.length)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");const i=e[0],r=function(t){const e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}(i.type),s=function(t){const e=function(t){const e=[];for(let i=0;i<t.length;i++){const r=t[i];let s=-1;"literal"===r.type&&r.length&&"type"in r.length&&"%"===r.length.type&&"value"in r.length&&(s=parseFloat(r.length.value)/100),e.push(s)}const i=t=>{for(let i=t;i<e.length;i++)if(-1!==e[i])return{indexDelta:i-t,offset:e[i]};return{indexDelta:e.length-1-t,offset:1}};let r=0;for(let t=0;t<e.length;t++){const s=e[t];if(-1!==s)r=s;else if(0===t)e[t]=0;else if(t+1===e.length)e[t]=1;else{const s=i(t),n=(s.offset-r)/(1+s.indexDelta);for(let i=0;i<=s.indexDelta;i++)e[t+i]=r+(i+1)*n;t+=s.indexDelta,r=e[t]}}return e.map(kl)}(t),i=[];for(let r=0;r<t.length;r++){const s=Il(t[r]);i.push({offset:e[r],color:s.slice(0,3),alpha:s[3]})}return i}(i.colorStops),n=function(t){if(void 0===t)return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return function(t){const e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}(t.value)}return 0}(i.orientation);return{type:r,stops:s,angle:n}}(t.css||"")),{alpha:t.alpha,maxColors:t.maxColors}));const e=Gl(Gl({},zl.defaults),t);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;\n}\n","const float PI = 3.1415926538;\nconst float PI_2 = PI*2.;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nuniform sampler2D uSampler;\n\nconst int TYPE_LINEAR = 0;\nconst int TYPE_RADIAL = 1;\nconst int TYPE_CONIC = 2;\nconst int MAX_STOPS = 32;\n\nuniform int uNumStops;\nuniform float uAlphas[3*MAX_STOPS];\nuniform vec3 uColors[MAX_STOPS];\nuniform float uOffsets[MAX_STOPS];\nuniform int uType;\nuniform float uAngle;\nuniform float uAlpha;\nuniform int uMaxColors;\n\nstruct ColorStop {\n    float offset;\n    vec3 color;\n    float alpha;\n};\n\nmat2 rotate2d(float angle){\n    return mat2(cos(angle), -sin(angle),\n    sin(angle), cos(angle));\n}\n\nfloat projectLinearPosition(vec2 pos, float angle){\n    vec2 center = vec2(0.5);\n    vec2 result = pos - center;\n    result = rotate2d(angle) * result;\n    result = result + center;\n    return clamp(result.x, 0., 1.);\n}\n\nfloat projectRadialPosition(vec2 pos) {\n    float r = distance(vFilterCoord, vec2(0.5));\n    return clamp(2.*r, 0., 1.);\n}\n\nfloat projectAnglePosition(vec2 pos, float angle) {\n    vec2 center = pos - vec2(0.5);\n    float polarAngle=atan(-center.y, center.x);\n    return mod(polarAngle + angle, PI_2) / PI_2;\n}\n\nfloat projectPosition(vec2 pos, int type, float angle) {\n    if (type == TYPE_LINEAR) {\n        return projectLinearPosition(pos, angle);\n    } else if (type == TYPE_RADIAL) {\n        return projectRadialPosition(pos);\n    } else if (type == TYPE_CONIC) {\n        return projectAnglePosition(pos, angle);\n    }\n\n    return pos.y;\n}\n\nvoid main(void) {\n    // current/original color\n    vec4 currentColor = texture2D(uSampler, vTextureCoord);\n\n    // skip calculations if gradient alpha is 0\n    if (0.0 == uAlpha) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // project position\n    float y = projectPosition(vFilterCoord, uType, radians(uAngle));\n\n    // check gradient bounds\n    float offsetMin = uOffsets[0];\n    float offsetMax = 0.0;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (i == uNumStops-1){ // last index\n            offsetMax = uOffsets[i];\n        }\n    }\n\n    if (y  < offsetMin || y > offsetMax) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // limit colors\n    if (uMaxColors > 0) {\n        float stepSize = 1./float(uMaxColors);\n        float stepNumber = float(floor(y/stepSize));\n        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment\n    }\n\n    // find color stops\n    ColorStop from;\n    ColorStop to;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (y >= uOffsets[i]) {\n            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);\n            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);\n        }\n\n        if (i == uNumStops-1){ // last index\n            break;\n        }\n    }\n\n    // mix colors from stops\n    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);\n    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);\n\n    float segmentHeight = to.offset - from.offset;\n    float relativePos = y - from.offset;// position from 0 to [segmentHeight]\n    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].\n\n    float gradientAlpha = uAlpha * currentColor.a;\n    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n    // mix resulting color with current color\n    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);\n}\n"),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(t){const e=function(t){return[...t].sort(((t,e)=>t.offset-e.offset))}(t),i=new Float32Array(3*e.length);for(let t=0;t<e.length;t++){const r=Ml(e[t].color),s=3*t;i[s+0]=r[0],i[s+1]=r[1],i[s+2]=r[2]}this.uniforms.uColors=i,this.uniforms.uOffsets=e.map((t=>t.offset)),this.uniforms.uAlphas=e.map((t=>t.alpha)),this.uniforms.uNumStops=e.length,this._stops=e}set type(t){this.uniforms.uType=t}get type(){return this.uniforms.uType}set angle(t){this.uniforms.uAngle=t-90}get angle(){return this.uniforms.uAngle+90}set alpha(t){this.uniforms.uAlpha=t}get alpha(){return this.uniforms.uAlpha}set maxColors(t){this.uniforms.uMaxColors=t}get maxColors(){return this.uniforms.uMaxColors}};let jl=zl;jl.LINEAR=0,jl.RADIAL=1,jl.CONIC=2,jl.defaults={type:zl.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};const Hl=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nconst float SQRT_2 = 1.414213;\n\nconst float light = 1.0;\n\nuniform float curvature;\nuniform float lineWidth;\nuniform float lineContrast;\nuniform bool verticalLine;\nuniform float noise;\nuniform float noiseSize;\n\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\n\nuniform float seed;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));\n    \n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 rgb = gl_FragColor.rgb;\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        rgb += _noise * noise;\n    }\n\n    if (lineWidth > 0.0)\n    {\n        float _c = curvature > 0. ? curvature : 1.;\n        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;\n        vec2 uv = dir * k;\n\n        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;\n        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;\n        rgb *= j;\n        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);\n        rgb *= 0.99 + ceil(segment) * 0.015;\n    }\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    gl_FragColor.rgb = rgb;\n}\n"),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Hl.defaults,t)}apply(t,e,i,r){const{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.seed=this.seed,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set curvature(t){this.uniforms.curvature=t}get curvature(){return this.uniforms.curvature}set lineWidth(t){this.uniforms.lineWidth=t}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(t){this.uniforms.lineContrast=t}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(t){this.uniforms.verticalLine=t}get verticalLine(){return this.uniforms.verticalLine}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};Hl.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var Vl=Object.defineProperty,Wl=Object.getOwnPropertySymbols,Xl=Object.prototype.hasOwnProperty,$l=Object.prototype.propertyIsEnumerable,Yl=(t,e,i)=>e in t?Vl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ql=(t,e)=>{for(var i in e||(e={}))Xl.call(e,i)&&Yl(t,i,e[i]);if(Wl)for(var i of Wl(e))$l.call(e,i)&&Yl(t,i,e[i]);return t};const Zl=class extends mi{constructor(t){super(),this.angle=45,this._distance=5,this._resolution=_.FILTER_RESOLUTION;const e=t?ql(ql({},Zl.defaults),t):Zl.defaults,{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._offset=new ze(this._updatePadding,this),this._tintFilter=new mi("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform vec3 color;\n\nuniform vec2 shift;\nuniform vec4 inputSize;\n\nvoid main(void){\n    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = color.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= alpha;\n\n    gl_FragColor = sample;\n}"),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=o,this._blurFilter=i?new vl(i):new vl(r,s),this.pixelSize=n,this.resolution=o;const{shadowOnly:a,rotation:l,distance:h,offset:c,alpha:u,color:d}=e;this.shadowOnly=a,void 0!==l&&void 0!==h?(this.rotation=l,this.distance=h):this.offset=c,this.alpha=u,this.color=d}apply(t,e,i,r){const s=t.getFilterTexture();this._tintFilter.apply(t,e,s,1),this._blurFilter.apply(t,s,i,r),!0!==this.shadowOnly&&t.applyFilter(this,e,i,0),t.returnFilterTexture(s)}_updatePadding(){const t=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=t+2*this.blur}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(t){this._offset.copyFrom(t),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get distance(){return this._distance}set distance(t){Y("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=t,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/Te}set rotation(t){Y("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=t*Te,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(t){this._tintFilter.uniforms.alpha=t}get color(){return Ct(this._tintFilter.uniforms.color)}set color(t){At(t,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};Zl.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:_.FILTER_RESOLUTION};const Kl=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","// precision highp float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\nuniform float aspect;\n\nuniform sampler2D displacementMap;\nuniform float offset;\nuniform float sinDir;\nuniform float cosDir;\nuniform int fillMode;\n\nuniform float seed;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nconst int TRANSPARENT = 0;\nconst int ORIGINAL = 1;\nconst int LOOP = 2;\nconst int CLAMP = 3;\nconst int MIRROR = 4;\n\nvoid main(void)\n{\n    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n        return;\n    }\n\n    float cx = coord.x - 0.5;\n    float cy = (coord.y - 0.5) * aspect;\n    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;\n\n    // displacementMap: repeat\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\n\n    // displacementMap: mirror\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\n\n    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));\n\n    float displacement = (dc.r - dc.g) * (offset / filterArea.x);\n\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);\n\n    if (fillMode == CLAMP) {\n        coord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    } else {\n        if( coord.x > filterClamp.z ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x -= filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x = filterClamp.z * 2.0 - coord.x;\n            }\n        } else if( coord.x < filterClamp.x ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x += filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x *= -filterClamp.z;\n            }\n        }\n\n        if( coord.y > filterClamp.w ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y -= filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y = filterClamp.w * 2.0 - coord.y;\n            }\n        } else if( coord.y < filterClamp.y ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y += filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y *= -filterClamp.w;\n            }\n        }\n    }\n\n    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;\n    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;\n    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;\n    gl_FragColor.a = texture2D(uSampler, coord).a;\n}\n"),this.offset=100,this.fillMode=Kl.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=Pi.from(this._canvas,{scaleMode:c.NEAREST}),Object.assign(this,Kl.defaults,t)}apply(t,e,i,r){const{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,t.applyFilter(this,e,i,r)}_randomizeSizes(){const t=this._sizes,e=this._slices-1,i=this.sampleSize,r=Math.min(this.minSize/i,.9/this._slices);if(this.average){const i=this._slices;let s=1;for(let n=0;n<e;n++){const e=s/(i-n),o=Math.max(e*(1-.6*Math.random()),r);t[n]=o,s-=o}t[e]=s}else{let i=1;const s=Math.sqrt(1/this._slices);for(let n=0;n<e;n++){const e=Math.max(s*i*Math.random(),r);t[n]=e,i-=e}t[e]=i}this.shuffle()}shuffle(){const t=this._sizes;for(let e=this._slices-1;e>0;e--){const i=Math.random()*e>>0,r=t[e];t[e]=t[i],t[i]=r}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){const t=this.sampleSize,e=this.texture,i=this._canvas.getContext("2d");i.clearRect(0,0,8,t);let r,s=0;for(let e=0;e<this._slices;e++){r=Math.floor(256*this._offsets[e]);const n=this._sizes[e]*t,o=r>0?r:0,a=r<0?-r:0;i.fillStyle=`rgba(${o}, ${a}, 0, 1)`,i.fillRect(0,s>>0,t,n+1>>0),s+=n}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(t){const e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._sizes[i]=t[i]}get sizes(){return this._sizes}set offsets(t){const e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._offsets[i]=t[i]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this.uniforms.slices=t,this._sizes=this.uniforms.slicesWidth=new Float32Array(t),this._offsets=this.uniforms.slicesOffset=new Float32Array(t),this.refresh())}get direction(){return this._direction}set direction(t){if(this._direction===t)return;this._direction=t;const e=t*Te;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(t){this.uniforms.red=t}get green(){return this.uniforms.green}set green(t){this.uniforms.green=t}get blue(){return this.uniforms.blue}set blue(t){this.uniforms.blue=t}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}};let Jl=Kl;Jl.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},Jl.TRANSPARENT=0,Jl.ORIGINAL=1,Jl.LOOP=2,Jl.CLAMP=3,Jl.MIRROR=4;const Ql=class extends mi{constructor(t){const e=Object.assign({},Ql.defaults,t),{outerStrength:i,innerStrength:r,color:s,knockout:n,quality:o,alpha:a}=e,l=Math.round(e.distance);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform float outerStrength;\nuniform float innerStrength;\n\nuniform vec4 glowColor;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform bool knockout;\nuniform float alpha;\n\nconst float PI = 3.14159265358979323846264;\n\nconst float DIST = __DIST__;\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);\nconst float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);\n\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;\n\nvoid main(void) {\n    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n\n    float totalAlpha = 0.0;\n\n    vec2 direction;\n    vec2 displaced;\n    vec4 curColor;\n\n    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {\n       direction = vec2(cos(angle), sin(angle)) * px;\n\n       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {\n           displaced = clamp(vTextureCoord + direction * \n                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);\n\n           curColor = texture2D(uSampler, displaced);\n\n           totalAlpha += (DIST - curDistance) * curColor.a;\n       }\n    }\n    \n    curColor = texture2D(uSampler, vTextureCoord);\n\n    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);\n\n    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;\n    float innerGlowStrength = min(1.0, innerGlowAlpha);\n    \n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\n\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);\n    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);\n\n    if (knockout) {\n      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;\n      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\n    }\n    else {\n      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;\n      gl_FragColor = innerColor + outerGlowColor;\n    }\n}\n".replace(/__ANGLE_STEP_SIZE__/gi,`${(1/o/l).toFixed(7)}`).replace(/__DIST__/gi,`${l.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:s,outerStrength:i,innerStrength:r,padding:l,knockout:n,alpha:a})}get color(){return Ct(this.uniforms.glowColor)}set color(t){At(t,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(t){this.uniforms.outerStrength=t}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(t){this.uniforms.innerStrength=t}get knockout(){return this.uniforms.knockout}set knockout(t){this.uniforms.knockout=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};let th=Ql;th.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};const eh=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform vec2 light;\nuniform bool parallel;\nuniform float aspect;\n\nuniform float gain;\nuniform float lacunarity;\nuniform float time;\nuniform float alpha;\n\n${perlin}\n\nvoid main(void) {\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    float d;\n\n    if (parallel) {\n        float _cos = light.x;\n        float _sin = light.y;\n        d = (_cos * coord.x) + (_sin * coord.y * aspect);\n    } else {\n        float dx = coord.x - light.x / dimensions.x;\n        float dy = (coord.y - light.y / dimensions.y) * aspect;\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\n        d = dy / dis;\n    }\n\n    vec3 dir = vec3(d, d, 0.0);\n\n    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\n    noise = mix(noise, 0.0, 0.3);\n    //fade vertically.\n    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);\n    mist.a = 1.0;\n    // apply user alpha\n    mist *= alpha;\n\n    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;\n\n}\n".replace("${perlin}","vec3 mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x)\n{\n    return mod289(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec3 fade(vec3 t)\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\n{\n    float sum = 0.0;\n    float sc = 1.0;\n    float totalgain = 1.0;\n    for (float i = 0.0; i < 6.0; i++)\n    {\n        sum += totalgain * pnoise(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}\n")),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);const e=Object.assign(eh.defaults,t);this._angleLight=new Ee,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(t,e,i,r){const{width:s,height:n}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,i,r)}get angle(){return this._angle}set angle(t){this._angle=t;const e=t*Te;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(t){this.uniforms.gain=t}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(t){this.uniforms.lacunarity=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};eh.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};const ih=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uHue;\nuniform float uAlpha;\nuniform bool uColorize;\nuniform float uSaturation;\nuniform float uLightness;\n\n// https://en.wikipedia.org/wiki/Luma_(video)\nconst vec3 weight = vec3(0.299, 0.587, 0.114);\n\nfloat getWeightedAverage(vec3 rgb) {\n    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst vec3 k = vec3(0.57735, 0.57735, 0.57735);\n\nvec3 hueShift(vec3 color, float angle) {\n    float cosAngle = cos(angle);\n    return vec3(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    vec4 result = color;\n\n    // colorize\n    if (uColorize) {\n        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);\n    }\n\n    // hue\n    result.rgb = hueShift(result.rgb, uHue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    float average = (result.r + result.g + result.b) / 3.0;\n\n    if (uSaturation > 0.) {\n        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));\n    } else {\n        result.rgb -= (average - result.rgb) * uSaturation;\n    }\n\n    // lightness\n    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));\n\n    // alpha\n    gl_FragColor = mix(color, result, uAlpha);\n}\n"),this._hue=0;const e=Object.assign({},ih.defaults,t);Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get colorize(){return this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t}get lightness(){return this.uniforms.uLightness}set lightness(t){this.uniforms.uLightness=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}};ih.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};const rh=class extends mi{constructor(t,e=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform float sepia;\nuniform float noise;\nuniform float noiseSize;\nuniform float scratch;\nuniform float scratchDensity;\nuniform float scratchWidth;\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\nuniform float seed;\n\nconst float SQRT_2 = 1.414213;\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec3 Overlay(vec3 src, vec3 dst)\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\n\n\nvoid main()\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 color = gl_FragColor.rgb;\n\n    if (sepia > 0.0)\n    {\n        float gray = (color.x + color.y + color.z) / 3.0;\n        vec3 grayscale = vec3(gray);\n\n        color = Overlay(SEPIA_RGB, grayscale);\n\n        color = grayscale + sepia * (color - grayscale);\n    }\n\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\n        dir.y *= dimensions.y / dimensions.x;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    if (scratchDensity > seed && scratch != 0.0)\n    {\n        float phase = seed * 256.0;\n        float s = mod(floor(phase), 2.0);\n        float dist = 1.0 / scratchDensity;\n        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));\n        if (d < seed * 0.6 + 0.4)\n        {\n            highp float period = scratchDensity * 10.0;\n\n            float xx = coord.x * period + phase;\n            float aa = abs(mod(xx, 0.5) * 4.0);\n            float bb = mod(floor(xx / 0.5), 2.0);\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n            float kk = 2.0 * period;\n            float dw = scratchWidth / dimensions.x * (0.75 + seed);\n            float dh = dw * kk;\n\n            float tine = (yy - (2.0 - dh));\n\n            if (tine > 0.0) {\n                float _sign = sign(scratch);\n\n                tine = s * tine / period + scratch + 0.1;\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n                color.rgb *= tine;\n            }\n        }\n    }\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);\n        // float _noise = snoise(d) * 0.5;\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        color += _noise * noise;\n    }\n\n    gl_FragColor.rgb = color;\n}\n"),this.seed=0,this.uniforms.dimensions=new Float32Array(2),"number"==typeof t?(this.seed=t,t=void 0):this.seed=e,Object.assign(this,rh.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=null==(s=e.filterFrame)?void 0:s.width,this.uniforms.dimensions[1]=null==(n=e.filterFrame)?void 0:n.height,this.uniforms.seed=this.seed,t.applyFilter(this,e,i,r)}set sepia(t){this.uniforms.sepia=t}get sepia(){return this.uniforms.sepia}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set scratch(t){this.uniforms.scratch=t}get scratch(){return this.uniforms.scratch}set scratchDensity(t){this.uniforms.scratchDensity=t}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(t){this.uniforms.scratchWidth=t}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};rh.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};const sh=class extends mi{constructor(t=1,e=0,i=.1,r=1,s=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nuniform float uAlpha;\nuniform vec2 uThickness;\nuniform vec4 uColor;\nuniform bool uKnockout;\n\nconst float DOUBLE_PI = 2. * 3.14159265358979323846264;\nconst float ANGLE_STEP = ${angleStep};\n\nfloat outlineMaxAlphaAtPos(vec2 pos) {\n    if (uThickness.x == 0. || uThickness.y == 0.) {\n        return 0.;\n    }\n\n    vec4 displacedColor;\n    vec2 displacedPos;\n    float maxAlpha = 0.;\n\n    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {\n        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);\n        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);\n        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));\n        maxAlpha = max(maxAlpha, displacedColor.a);\n    }\n\n    return maxAlpha;\n}\n\nvoid main(void) {\n    vec4 sourceColor = texture2D(uSampler, vTextureCoord);\n    vec4 contentColor = sourceColor * float(!uKnockout);\n    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);\n    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);\n    gl_FragColor = contentColor + outlineColor;\n}\n".replace(/\$\{angleStep\}/,sh.getAngleStep(i))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=r,this.uniforms.uKnockout=s,Object.assign(this,{thickness:t,color:e,quality:i,alpha:r,knockout:s})}static getAngleStep(t){const e=Math.max(t*sh.MAX_SAMPLES,sh.MIN_SAMPLES);return(2*Math.PI/e).toFixed(7)}apply(t,e,i,r){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,t.applyFilter(this,e,i,r)}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get color(){return Ct(this.uniforms.uColor)}set color(t){At(t,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(t){this._knockout=t}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this.padding=t}};let nh=sh;nh.MIN_SAMPLES=1,nh.MAX_SAMPLES=100;const oh=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nuniform bool mirror;\nuniform float boundary;\nuniform vec2 amplitude;\nuniform vec2 waveLength;\nuniform vec2 alpha;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 coord = pixelCoord / dimensions;\n\n    if (coord.y < boundary) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    float k = (coord.y - boundary) / (1. - boundary + 0.0001);\n    float areaY = boundary * dimensions.y / filterArea.y;\n    float v = areaY + areaY - vTextureCoord.y;\n    float y = mirror ? v : vTextureCoord.y;\n\n    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;\n    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;\n    float _alpha = (alpha.y - alpha.x) * k + alpha.x;\n\n    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;\n    x = clamp(x, filterClamp.x, filterClamp.z);\n\n    vec4 color = texture2D(uSampler, vec2(x, y));\n\n    gl_FragColor = color * _alpha;\n}\n"),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,oh.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=null==(s=e.filterFrame)?void 0:s.width,this.uniforms.dimensions[1]=null==(n=e.filterFrame)?void 0:n.height,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set mirror(t){this.uniforms.mirror=t}get mirror(){return this.uniforms.mirror}set boundary(t){this.uniforms.boundary=t}get boundary(){return this.uniforms.boundary}set amplitude(t){this.uniforms.amplitude[0]=t[0],this.uniforms.amplitude[1]=t[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(t){this.uniforms.waveLength[0]=t[0],this.uniforms.waveLength[1]=t[1]}get waveLength(){return this.uniforms.waveLength}set alpha(t){this.uniforms.alpha[0]=t[0],this.uniforms.alpha[1]=t[1]}get alpha(){return this.uniforms.alpha}};oh.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};const ah=class extends mi{constructor(t=[0,0],e,i=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nuniform vec2 center;\n\nuniform float amplitude;\nuniform float wavelength;\n// uniform float power;\nuniform float brightness;\nuniform float speed;\nuniform float radius;\n\nuniform float time;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float halfWavelength = wavelength * 0.5 / filterArea.x;\n    float maxRadius = radius / filterArea.x;\n    float currentRadius = time * speed / filterArea.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);\n    dir.y *= filterArea.y / filterArea.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );\n\n    vec2 offset = diffUV * powDiff / filterArea.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;\n\n    gl_FragColor = color;\n}\n"),this.center=t,Object.assign(this,ah.defaults,e),this.time=i}apply(t,e,i,r){this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}get amplitude(){return this.uniforms.amplitude}set amplitude(t){this.uniforms.amplitude=t}get wavelength(){return this.uniforms.wavelength}set wavelength(t){this.uniforms.wavelength=t}get brightness(){return this.uniforms.brightness}set brightness(t){this.uniforms.brightness=t}get speed(){return this.uniforms.speed}set speed(t){this.uniforms.speed=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}};ah.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};class lh extends mi{constructor(t){var e,i;super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    color /= total;\n    color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n"),this.uniforms.blur=t.blur,this.uniforms.gradientBlur=t.gradientBlur,this.uniforms.start=null!=(e=t.start)?e:new Ee(0,window.innerHeight/2),this.uniforms.end=null!=(i=t.end)?i:new Ee(600,window.innerHeight/2),this.uniforms.delta=new Ee(30,30),this.uniforms.texSize=new Ee(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(t){this.uniforms.blur=t}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(t){this.uniforms.gradientBlur=t}get start(){return this.uniforms.start}set start(t){this.uniforms.start=t,this.updateDelta()}get end(){return this.uniforms.end}set end(t){this.uniforms.end=t,this.updateDelta()}}class hh extends lh{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.x=t/i,this.uniforms.delta.y=e/i}}class ch extends lh{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.x=-e/i,this.uniforms.delta.y=t/i}}const uh=class extends mi{constructor(t,e,i,r){super(),"number"==typeof t&&(Y("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),t={blur:t,gradientBlur:e,start:i,end:r}),t=Object.assign({},uh.defaults,t),this.tiltShiftXFilter=new hh(t),this.tiltShiftYFilter=new ch(t)}apply(t,e,i,r){const s=t.getFilterTexture();this.tiltShiftXFilter.apply(t,e,s,1),this.tiltShiftYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}get blur(){return this.tiltShiftXFilter.blur}set blur(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}get start(){return this.tiltShiftXFilter.start}set start(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}get end(){return this.tiltShiftXFilter.end}set end(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}};uh.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};const dh=class extends mi{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform vec4 filterArea;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvec2 twist(vec2 coord)\n{\n    coord -= offset;\n\n    float dist = length(coord);\n\n    if (dist < radius)\n    {\n        float ratioDist = (radius - dist) / radius;\n        float angleMod = ratioDist * ratioDist * angle;\n        float s = sin(angleMod);\n        float c = cos(angleMod);\n        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n    }\n\n    coord += offset;\n\n    return coord;\n}\n\nvoid main(void)\n{\n\n    vec2 coord = mapCoord(vTextureCoord);\n\n    coord = twist(coord);\n\n    coord = unmapCoord(coord);\n\n    gl_FragColor = texture2D(uSampler, coord );\n\n}\n"),Object.assign(this,dh.defaults,t)}get offset(){return this.uniforms.offset}set offset(t){this.uniforms.offset=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get angle(){return this.uniforms.angle}set angle(t){this.uniforms.angle=t}};dh.defaults={radius:200,angle:4,padding:20,offset:new Ee};var ph=Object.getOwnPropertySymbols,fh=Object.prototype.hasOwnProperty,mh=Object.prototype.propertyIsEnumerable;const gh=class extends mi{constructor(t){const e=Object.assign(gh.defaults,t),{maxKernelSize:i}=e,r=((t,e)=>{var i={};for(var r in t)fh.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&ph)for(var r of ph(t))e.indexOf(r)<0&&mh.call(t,r)&&(i[r]=t[r]);return i})(e,["maxKernelSize"]);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform vec2 uCenter;\nuniform float uStrength;\nuniform float uInnerRadius;\nuniform float uRadius;\n\nconst float MAX_KERNEL_SIZE = ${maxKernelSize};\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand(vec2 co, float seed) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);\n    return fract(sin(sn) * c + seed);\n}\n\nvoid main() {\n\n    float minGradient = uInnerRadius * 0.3;\n    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;\n\n    float gradient = uRadius * 0.3;\n    float radius = (uRadius - gradient * 0.5) / filterArea.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / filterArea.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = rand(vTextureCoord, 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture2D(uSampler, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    // color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n".replace("${maxKernelSize}",i.toFixed(1))),Object.assign(this,r)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(t){this.uniforms.uInnerRadius=t}get radius(){return this.uniforms.uRadius}set radius(t){(t<0||t===1/0)&&(t=-1),this.uniforms.uRadius=t}};gh.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};const yh=gl.red;let vh=0,xh=0;const bh=new th;bh.color=16711680,bh.outerStrength=1,bh.innerStrength=1,bh.alpha=.5;const _h=[yl,bh];let wh=0;const Th=new class extends mi{constructor(t,e=.05,i=t.length){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float epsilon;\n\nconst int MAX_COLORS = %maxColors%;\n\nuniform vec3 originalColors[MAX_COLORS];\nuniform vec3 targetColors[MAX_COLORS];\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    float alpha = gl_FragColor.a;\n    if (alpha < 0.0001)\n    {\n      return;\n    }\n\n    vec3 color = gl_FragColor.rgb / alpha;\n\n    for(int i = 0; i < MAX_COLORS; i++)\n    {\n      vec3 origColor = originalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      vec3 colorDiff = origColor - color;\n      if (length(colorDiff) < epsilon)\n      {\n        vec3 targetColor = targetColors[i];\n        gl_FragColor = vec4((targetColor + colorDiff) * alpha, alpha);\n        return;\n      }\n    }\n}\n".replace(/%maxColors%/g,i.toFixed(0))),this._replacements=[],this._maxColors=0,this.epsilon=e,this._maxColors=i,this.uniforms.originalColors=new Float32Array(3*i),this.uniforms.targetColors=new Float32Array(3*i),this.replacements=t}set replacements(t){const e=this.uniforms.originalColors,i=this.uniforms.targetColors,r=t.length;if(r>this._maxColors)throw new Error(`Length of replacements (${r}) exceeds the maximum colors length (${this._maxColors})`);e[3*r]=-1;for(let s=0;s<r;s++){const r=t[s];let n=r[0];"number"==typeof n?n=At(n):r[0]=Ct(n),e[3*s]=n[0],e[3*s+1]=n[1],e[3*s+2]=n[2];let o=r[1];"number"==typeof o?o=At(o):r[1]=Ct(o),i[3*s]=o[0],i[3*s+1]=o[1],i[3*s+2]=o[2]}this._replacements=t}get replacements(){return this._replacements}refresh(){this.replacements=this._replacements}get maxColors(){return this._maxColors}set epsilon(t){this.uniforms.epsilon=t}get epsilon(){return this.uniforms.epsilon}}([[11874592,16711680],[15375906,65280],[7040256,255]],.1),Sh=new th;Sh.alpha=.9;const Eh=[Th,Sh],Ah=new th;Ah.color=16711680,Ah.innerStrength=1;const Ch=[Th,Ah];function Ph(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function Rh(t,e,i){let r,s,n;if(0===e)r=s=n=i;else{const o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;r=Ph(a,o,t+1/3),s=Ph(a,o,t),n=Ph(a,o,t-1/3)}const{round:o}=Math;return[o(255*r),o(255*s),o(255*n)]}function Mh(t){var e,i;vh=(vh+t*Math.PI)%(2*Math.PI),xh=.2*Math.sin(vh),gl.red=xh*yh+yh;const r=wh;if(wh=(vh+t)%.8,r>wh){let t=0;for(const e of Th.replacements)e[1]=Rh(Math.random(),(3-t)/3,(3-t)/3.5).map((t=>t/255)),t++;Th.refresh()}for(const r of fl.view(["mario","smb1MarioAnimations"])){const s=r.smb1MarioAnimations,n=r.mario,o=null===(e=r.dynamic)||void 0===e?void 0:e.velocity,a=null===(i=r.dynamic)||void 0===i?void 0:i.acceleration,l=o?Math.abs(o.x):0,h=a?Math.abs(a.x):0,c=l<2*Number.EPSILON&&h<2*Number.EPSILON;if(s&&n){if(n.star&&"fire"===n.powerup?r.filters!==Ch&&(r.filters=Ch):n.star?r.filters!==Eh&&(r.filters=Eh):"fire"===n.powerup?r.filters!==_h&&(r.filters=_h):r.filters&&delete r.filters,s.container.scale.x=n.facing,n.grounded?s.loopsPerSecond=c?0:l/16:s.loopsPerSecond=0,!n.grounded&&r.underwater)s.loopsPerSecond=3,n.jumped?(n.big?n.shooting?s.setAnimation("bigShootIdle"):s.setAnimation("bigSwimStroke"):s.setAnimation("smallSwimStroke"),n.swimLoops=2):n.swimLoops?(s.didLoop()&&(n.swimLoops-=1),n.big?n.shooting?s.setAnimation("bigShootIdle"):s.setAnimation("bigSwimStroke"):s.setAnimation("smallSwimStroke")):n.big?n.shooting?s.setAnimation("bigShootIdle"):s.setAnimation("bigSwim"):s.setAnimation("smallSwim");else if(n.swimLoops=0,n.ducking||n.forcedDucking)n.big?s.setAnimation("bigDuck"):s.setAnimation("smallDie");else if(n.jumping)n.big?n.shooting?s.setAnimation("bigShootJump"):s.setAnimation("bigJump"):s.setAnimation("smallJump");else if(n.skidding)n.big?n.shooting?s.setAnimation("bigShootSkid"):s.setAnimation("bigSkid"):s.setAnimation("smallSkid"),s.container.scale.x=-n.facing;else if(c&&n.grounded)n.big?n.shooting?s.setAnimation("bigShootIdle"):s.setAnimation("bigIdle"):s.setAnimation("smallIdle");else{const t=s.getAnimation();"bigWalk"!==t&&"bigShootWalk"!==t&&"smallWalk"!==t&&s.setFrame(.8),n.big?n.shooting?s.setAnimation("bigShootWalk"):s.setAnimation("bigWalk"):s.setAnimation("smallWalk")}s.update(t)}}}const Ih=ul(),kh={stopPrev:{same:!0}};function Fh(){for(const t of fl.view(["mario"])){const e=t.mario;e&&(e.jumped&&(t.underwater?Ih.sounds.play("stomp",kh):e.big?Ih.sounds.play("jumpBig"):Ih.sounds.play("jumpSmall")),e.changedSize&&(e.big?Ih.sounds.play("powerup"):Ih.sounds.play("pipe")),e.gainedPow&&Ih.sounds.play("powerup"),e.shot&&Ih.sounds.play("fireball"),e.gainedOneUp&&Ih.sounds.play("oneUp"))}for(const t of fl.view(["bonk"]))t.bonk&&!t.smash&&Ih.sounds.play("bump");for(const t of fl.view(["smash"]))t.smash&&Ih.sounds.play("breakblock")}fl.onAdding(["coinFromBlockLife"],(()=>{Ih.sounds.play("coin")}));const Dh=new Pi(new ce),Bh=[Dh];class Oh{constructor(){this.ready=!0,this.readyPromise=Promise.resolve()}isReady(){return this.ready}whenReady(){return this.readyPromise}}class Lh extends Oh{constructor(){super(),this.container=new is,this.durlCache=new Map,this.container.cullable=!0,this.sprite=new ns(Dh),this.container.addChild(this.sprite)}getDataUrl(){var t,e;const i=this.durlCache.get(this.sprite.texture);if(i)return i;const r=null===(e=(t=Ca.renderer.extract.canvas(this.sprite)).toDataURL)||void 0===e?void 0:e.call(t);return r&&this.durlCache.set(this.sprite.texture,r),r}}class Nh extends Lh{static from(t,e,i){const r={};if(t.isReady())return e.forEach((e=>r[e]=t.getAnimation(e))),new Nh(r,i);{const s=new Nh(r,i);return s.ready=!1,s.readyPromise=t.parse().then((()=>{e.forEach((e=>r[e]=t.getAnimation(e))),s.load(r),s.ready=!0})),s}}load(t){for(const[e,i]of Object.entries(t))this.textures[e]=i;this.forceSetAnimation(this.animation)}constructor(t,e){super(),this.index=0,this.frames=[],this.looped=!1,this.anchors=new Map,this.loopsPerSecond=1,this.textures=t,this.animation=e,this.forceSetAnimation(this.animation)}setAnimationAnchor(t,e){this.anchors.set(t,e)}forceSetAnimation(t){this.animation=t.toString()+"s",this.setAnimation(t)}setAnimation(t){var e;if(this.animation===t)return!1;const i=this.anchors.get(t);return i?this.sprite.anchor.set(i.x,i.y):this.sprite.anchor.set(.5),this.frames=null!==(e=this.textures[t])&&void 0!==e?e:[],this.animation=t,this.updateTexture(),!0}getAnimation(){return this.animation}getFrames(){return this.frames.length}setFrame(t){this.index=t,this.updateTexture()}getFrame(){return Math.floor(this.index)}getFramesPerSecond(){return this.loopsPerSecond*this.frames.length}setFramesPerSecond(t){this.frames.length&&(this.loopsPerSecond=t/this.frames.length)}update(t){this.looped=!1,this.index+=t*this.getFramesPerSecond();const e=this.index;this.updateTexture(),e!==this.index&&(this.looped=!0)}didLoop(){return this.looped}updateTexture(){this.index%=this.frames.length||1;const t=this.frames[Math.floor(this.index)];t&&(this.sprite.texture=t)}}function Uh(t){const e=t.toString();return e.includes(".")?e:e+".0"}class Gh extends Oh{constructor(t,e,i){var r,s;super(),this.transparencyCache=new WeakMap,this.resolveReady=()=>{},this.unparsed=!0,this.ready=!1,this.readyPromise=new Promise((t=>{this.resolveReady=t})),this.src=t,this.json={frames:{},meta:{scale:"1"}};for(const[t,i]of Object.entries(e.frames))this.json.frames[t]={frame:i};if(this.frames=[...Object.keys(null!==(r=e.frames)&&void 0!==r?r:{})],this.animations=[...Object.keys(null!==(s=e.animations)&&void 0!==s?s:{})],e.animations){this.json.animations={};for(const[t,i]of Object.entries(e.animations)){const e=[];this.json.animations[t]=e,i.forEach((t=>{"string"==typeof t&&e.push(t)}))}}this.transparency=e.transparency,this.setFilters(i)}setFilters(t){if(this.transparency){let e;if(e=this.transparencyCache.get(this.transparency),!e){const t=this.transparency.map((t=>`(c.x >= ${Uh(t.r.from)} && c.x <= ${Uh(t.r.to)} && c.y >= ${Uh(t.g.from)} && c.y <= ${Uh(t.g.to)} && c.z >= ${Uh(t.b.from)} && c.z <= ${Uh(t.b.to)})`)).join("||");e=new mi(void 0,`\n        varying vec2 vTextureCoord;\n        uniform sampler2D uSampler;\n        void main(void)\n        {\n          vec4 c = texture2D(uSampler, vTextureCoord);\n          if (\n            ${t}\n          ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,0.0);\n          } else {\n            gl_FragColor = c;\n          }\n        }\n        `)}e&&(this.filters=[e,...null!=t?t:[]])}else this.filters=t}parse(){var t,e,i,r;return function(t,e,i,r){return new(i||(i=Promise))((function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){if(this.ready)return;if(!this.unparsed)return yield this.readyPromise;this.unparsed=!1;const s=yield an.load(this.src);if(!(s instanceof Pi))throw Error("Src was not pointing to a texture.");const n=Ri.create({width:s.width,height:s.height}),o=ns.from(s);(null===(t=this.filters)||void 0===t?void 0:t.length)&&(o.filters=this.filters),Ca.renderer.render(o,{renderTexture:n}),this.texture=s,this.renderTexture=n,this.sheet=new qo(n,this.json),Ht(),yield this.sheet.parse(),Ht();for(const[t,r]of Object.entries(this.sheet.textures)){const s=Ri.create({width:r.width+2,height:r.height+2}),n=ns.from(r);for(const t of[[0,0],[1,0],[2,0],[0,1],[2,1],[0,2],[1,2],[2,2],[1,1]])n.position.x=null!==(e=t[0])&&void 0!==e?e:0,n.position.y=null!==(i=t[1])&&void 0!==i?i:0,Ca.renderer.render(n,{renderTexture:s});this.sheet.textures[t]=s}for(const t of Object.values(this.sheet.animations))for(let e=0;e!=t.length;e++){const i=null===(r=t[e])||void 0===r?void 0:r.textureCacheIds[0],s=i&&this.sheet.textures[i];s&&(t[e]=s)}this.ready=!0,this.resolveReady()}))}modifyTexture(t){if(!this.texture||!this.renderTexture)return;const e=ns.from(this.texture);this.filters=t,e.filters=this.filters,Ca.renderer.render(e,{renderTexture:this.renderTexture,clear:!0})}getFrame(t){var e,i;return null!==(i=null===(e=this.sheet)||void 0===e?void 0:e.textures[t])&&void 0!==i?i:Dh}getAnimation(t){var e,i;return null!==(i=null===(e=this.sheet)||void 0===e?void 0:e.animations[t])&&void 0!==i?i:Bh}getAnimations(){return[...this.animations]}getFrames(){return[...this.frames]}}const zh=i.p+"e4b818525e39d11f3c37.png";class jh{constructor(t){this.called=!1,this.loaded=!1,this.spritesheet=t,this.promise=this.spritesheet.whenReady(),this.spritesheet.isReady()?(this.called=!0,this.loaded=!0):this.promise.then((()=>{this.called=!0,this.loaded=!0}))}new(){return this.called=!0,this.produce()}getState(){return this.loaded?"ready":this.called?"loading":"standby"}whenReady(){return this.promise}}const Hh=new Gh(zh,{frames:{smallIdle:{x:0,y:8,w:16,h:16},bigIdle:{x:0,y:32,w:16,h:32},smallWalk1:{x:56,y:8,w:16,h:16},smallWalk2:{x:20,y:8,w:16,h:16},smallWalk3:{x:38,y:8,w:16,h:16},bigWalk1:{x:56,y:32,w:16,h:32},bigWalk2:{x:20,y:32,w:16,h:32},bigWalk3:{x:38,y:32,w:16,h:32},smallSkid:{x:76,y:8,w:16,h:16},bigSkid:{x:76,y:32,w:16,h:32},smallJump:{x:96,y:8,w:16,h:16},bigJump:{x:96,y:32,w:16,h:32},smallDie:{x:116,y:8,w:16,h:16},bigDuck:{x:116,y:42,w:16,h:22},smallClimb1:{x:136,y:8,w:16,h:16},smallClimb2:{x:154,y:8,w:16,h:16},bigClimb1:{x:136,y:32,w:16,h:32},bigClimb2:{x:154,y:32,w:16,h:32},smallSwim1:{x:174,y:8,w:16,h:16},smallSwim2:{x:192,y:8,w:16,h:16},smallSwim3:{x:210,y:8,w:16,h:16},smallSwim4:{x:228,y:8,w:16,h:16},smallSwim5:{x:246,y:8,w:16,h:16},smallSwim6:{x:264,y:8,w:16,h:16},bigSwim1:{x:174,y:32,w:16,h:32},bigSwim2:{x:192,y:32,w:16,h:32},bigSwim3:{x:210,y:32,w:16,h:32},bigSwim4:{x:228,y:32,w:16,h:32},bigSwim5:{x:246,y:32,w:16,h:32},bigSwim6:{x:264,y:32,w:16,h:32},bigShootIdle:{x:136,y:72,w:16,h:32},bigShootWalk1:{x:190,y:72,w:16,h:32},bigShootWalk2:{x:154,y:72,w:16,h:32},bigShootWalk3:{x:172,y:72,w:16,h:32},bigShootSkid:{x:208,y:72,w:16,h:32},bigShootJump:{x:244,y:72,w:16,h:32}},animations:{smallWalk:["smallWalk1","smallWalk2","smallWalk3"],bigWalk:["bigWalk1","bigWalk2","bigWalk3"],bigShootWalk:["bigShootWalk1","bigShootWalk2","bigShootWalk3"],smallClimb:["smallClimb1","smallClimb2"],bigClimb:["bigClimb1","bigClimb2"],smallSwimStroke:["smallSwim1","smallSwim2","smallSwim3","smallSwim4","smallSwim5","smallSwim6"],bigSwimStroke:["bigSwim1","bigSwim2","bigSwim3","bigSwim4","bigSwim5","bigSwim6"],smallSwim:["smallSwim1","smallSwim2"],bigSwim:["bigSwim1","bigSwim2"],smallIdle:["smallIdle"],bigIdle:["bigIdle"],bigShootIdle:["bigShootIdle"],smallJump:["smallJump"],bigJump:["bigJump"],bigShootJump:["bigShootJump"],smallSkid:["smallSkid"],bigSkid:["bigSkid"],bigShootSkid:["bigShootSkid"],smallDie:["smallDie"],bigDuck:["bigDuck"]},transparency:[{r:{from:.57,to:.58},g:{from:.56,to:.57},b:{from:.99,to:1}},{r:{from:0,to:.01},g:{from:.16,to:.17},b:{from:.54,to:.55}}]}),Vh=new class extends jh{produce(){const t=Nh.from(Hh,Hh.getAnimations(),"smallIdle");return t.setAnimationAnchor("smallJump",{x:.5,y:.55}),t.setAnimationAnchor("bigJump",{x:.5,y:.57}),t.setAnimationAnchor("bigShootJump",{x:.5,y:.57}),t.setAnimationAnchor("bigDuck",{x:.5,y:.62}),t.container.zIndex=1,t}}(Hh);class Wh extends Lh{static from(t,e,i){const r={};if(t.isReady())return e.forEach((e=>r[e]=t.getFrame(e))),new Wh(r,i);{const s=new Wh(r,i);return s.ready=!1,s.readyPromise=t.parse().then((()=>{e.forEach((e=>r[e]=t.getFrame(e))),s.load(r),s.ready=!0})),s}}load(t){for(const[e,i]of Object.entries(t))this.textures[e]=i;this.forceSetFrame(this.frame)}constructor(t,e){super(),this.anchors=new Map,this.textures=t,this.frame=e,this.forceSetFrame(this.frame)}setFrameAnchor(t,e){this.anchors.set(t,e)}forceSetFrame(t){this.frame=t.toString()+"s",this.setFrame(t)}setFrame(t){if(this.frame===t)return!1;const e=this.anchors.get(t);e?this.sprite.anchor.set(e.x,e.y):this.sprite.anchor.set(.5),this.frame=t;const i=this.textures[t];return!!i&&(this.sprite.texture=i,!0)}getFrame(){return this.frame}getFrames(){return Object.keys(this.textures)}}const Xh=new Gh(i.p+"c2dce2ec32f4da51d9df.png",{frames:{solidFloor1:{x:0,y:16,w:16,h:16},solidBlock1:{x:0,y:33,w:16,h:16},solidFloor2:{x:147,y:16,w:16,h:16},solidBlock2:{x:147,y:33,w:16,h:16},solidCastleBlock:{x:0,y:151,w:16,h:16},solidUnderwaterBlock:{x:147,y:134,w:16,h:16},solidUnderwaterSeaweed:{x:215,y:297,w:16,h:16},solidBridge:{x:34,y:33,w:16,h:16},solidBulletBillBody:{x:119,y:33,w:16,h:16},solidBulletBillBase:{x:119,y:50,w:16,h:16},solidGreenShroomLeft:{x:0,y:196,w:16,h:16},solidGreenShroomMiddle:{x:17,y:196,w:16,h:16},solidGreenShroomRight:{x:34,y:196,w:16,h:16},solidGreenDotShroomLeft:{x:51,y:196,w:16,h:16},solidGreenDotShroomMiddle:{x:68,y:196,w:16,h:16},solidGreenDotShroomRight:{x:85,y:196,w:16,h:16},solidOrangeShroomLeft:{x:0,y:364,w:16,h:16},solidOrangeShroomMiddle:{x:17,y:364,w:16,h:16},solidOrangeShroomRight:{x:34,y:364,w:16,h:16},solidOrangeDotShroomLeft:{x:51,y:364,w:16,h:16},solidOrangeDotShroomMiddle:{x:68,y:364,w:16,h:16},solidOrangeDotShroomRight:{x:85,y:364,w:16,h:16},solidGreenPipeLeftHeadTop:{x:85,y:230,w:16,h:16},solidGreenPipeLeftHeadBottom:{x:85,y:247,w:16,h:16},solidGreenPipeLeftBodyTop:{x:102,y:230,w:16,h:16},solidGreenPipeLeftBodyBottom:{x:102,y:247,w:16,h:16},solidGreenPipeConnectionTop:{x:119,y:230,w:16,h:16},solidGreenPipeConnectionBottom:{x:119,y:247,w:16,h:16},solidGreenPipeTopHeadLeft:{x:119,y:196,w:16,h:16},solidGreenPipeTopHeadRight:{x:136,y:196,w:16,h:16},solidGreenPipeTopBodyLeft:{x:119,y:213,w:16,h:16},solidGreenPipeTopBodyRight:{x:136,y:213,w:16,h:16},solidWhitePipeLeftHeadTop:{x:85,y:314,w:16,h:16},solidWhitePipeLeftHeadBottom:{x:85,y:331,w:16,h:16},solidWhitePipeLeftBodyTop:{x:102,y:314,w:16,h:16},solidWhitePipeLeftBodyBottom:{x:102,y:331,w:16,h:16},solidWhitePipeConnectionTop:{x:119,y:314,w:16,h:16},solidWhitePipeConnectionBottom:{x:119,y:331,w:16,h:16},solidWhitePipeTopHeadLeft:{x:119,y:280,w:16,h:16},solidWhitePipeTopHeadRight:{x:136,y:280,w:16,h:16},solidWhitePipeTopBodyLeft:{x:119,y:297,w:16,h:16},solidWhitePipeTopBodyRight:{x:136,y:297,w:16,h:16},solidPurplePipeLeftHeadTop:{x:249,y:314,w:16,h:16},solidPurplePipeLeftHeadBottom:{x:249,y:331,w:16,h:16},solidPurplePipeLeftBodyTop:{x:266,y:314,w:16,h:16},solidPurplePipeLeftBodyBottom:{x:266,y:331,w:16,h:16},solidPurplePipeConnectionTop:{x:283,y:314,w:16,h:16},solidPurplePipeConnectionBottom:{x:283,y:331,w:16,h:16},solidPurplePipeTopHeadLeft:{x:283,y:280,w:16,h:16},solidPurplePipeTopHeadRight:{x:300,y:280,w:16,h:16},solidPurplePipeTopBodyLeft:{x:283,y:297,w:16,h:16},solidPurplePipeTopBodyRight:{x:300,y:297,w:16,h:16},solidOrangePipeLeftHeadTop:{x:85,y:398,w:16,h:16},solidOrangePipeLeftHeadBottom:{x:85,y:415,w:16,h:16},solidOrangePipeLeftBodyTop:{x:102,y:398,w:16,h:16},solidOrangePipeLeftBodyBottom:{x:102,y:415,w:16,h:16},solidOrangePipeConnectionTop:{x:119,y:398,w:16,h:16},solidOrangePipeConnectionBottom:{x:119,y:415,w:16,h:16},solidOrangePipeTopHeadLeft:{x:119,y:364,w:16,h:16},solidOrangePipeTopHeadRight:{x:136,y:364,w:16,h:16},solidOrangePipeTopBodyLeft:{x:119,y:381,w:16,h:16},solidOrangePipeTopBodyRight:{x:136,y:381,w:16,h:16},brick1:{x:17,y:16,w:16,h:16},brick2:{x:164,y:16,w:16,h:16},brick3:{x:17,y:100,w:16,h:16},brickBottom1:{x:34,y:16,w:16,h:16},brickBottom2:{x:181,y:16,w:16,h:16},brickBottom3:{x:34,y:100,w:16,h:16},blockHit1:{x:51,y:16,w:16,h:16},blockHit2:{x:198,y:16,w:16,h:16},blockHit3:{x:51,y:100,w:16,h:16},block1:{x:298,y:78,w:16,h:16},block2:{x:315,y:78,w:16,h:16},block3:{x:332,y:78,w:16,h:16},blockCoin:{x:349,y:78,w:16,h:16},blockCoins:{x:349,y:95,w:16,h:16},blockPowerup:{x:349,y:112,w:16,h:16},blockStar:{x:349,y:129,w:16,h:16},blockLife:{x:349,y:146,w:16,h:16},blockInvisibleCoin:{x:366,y:78,w:16,h:16},blockInvisibleCoins:{x:366,y:95,w:16,h:16},blockInvisiblePowerup:{x:366,y:112,w:16,h:16},blockInvisibleStar:{x:366,y:129,w:16,h:16},blockInvisibleLife:{x:366,y:146,w:16,h:16},blockBrick1Coin:{x:383,y:78,w:16,h:16},blockBrick1Coins:{x:383,y:95,w:16,h:16},blockBrick1Powerup:{x:383,y:112,w:16,h:16},blockBrick1Star:{x:383,y:129,w:16,h:16},blockBrick1Life:{x:383,y:146,w:16,h:16},blockBrick1BottomCoin:{x:400,y:78,w:16,h:16},blockBrick1BottomCoins:{x:400,y:95,w:16,h:16},blockBrick1BottomPowerup:{x:400,y:112,w:16,h:16},blockBrick1BottomStar:{x:400,y:129,w:16,h:16},blockBrick1BottomLife:{x:400,y:146,w:16,h:16},blockBrick2Coin:{x:417,y:78,w:16,h:16},blockBrick2Coins:{x:417,y:95,w:16,h:16},blockBrick2Powerup:{x:417,y:112,w:16,h:16},blockBrick2Star:{x:417,y:129,w:16,h:16},blockBrick2Life:{x:417,y:146,w:16,h:16},blockBrick2BottomCoin:{x:434,y:78,w:16,h:16},blockBrick2BottomCoins:{x:434,y:95,w:16,h:16},blockBrick2BottomPowerup:{x:434,y:112,w:16,h:16},blockBrick2BottomStar:{x:434,y:129,w:16,h:16},blockBrick2BottomLife:{x:434,y:146,w:16,h:16},blockBrick3Coin:{x:451,y:78,w:16,h:16},blockBrick3Coins:{x:451,y:95,w:16,h:16},blockBrick3Powerup:{x:451,y:112,w:16,h:16},blockBrick3Star:{x:451,y:129,w:16,h:16},blockBrick3Life:{x:451,y:146,w:16,h:16},blockBrick3BottomCoin:{x:468,y:78,w:16,h:16},blockBrick3BottomCoins:{x:468,y:95,w:16,h:16},blockBrick3BottomPowerup:{x:468,y:112,w:16,h:16},blockBrick3BottomStar:{x:468,y:129,w:16,h:16},blockBrick3BottomLife:{x:468,y:146,w:16,h:16},coin1:{x:298,y:95,w:16,h:16},coin2:{x:315,y:95,w:16,h:16},coin3:{x:332,y:95,w:16,h:16},clutterGreenPipeBodyVerticalLeft:{x:346,y:214,w:16,h:16},clutterGreenPipeBodyVerticalRight:{x:363,y:214,w:16,h:16},clutterGreenPipeBodyHorizontalTop:{x:380,y:231,w:16,h:16},clutterGreenPipeBodyHorizontalBotton:{x:380,y:248,w:16,h:16},clutterGreenPipeConntectorTL:{x:346,y:231,w:16,h:16},clutterGreenPipeConntectorTR:{x:363,y:231,w:16,h:16},clutterGreenPipeConntectorBL:{x:346,y:248,w:16,h:16},clutterGreenPipeConntectorBR:{x:363,y:248,w:16,h:16},brokenBrick1:{x:102,y:50,w:8,h:8},brokenBrick2:{x:249,y:50,w:8,h:8},brokenBrick3:{x:102,y:134,w:8,h:8}},animations:{block:["block1","block2","block3"],coin:["coin1","coin2","coin3"]},transparency:[{r:{from:.579,to:.581},g:{from:.579,to:.581},b:{from:.99,to:1}},{r:{from:0,to:.01},g:{from:.16,to:.17},b:{from:.54,to:.55}}]}),$h=new class extends jh{produce(){return Wh.from(Xh,Xh.getFrames(),"solidFloor1")}}(Xh),Yh=new class extends jh{produce(){return Nh.from(Xh,Xh.getAnimations(),"coin")}}(Xh),qh=new Gh(i.p+"466ac666c9f14be2682c.png",{frames:{mushroom:{x:0,y:8,w:16,h:16},oneup:{x:0,y:26,w:16,h:16},flower:{x:68,y:8,w:16,h:16},star:{x:142,y:8,w:16,h:16},coin1:{x:180,y:36,w:8,h:16},coin2:{x:190,y:36,w:8,h:16},coin3:{x:200,y:36,w:8,h:16},coin4:{x:210,y:36,w:8,h:16},fireball1:{x:180,y:54,w:8,h:8},fireball2:{x:190,y:54,w:8,h:8},fireball3:{x:200,y:54,w:8,h:8},fireball4:{x:210,y:54,w:8,h:8},firework1:{x:180,y:64,w:16,h:16},firework2:{x:198,y:64,w:16,h:16},firework3:{x:216,y:64,w:16,h:16},platformTiny:{x:32,y:64,w:16,h:8},platformSmall:{x:52,y:64,w:24,h:8},platformMedium:{x:80,y:64,w:32,h:8},platformBig:{x:116,y:64,w:48,h:8},cloudMedium:{x:80,y:74,w:32,h:8},cloudBig:{x:116,y:74,w:48,h:8},spring1:{x:24,y:75,w:16,h:31},spring2:{x:42,y:75,w:16,h:31},spring3:{x:60,y:75,w:16,h:31},starflag:{x:110,y:90,w:16,h:16},evilflag:{x:92,y:90,w:16,h:16},vinetop:{x:130,y:90,w:16,h:16},vine:{x:148,y:90,w:16,h:16}},animations:{fireball:["fireball1","fireball2","fireball3","fireball4"],firework:["firework1","firework2","firework3"],spring:["spring1","spring2","spring3"],coin:["coin1","coin2","coin3","coin4"]},transparency:[{r:{from:.57,to:.581},g:{from:.56,to:.57},b:{from:.99,to:1}},{r:{from:0,to:.01},g:{from:.16,to:.17},b:{from:.54,to:.55}}]}),Zh=new class extends jh{produce(){return Wh.from(qh,qh.getFrames(),"mushroom")}}(qh),Kh=new class extends jh{produce(){return Nh.from(qh,qh.getAnimations(),"coin")}}(qh),Jh=new class{constructor(t){this.factories=t,this.promise=Promise.all(Object.values(t).map((t=>t.whenReady()))).then()}getFactory(t){return this.factories[t]}whenReady(){return this.promise}getProgress(){const t=Object.values(this.factories);return t.filter((t=>"ready"===t.getState())).length/t.length}}({mario:Vh,tiles:$h,animTiles:Yh,objects:Zh,animObjects:Kh}),Qh=Jh;function tc(t,e,i){const r=Qh.getFactory("animTiles").new(),s=Qh.getFactory("tiles").new(),n=(null==i?void 0:i.includes("Coins"))?"coins":(null==i?void 0:i.includes("Pow"))?"pow":(null==i?void 0:i.includes("Star"))?"star":(null==i?void 0:i.includes("Life"))?"life":"coin";switch(i){case"blockCoin":case"blockCoins":case"blockPowerup":case"blockStar":case"blockLife":return r.setAnimation("block"),s.setFrame(null!=i?i:"solidFloor1"),fl.createEntity(dl({position:new xa(t,e),size:new xa(16,16),static:!0,smb1TilesAnimations:r,coinblock:n,smb1TilesSpritesEditMode:s}));default:return(null==i?void 0:i.includes("Brick"))?(null==i?void 0:i.includes("Bottom"))?i.includes("2")?s.setFrame("brickBottom2"):i.includes("3")?s.setFrame("brickBottom3"):s.setFrame("brickBottom1"):i.includes("2")?s.setFrame("brick2"):i.includes("3")?s.setFrame("brick3"):s.setFrame("brick1"):(null==i?void 0:i.includes("Invisible"))&&s.setFrame(i),fl.createEntity(dl({position:new xa(t,e),size:new xa(16,16),static:!0,smb1TilesSprites:s,coinblock:n,invisibleBlock:null==i?void 0:i.includes("Invisible")}))}}function ec(t,e,i){const r=Qh.getFactory("tiles").new();return r.setFrame(null!=i?i:"solidFloor1"),fl.createEntity(dl({position:new xa(t,e),size:new xa(16,16),static:!0,smb1TilesSprites:r}))}function ic(t,e,i){const r=Qh.getFactory("tiles").new();return r.setFrame(null!=i?i:"clutterGreenPipeBodyHorizontalBotton"),fl.createEntity(dl({position:new xa(t,e),size:new xa(16,16),smb1TilesSprites:r}))}function rc(t,e){return fl.createEntity(dl({position:new xa(t,e),touchingUp:[],touchingDown:[],touchingLeft:[],touchingRight:[],hits:[],prevHits:[],size:new xa(14,15),dynamic:{velocity:new xa(0,0),acceleration:new xa(0,0)},player:!0,marioInput:{inputs:{}},marioMovementConfig:{minWalkSpeed:4.453125,maxWalkSpeed:93.75,walkAccel:133.59375,maxWalkSpeedUnderwater:63.75,cutsceneWalkSpeed:48.75,maxRunSpeed:153.75,runAccel:200.390625,releaseDecel:182.8125,skidDecel:365.625,skidTurnaround:33.75,jumpBackwardsDecelThreshold:108.75,jumpFastAccel:200.390625,jumpSlowAccel:133.59375,jumpFastDecel:200.390625,jumpNormalDecel:182.8125,jumpSlowDecel:133.59375,initFallGravity:562.5,initJumpGravity:562.5,walkGravitySpeed:60,walkJump:240,walkFallGravity:1575,walkJumpGravity:450,midGravitySpeed:568260/4096,midJump:240,midFallGravity:1350,midJumpGravity:421.875,runJump:300,runFallGravity:2025,runJumpGravity:562.5,swimJump:90,swimFallGravity:140.625,swimJumpGravity:182.8125,whirlpoolJump:60,whirlpoolFallGravity:126.5625,whirlpoolJumpGravity:56.25,surfaceJump:90,surfaceFallGravity:337.5,surfaceJumpGravity:337.5},mario:{facing:1,coins:0,lives:3},floorSpeed:0,gravity:0,smb1MarioAnimations:Qh.getFactory("mario").new()}))}var sc;function nc(t,e,i){const r=Qh.getFactory("tiles").new();return r.setFrame(null!=i?i:"brick1"),fl.createEntity(dl({position:new xa(t,e),size:new xa(16,16),static:!0,brick:!0,smb1TilesSprites:r}))}function oc(t){var e,i,r,s,n;const o="string"==typeof t?JSON.parse(t):t,a={},l={};for(const t of[1,2]){const h=1===t?a:l,c=1===t?o.entities:o.entities2;for(const t of c){let a=null;switch(t[0]){case sc.mario:a=rc(t[1],t[2]);break;case sc.block:{const i=null===(e=t[3])||void 0===e?void 0:e.tileFrame;a=ec(t[1],t[2],i);break}case sc.brick:{const e=null===(i=t[3])||void 0===i?void 0:i.tileFrame;a=nc(t[1],t[2],e);break}case sc.coin:{const e=null===(r=t[3])||void 0===r?void 0:r.tileFrame;a=ec(t[1],t[2],e);break}case sc.clutter:{const e=null===(s=t[3])||void 0===s?void 0:s.tileFrame;a=ic(t[1],t[2],e);break}case sc.coinblock:{const e=null===(n=t[3])||void 0===n?void 0:n.tileFrame;a=tc(t[1],t[2],e);break}case sc.kinematic:a=fl.createEntity(dl({position:new xa(144,22),size:new xa(22,6),kinematic:{velocity:new xa(0,0),acceleration:new xa(0,0)}}))}if(a){const e=16*Math.floor(a.position.x/16)+"."+16*Math.floor(a.position.y/16),i=h[e];if(i){fl.remove(i.gameObj);const t=o.entities.indexOf(i.init);if(-1!==t){const e=o.entities.at(-1);e&&(o.entities[t]=e),o.entities.pop()}}h[e]={gameObj:a,init:t}}}}return{parsed:o,grid:a,grid2:l}}!function(t){t.mario="m",t.block="b",t.brick="r",t.coinblock="q",t.coin="c",t.kinematic="k",t.clutter="d"}(sc||(sc={}));const ac=new Set,lc={speedLimiter(t){if(t.length()>1e3)return t.unit().mul(1e3)},addRemoveRenderable(t){ac.has(t)||(ac.add(t),fl.onPropChange(t,((e,i)=>{var r,s;(null==i?void 0:i.container.parent)&&(null==i||i.container.removeFromParent());const n=null===(r=e[t])||void 0===r?void 0:r.container;n&&(i&&(i.container.position.x=e.position.x,i.container.position.y=e.position.y,i.container.filters=null!==(s=e.filters)&&void 0!==s?s:null),Ca.add(n))})),fl.onRemoving([t],(e=>{var i;const r=null===(i=e[t])||void 0===i?void 0:i.container;(null==r?void 0:r.parent)&&(r.filters=null,r.removeFromParent())})),fl.onPropChange("filters",(t=>{var e,i;for(const r of ac){const s=null===(e=t[r])||void 0===e?void 0:e.container;s&&(s.filters=null!==(i=t.filters)&&void 0!==i?i:null)}})))},updateRenderable(t){for(const e of fl.view(["dynamic",t])){const i=e[t];i&&(i.container.position.x=e.position.x,i.container.position.y=e.position.y)}for(const e of fl.view(["kinematic",t])){const i=e[t];i&&(i.container.position.x=e.position.x,i.container.position.y=e.position.y)}}},hc=lc;hc.addRemoveRenderable("smb1MarioAnimations"),hc.addRemoveRenderable("smb1ObjectsSprites"),hc.addRemoveRenderable("smb1ObjectsAnimations"),hc.addRemoveRenderable("smb1TilesAnimations"),hc.addRemoveRenderable("smb1TilesSprites"),hc.addRemoveRenderable("smb1TilesSpritesEditMode"),fl.onRemoving(["invisibleBlock"],(t=>{var e;(null===(e=t.smb1TilesSprites)||void 0===e?void 0:e.container)&&(t.smb1TilesSprites.container.visible=!0)}));let cc,uc=0;function dc(t,e){var i;if(void 0===cc||cc!==!!e){cc=!!e;for(const t of fl.view(["smb1TilesAnimations","smb1TilesSpritesEditMode"]))e?(t.smb1TilesSpritesEditMode&&(t.smb1TilesSpritesEditMode.container.visible=!0),t.smb1TilesAnimations&&(t.smb1TilesAnimations.container.visible=!1)):(t.smb1TilesSpritesEditMode&&(t.smb1TilesSpritesEditMode.container.visible=!1),t.smb1TilesAnimations&&(t.smb1TilesAnimations.container.visible=!0));for(const t of fl.view(["smb1TilesSprites","invisibleBlock"]))t.smb1TilesSprites&&(e?t.invisibleBlock&&(t.smb1TilesSprites.container.visible=!0):t.invisibleBlock&&(t.smb1TilesSprites.container.visible=!1))}if(hc.updateRenderable("smb1MarioAnimations"),hc.updateRenderable("smb1ObjectsSprites"),hc.updateRenderable("smb1TilesSprites"),hc.updateRenderable("smb1ObjectsAnimations"),e)hc.updateRenderable("smb1TilesSpritesEditMode");else{hc.updateRenderable("smb1TilesAnimations");const e=uc;uc=(uc+8*t*1.1)%8;let r=0;uc>4&&(r=Math.floor(uc-4),3===r&&(r=1));for(const t of fl.view(["smb1TilesAnimations"])){const e=t.smb1TilesAnimations;e&&e.setFrame(r)}const s=Math.floor(e)!==Math.floor(uc);for(const t of fl.view(["smb1TilesSprites","brokenBrick"])){const e=t.smb1TilesSprites;e&&s&&(e.container.scale.x=-e.container.scale.x)}for(const e of fl.view(["coinFromBlockLife"]))e.position.y-=111*t,e.coinFromBlockLife&&(e.coinFromBlockLife-=t,e.coinFromBlockLife<=0&&fl.remove(e)),e.smb1ObjectsAnimations&&e.positionStart.y-e.position.y>25&&(e.smb1ObjectsAnimations.container.zIndex=2);for(const e of fl.view(["smb1ObjectsAnimations"])){const i=e.smb1ObjectsAnimations;i&&i.update(t)}for(const t of fl.view(["fireballHit","smb1ObjectsAnimations"]))(null===(i=t.smb1ObjectsAnimations)||void 0===i?void 0:i.didLoop())&&(fl.remove(t),t.smb1ObjectsAnimations.container.visible=!1,delete t.smb1ObjectsAnimations)}}const pc=JSON.parse('{"entities":[["m",-383.9004739457369,39.8166650745555],["b",-424,56],["b",-408,56],["b",-392,56],["b",-376,56],["b",-360,56],["b",-344,56],["b",-328,56],["b",-312,56],["b",-296,56],["b",-280,56],["b",-264,56],["b",-248,56],["b",-232,56],["b",-216,56],["b",-200,56],["b",-184,56],["b",-168,56],["b",-152,56],["b",-136,56],["b",-120,56],["b",-104,56],["b",-88,56],["b",-72,56],["b",-40,56],["b",-24,56],["b",-8,56],["b",8,56],["b",24,56],["b",40,56],["b",-56,56],["b",56,56],["b",72,56],["b",88,56],["b",104,56],["b",120,56],["b",136,56],["b",152,56],["b",168,56],["b",184,56],["b",200,56],["b",216,56],["b",232,56],["b",248,56],["b",264,56],["b",280,56],["b",296,56],["b",312,56],["b",328,56],["b",344,56],["b",360,56],["b",376,56],["b",392,56],["b",408,56],["b",424,56],["b",440,56],["b",456,56],["b",472,56],["b",488,56],["b",504,56],["b",520,56],["b",536,56],["b",552,56],["b",568,56],["b",584,56],["b",600,56],["b",616,56],["b",632,56],["b",648,56],["b",648,72],["b",632,72],["b",616,72],["b",600,72],["b",584,72],["b",568,72],["b",552,72],["b",536,72],["b",520,72],["b",504,72],["b",488,72],["b",472,72],["b",456,72],["b",440,72],["b",424,72],["b",408,72],["b",392,72],["b",376,72],["b",360,72],["b",344,72],["b",328,72],["b",312,72],["b",296,72],["b",280,72],["b",264,72],["b",248,72],["b",232,72],["b",216,72],["b",200,72],["b",184,72],["b",168,72],["b",152,72],["b",136,72],["b",120,72],["b",104,72],["b",88,72],["b",72,72],["b",56,72],["b",40,72],["b",24,72],["b",8,72],["b",-8,72],["b",-24,72],["b",-40,72],["b",-56,72],["b",-72,72],["b",-88,72],["b",-104,72],["b",-120,72],["b",-136,72],["b",-152,72],["b",-168,72],["b",-184,72],["b",-200,72],["b",-216,72],["b",-232,72],["b",-248,72],["b",-264,72],["b",-280,72],["b",-296,72],["b",-312,72],["b",-328,72],["b",-344,72],["b",-360,72],["b",-376,72],["b",-392,72],["b",-408,72],["b",-424,72],["r",-104,-8,{"tileFrame":"brick1"}],["r",-72,-8,{"tileFrame":"brick1"}],["r",-40,-8,{"tileFrame":"brick1"}],["b",184,8,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",200,8,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",40,24,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",24,24,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",24,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",184,24,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",184,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",40,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",200,24,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",200,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",312,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",312,24,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",312,8,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",328,8,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",328,24,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",328,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",312,-8,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",328,-8,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",488,-8,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",504,-8,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",488,8,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",488,24,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",488,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",504,8,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",504,24,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",504,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",696,56],["b",696,72],["b",712,56],["b",728,56],["b",744,72],["b",760,72],["b",776,72],["b",792,56],["b",808,56],["b",824,56],["b",840,72],["b",856,72],["b",872,72],["b",888,56],["b",904,56],["b",920,56],["b",920,72],["b",904,72],["b",888,72],["b",824,72],["b",808,72],["b",792,72],["b",728,72],["b",712,72],["b",744,56],["b",760,56],["b",776,56],["b",840,56],["b",856,56],["b",872,56],["r",792,-8,{"tileFrame":"brick1"}],["r",824,-8,{"tileFrame":"brick1"}],["r",840,-72,{"tileFrame":"brick1"}],["r",856,-72,{"tileFrame":"brick1"}],["r",872,-72,{"tileFrame":"brick1"}],["r",888,-72,{"tileFrame":"brick1"}],["r",904,-72,{"tileFrame":"brick1"}],["r",920,-72,{"tileFrame":"brick1"}],["r",936,-72,{"tileFrame":"brick1"}],["r",952,-72,{"tileFrame":"brick1"}],["r",1016,-72,{"tileFrame":"brick1"}],["r",1032,-72,{"tileFrame":"brick1"}],["r",1048,-72,{"tileFrame":"brick1"}],["b",984,56],["b",984,72],["r",1160,-8,{"tileFrame":"brick1"}],["r",1448,-8,{"tileFrame":"brick1"}],["r",1496,-72,{"tileFrame":"brick1"}],["r",1512,-72,{"tileFrame":"brick1"}],["r",1528,-72,{"tileFrame":"brick1"}],["r",1608,-72,{"tileFrame":"brick1"}],["r",1656,-72,{"tileFrame":"brick1"}],["r",1624,-8,{"tileFrame":"brick1"}],["r",1640,-8,{"tileFrame":"brick1"}],["b",1000,56],["b",1016,56],["b",1032,56],["b",1048,56],["b",1064,56],["b",1080,56],["b",1096,56],["b",1112,56],["b",1128,56],["b",1144,56],["b",1160,56],["b",1176,56],["b",1192,56],["b",1208,56],["b",1224,56],["b",1240,56],["b",1256,56],["b",1272,56],["b",1288,56],["b",1304,56],["b",1320,56],["b",1336,56],["b",1352,56],["b",1368,56],["b",1384,56],["b",1400,56],["b",1416,56],["b",1432,56],["b",1448,56],["b",1464,56],["b",1480,56],["b",1496,56],["b",1512,56],["b",1528,56],["b",1544,56],["b",1560,56],["b",1576,56],["b",1592,56],["b",1608,56],["b",1624,56],["b",1640,56],["b",1656,56],["b",1656,72],["b",1640,72],["b",1624,72],["b",1608,72],["b",1592,72],["b",1576,72],["b",1560,72],["b",1544,72],["b",1528,72],["b",1512,72],["b",1496,72],["b",1480,72],["b",1464,72],["b",1448,72],["b",1432,72],["b",1416,72],["b",1400,72],["b",1384,72],["b",1368,72],["b",1352,72],["b",1336,72],["b",1320,72],["b",1304,72],["b",1288,72],["b",1272,72],["b",1256,72],["b",1240,72],["b",1224,72],["b",1208,72],["b",1192,72],["b",1176,72],["b",1160,72],["b",1144,72],["b",1128,72],["b",1112,72],["b",1096,72],["b",1080,72],["b",1064,72],["b",1048,72],["b",1032,72],["b",1016,72],["b",1000,72],["b",1672,56],["b",1672,72],["b",1688,72],["b",1688,56],["b",1704,40,{"tileFrame":"solidBlock1"}],["b",1720,24,{"tileFrame":"solidBlock1"}],["b",1736,8,{"tileFrame":"solidBlock1"}],["b",1752,-8,{"tileFrame":"solidBlock1"}],["b",1752,8,{"tileFrame":"solidBlock1"}],["b",1752,24,{"tileFrame":"solidBlock1"}],["b",1752,40,{"tileFrame":"solidBlock1"}],["b",1736,40,{"tileFrame":"solidBlock1"}],["b",1720,40,{"tileFrame":"solidBlock1"}],["b",1736,24,{"tileFrame":"solidBlock1"}],["b",1800,-8,{"tileFrame":"solidBlock1"}],["b",1800,8,{"tileFrame":"solidBlock1"}],["b",1800,24,{"tileFrame":"solidBlock1"}],["b",1800,40,{"tileFrame":"solidBlock1"}],["b",1816,40,{"tileFrame":"solidBlock1"}],["b",1832,40,{"tileFrame":"solidBlock1"}],["b",1848,40,{"tileFrame":"solidBlock1"}],["b",1832,24,{"tileFrame":"solidBlock1"}],["b",1816,24,{"tileFrame":"solidBlock1"}],["b",1816,8,{"tileFrame":"solidBlock1"}],["b",1704,56],["b",1720,56],["b",1736,56],["b",1752,56],["b",1768,56],["b",1784,56],["b",1800,56],["b",1816,56],["b",1832,56],["b",1848,56],["b",1848,72],["b",1832,72],["b",1816,72],["b",1800,72],["b",1784,72],["b",1768,72],["b",1752,72],["b",1736,72],["b",1720,72],["b",1704,72],["b",1864,56],["b",1880,56],["b",1896,56],["b",1912,56],["b",1912,72],["b",1896,72],["b",1880,72],["b",1864,72],["b",1928,40,{"tileFrame":"solidBlock1"}],["b",1944,24,{"tileFrame":"solidBlock1"}],["b",1960,8,{"tileFrame":"solidBlock1"}],["b",1976,-8,{"tileFrame":"solidBlock1"}],["b",1992,-8,{"tileFrame":"solidBlock1"}],["b",1992,8,{"tileFrame":"solidBlock1"}],["b",1992,24,{"tileFrame":"solidBlock1"}],["b",1992,40,{"tileFrame":"solidBlock1"}],["b",1976,40,{"tileFrame":"solidBlock1"}],["b",1960,40,{"tileFrame":"solidBlock1"}],["b",1944,40,{"tileFrame":"solidBlock1"}],["b",1960,24,{"tileFrame":"solidBlock1"}],["b",1976,24,{"tileFrame":"solidBlock1"}],["b",1976,8,{"tileFrame":"solidBlock1"}],["b",2040,-8,{"tileFrame":"solidBlock1"}],["b",2040,8,{"tileFrame":"solidBlock1"}],["b",2040,24,{"tileFrame":"solidBlock1"}],["b",2040,40,{"tileFrame":"solidBlock1"}],["b",2056,24,{"tileFrame":"solidBlock1"}],["b",2056,8,{"tileFrame":"solidBlock1"}],["b",2056,40,{"tileFrame":"solidBlock1"}],["b",2072,40,{"tileFrame":"solidBlock1"}],["b",2072,24,{"tileFrame":"solidBlock1"}],["b",2088,40,{"tileFrame":"solidBlock1"}],["b",1928,56],["b",1944,56],["b",1960,56],["b",1976,56],["b",1992,56],["b",1992,72],["b",1976,72],["b",1960,72],["b",1944,72],["b",1928,72],["b",2040,56],["b",2040,72],["b",2056,72],["b",2072,72],["b",2088,72],["b",2104,72],["b",2120,72],["b",2056,56],["b",2072,56],["b",2088,56],["b",2104,56],["b",2120,56],["b",2136,56],["b",2136,72],["b",2152,72],["b",2152,56],["b",2168,56],["b",2168,72],["b",2184,72],["b",2184,56],["b",2168,24,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",2184,24,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",2168,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",2184,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",2200,56],["b",2216,56],["b",2232,56],["b",2232,72],["b",2216,72],["b",2200,72],["r",2248,-8,{"tileFrame":"brick1"}],["r",2264,-8,{"tileFrame":"brick1"}],["r",2296,-8,{"tileFrame":"brick1"}],["b",2248,56],["b",2264,56],["b",2280,56],["b",2296,56],["b",2312,56],["b",2296,72],["b",2280,72],["b",2264,72],["b",2248,72],["b",2312,72],["b",2328,56],["b",2344,56],["b",2360,56],["b",2376,56],["b",2392,56],["b",2408,56],["b",2424,56],["b",2440,24,{"tileFrame":"solidGreenPipeTopHeadLeft"}],["b",2456,24,{"tileFrame":"solidGreenPipeTopHeadRight"}],["b",2440,40,{"tileFrame":"solidGreenPipeTopBodyLeft"}],["b",2456,40,{"tileFrame":"solidGreenPipeTopBodyRight"}],["b",2328,72],["b",2344,72],["b",2360,72],["b",2376,72],["b",2408,72],["b",2424,72],["b",2440,72],["b",2440,56],["b",2392,72],["b",2456,72],["b",2456,56],["b",2472,40,{"tileFrame":"solidBlock1"}],["b",2488,24,{"tileFrame":"solidBlock1"}],["b",2504,8,{"tileFrame":"solidBlock1"}],["b",2520,-8,{"tileFrame":"solidBlock1"}],["b",2536,-24,{"tileFrame":"solidBlock1"}],["b",2552,-40,{"tileFrame":"solidBlock1"}],["b",2568,-56,{"tileFrame":"solidBlock1"}],["b",2584,-72,{"tileFrame":"solidBlock1"}],["b",2488,40,{"tileFrame":"solidBlock1"}],["b",2504,40,{"tileFrame":"solidBlock1"}],["b",2520,40,{"tileFrame":"solidBlock1"}],["b",2536,40,{"tileFrame":"solidBlock1"}],["b",2552,40,{"tileFrame":"solidBlock1"}],["b",2568,40,{"tileFrame":"solidBlock1"}],["b",2584,40,{"tileFrame":"solidBlock1"}],["b",2584,24,{"tileFrame":"solidBlock1"}],["b",2584,8,{"tileFrame":"solidBlock1"}],["b",2584,-8,{"tileFrame":"solidBlock1"}],["b",2584,-24,{"tileFrame":"solidBlock1"}],["b",2584,-40,{"tileFrame":"solidBlock1"}],["b",2584,-56,{"tileFrame":"solidBlock1"}],["b",2568,-40,{"tileFrame":"solidBlock1"}],["b",2568,-24,{"tileFrame":"solidBlock1"}],["b",2568,-8,{"tileFrame":"solidBlock1"}],["b",2568,8,{"tileFrame":"solidBlock1"}],["b",2568,24,{"tileFrame":"solidBlock1"}],["b",2552,24,{"tileFrame":"solidBlock1"}],["b",2536,24,{"tileFrame":"solidBlock1"}],["b",2520,24,{"tileFrame":"solidBlock1"}],["b",2504,24,{"tileFrame":"solidBlock1"}],["b",2520,8,{"tileFrame":"solidBlock1"}],["b",2536,8,{"tileFrame":"solidBlock1"}],["b",2552,8,{"tileFrame":"solidBlock1"}],["b",2552,-24,{"tileFrame":"solidBlock1"}],["b",2552,-8,{"tileFrame":"solidBlock1"}],["b",2536,-8,{"tileFrame":"solidBlock1"}],["b",2472,56],["b",2488,56],["b",2504,56],["b",2520,56],["b",2536,56],["b",2552,56],["b",2568,56],["b",2584,56],["b",2584,72],["b",2568,72],["b",2552,72],["b",2536,72],["b",2520,72],["b",2504,72],["b",2488,72],["b",2472,72],["q",584,-24,{"tileFrame":"blockInvisibleLife"}],["q",808,-8,{"tileFrame":"blockPowerup"}],["q",1064,-72,{"tileFrame":"blockCoin"}],["q",1176,-8,{"tileFrame":"blockBrick1Star"}],["q",1064,-8,{"tileFrame":"blockBrick1Coins"}],["q",1256,-8,{"tileFrame":"blockCoin"}],["q",1304,-8,{"tileFrame":"blockCoin"}],["q",1352,-8,{"tileFrame":"blockCoin"}],["q",1640,-72,{"tileFrame":"blockCoin"}],["q",1624,-72,{"tileFrame":"blockCoin"}],["q",1304,-72,{"tileFrame":"blockPowerup"}],["q",2280,-8,{"tileFrame":"blockCoin"}],["q",-168,-8,{"tileFrame":"blockCoin"}],["q",-56,-8,{"tileFrame":"blockCoin"}],["q",-72,-72,{"tileFrame":"blockCoin"}],["q",-88,-8,{"tileFrame":"blockPowerup"}]],"entities2":[],"camZones":[{"x":-432,"y":-144,"w":3024,"h":224},{"x":-368,"y":-48,"w":16,"h":16}],"camPreserveZones":[{"x":-432,"y":-256,"w":3024,"h":112}],"deathZones":[],"underwaterZones":[],"whirlpoolZones":[],"surfaceZones":[],"noMarioInputZones":[]}'),fc={dynamics:new ka(32),kinematics:new ka(32),statics:new ka(32)},mc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,0)},gc={pos:new xa(0,0),size:new xa(0,0)},yc=t=>{mc.dr.x="touchingLeft"===t?-.1:"touchingRight"===t?.1:0,mc.dr.y="touchingUp"===t?-.1:"touchingDown"===t?.1:0;for(const e of fl.view([t])){const i=e[t];if(i){mc.pos.x=e.position.x-.5*e.size.x,mc.pos.y=e.position.y-.5*e.size.y,mc.size.x=e.size.x,mc.size.y=e.size.y;for(const t of fc.statics.findNear(mc.pos.x+mc.dr.x,mc.pos.y+mc.dr.y,mc.size.x,mc.size.y)){if(t.userData===e)continue;gc.pos.x=t.l,gc.pos.y=t.t,gc.size.x=t.w,gc.size.y=t.h;const[r]=Ta(mc,gc);r&&i.push(t.userData)}for(const t of fc.kinematics.findNear(mc.pos.x+mc.dr.x,mc.pos.y+mc.dr.y,mc.size.x,mc.size.y)){if(t.userData===e)continue;gc.pos.x=t.userData.position.x-.5*t.userData.size.x,gc.pos.y=t.userData.position.y-.5*t.userData.size.y,gc.size.x=t.w,gc.size.y=t.h;const[r]=Ta(mc,gc);r&&i.push(t.userData)}}}};function vc(t,e){const i=t.x;t.x+=e;const r=hc.speedLimiter(t);return r?Math.sign(e)*Math.abs(i-r.x):e}const xc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,0)},bc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,0)};function _c(t){const e="dynamic"===t?"dynamics":"static"===t?"statics":"kinematics",i="dynamic"===t?"dynamicIndex":"static"===t?"staticIndex":"kinematicIndex",r=[];return fl.onAdding([t],(t=>{const s=fc[e].create(t.position.x-.5*t.size.x,t.position.y-.5*t.size.y,t.size.x,t.size.y,t),n=r.push(s);t[i]=n-1})),fl.onRemoving([t],(t=>{const s=r[t[i]];if((null==s?void 0:s.userData)!==t)throw Error("what");fc[e].remove(s);const n=r.at(-1);r.pop(),n&&n!==s&&(r[t[i]]=n,n.userData[i]=t[i]),t[i]=-1})),r}const wc=_c("dynamic");_c("static");const Tc=_c("kinematic");fl.onAdding([],(t=>{t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.positionStart.x=t.position.x,t.positionStart.y=t.position.y}));const Sc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,-15)},Ec={pos:new xa(0,0),size:new xa(0,0)};function Ac(t,e,i,r,s){const n=Qh.getFactory("tiles").new();return n.setFrame(null!=i?i:"brokenBrick1"),n.container.zIndex=1,1===(r=r||1)&&(n.container.scale.x=-1),fl.createEntity(dl({position:new xa(t,e),size:new xa(8,8),brokenBrick:{side:r,velocity:new xa(50*r,s||-266)},smb1TilesSprites:n}))}function Cc(t,e){const i=Qh.getFactory("animObjects").new();return i.setAnimation("coin"),i.container.zIndex=-1,i.container.visible=!1,setTimeout((()=>i.container.visible=!0)),i.loopsPerSecond=3,fl.createEntity(dl({position:new xa(t,e),size:new xa(8,16),dynamic:{velocity:new xa(0,0),acceleration:new xa(0,0)},smb1ObjectsAnimations:i,coinFromBlockLife:.8}))}function Pc(t,e){const i=Qh.getFactory("objects").new();return i.setFrame("flower"),i.container.visible=!1,setTimeout((()=>i.container.visible=!0)),fl.createEntity(dl({position:new xa(t,e),size:new xa(14,16),smb1ObjectsSprites:i,grow:0,dynamic:{velocity:new xa(0,0),acceleration:new xa(0,0)},powerup:!0,hits:[]}))}function Rc(t,e){const i=Qh.getFactory("objects").new();return i.setFrame("mushroom"),i.container.zIndex=-1,i.container.visible=!1,setTimeout((()=>i.container.visible=!0)),fl.createEntity(dl({position:new xa(t,e),size:new xa(14,16),smb1ObjectsSprites:i,grow:0,dynamic:{velocity:new xa(0,0),acceleration:new xa(0,0)},mushroom:!0,powerup:!0,hits:[],touchingDown:[]}))}function Mc(t,e){const i=Qh.getFactory("objects").new();return i.setFrame("star"),i.container.zIndex=-1,i.container.visible=!1,setTimeout((()=>i.container.visible=!0)),fl.createEntity(dl({position:new xa(t,e),size:new xa(14,16),smb1ObjectsSprites:i,grow:0,dynamic:{velocity:new xa(0,0),acceleration:new xa(0,0)},star:!0,hits:[]}))}function Ic(t){const e=t.hits,i=t.prevHits;if(e&&i){const t=e.find((t=>t.normal.y>0));if(t&&!i.find((e=>e.e===t.e))&&t.normal.y>0)return!0}return!1}const kc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,-1)},Fc={pos:new xa(0,0),size:new xa(0,0)},Dc={l:0,t:0,w:0,h:0},Bc=ul();fl.onAdding(["grow"],(()=>{Bc.sounds.play("powerup_appears",{stopPrev:{same:!0}})}));const Oc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,0)},Lc={pos:new xa(0,0),size:new xa(0,0),dr:new xa(0,0)},Nc={l:0,t:0,w:0,h:0};function Uc(t,e,i){const r=Qh.getFactory("animObjects").new();return r.setAnimation("fireball"),r.loopsPerSecond=3,r.container.zIndex=10,fl.createEntity(dl({position:new xa(t,e),size:new xa(8,8),dynamic:{acceleration:new xa(0,0),velocity:new xa(0,0)},touchingLeft:[],touchingRight:[],touchingDown:[],smb1ObjectsAnimations:r,fireball:{parent:i},gravity:777}))}const Gc={pos:new xa(0,0),size:new xa(8,8)},zc=ul(),jc={camera:[],preserveCamera:[],death:[],whirlpool:[],underwater:[],surface:[],noInput:[]};let Hc=null;const Vc=ul();Ca.setBGColor("#9290FF"),Ca.countFps(),Ca.showFps();const Wc=ul(),Xc=new class extends Ua{constructor(){super(...arguments),this.g=null}onStart(t){this.g=t}onUpdate(t){return 1!==Wc.controller.getloadingProgress()}onEnd(){var t,e;return[this.g?{graphics:null===(t=this.g)||void 0===t?void 0:t.graphics,input:null===(e=this.g)||void 0===e?void 0:e.input}:null,"edit"]}},$c=new class extends Ua{constructor(){super(...arguments),this.mouseX=0,this.mouseY=0,this.mousePrevX=0,this.mousePrevY=0,this.spanVel=new xa(0,0),this.scale=1,this.t=0,this.paused=!1}onStart(t){this.paused=!1,t&&(this.graphics=t.graphics,this.input=t.input,jc.camera.push(...t.zones.camZones),jc.death.push(...t.zones.deathZones),jc.preserveCamera.push(...t.zones.camPreserveZones),jc.noInput.push(...t.zones.noMarioInputZones),jc.surface.push(...t.zones.surfaceZones),jc.underwater.push(...t.zones.underwaterZones),jc.whirlpool.push(...t.zones.whirlpoolZones))}onEnd(){return this.paused=!1,Ca.stopMoveTo(),jc.camera.length=0,jc.death.length=0,jc.preserveCamera.length=0,jc.noInput.length=0,jc.surface.length=0,jc.underwater.length=0,jc.whirlpool.length=0,this.graphics&&this.input?[{graphics:this.graphics,input:this.input},"editor"]:[null,"editor"]}onUpdate(t){if(!this.graphics||!this.input)return!1;if(this.input.isPressed("Space"))return!1;const e=this.paused;for(this.input.isPressed("KeyP")&&(this.paused=!this.paused),this.paused!==e&&Vc.sounds.play("pause"),fl.update(),this.t+=t;this.t>2*Math.PI;)this.t-=2*Math.PI;const i=33*Math.sin(this.t),r=33*Math.sin(this.t);for(const e of fl.view(["kinematic"])){const s=e.positionStart.x+i,n=e.positionStart.y+r;if(e.kinematic){const i=s-e.position.x,r=n-e.position.y;e.kinematic.velocity.x=i/t,e.kinematic.velocity.y=r/t}}for(const t of fl.view(["mario"]))this.input.isPressed("KeyH")&&t.mario&&(t.mario.big=!t.mario.big,t.mario.changedSize=!0),this.input.isPressed("KeyU")&&t.mario&&(t.underwater=!t.underwater);return this.graphics.clear(),this.paused||(yc("touchingUp"),yc("touchingRight"),yc("touchingDown"),yc("touchingLeft"),function(){for(const t of["floorSpeed","floorSpeedY"])for(const e of fl.view(["touchingDown","dynamic",t])){const i=e.dynamic,r=e.touchingDown;void 0!==e[t]&&(i&&r?(e[t]=r.reduce(((t,e)=>{var i,r,s,n;return Math.abs(t)>Math.abs(null!==(r=null===(i=e.kinematic)||void 0===i?void 0:i.velocity.x)&&void 0!==r?r:0)?null!==(n=null===(s=e.kinematic)||void 0===s?void 0:s.velocity.x)&&void 0!==n?n:0:t}),1/0),Number.isFinite(e[t])||(e[t]=0)):e[t]=0)}}(),function(t,e){for(const i of fl.view(["marioInput","player"])){const r=i.marioInput;if(r){r.anyPressed=!1;const i=r.inputs;for(const t in i)"number"==typeof i[t]?(i[t]-=e,i[t]<0&&(i[t]=0)):i[t]=!1;t.isPressed("ArrowLeft")&&(r.anyPressed=!0,i.left=!0),t.isHeld("ArrowLeft")&&(i.left=!0),t.isPressed("ArrowRight")&&(r.anyPressed=!0,i.right=!0),t.isHeld("ArrowRight")&&(i.right=!0),i.right&&i.left&&(i.right=!1,i.left=!1),t.isPressed("ArrowDown")&&(r.anyPressed=!0,i.ducking=!0),t.isHeld("ArrowDown")&&(i.ducking=!0),t.isHeld("KeyC")&&(i.run=1/6),t.isPressed("KeyC")&&(i.attack=!0,r.anyPressed=!0,i.run=1/6),t.isPressed("KeyX")&&(i.jump=!0,i.jumping=!0,r.anyPressed=!0),t.isHeld("KeyX")&&(i.jumping=!0)}}}(this.input,t),function(){for(const t of fl.view(["dynamic","gravity"])){const e=t.dynamic,i=t.gravity;e&&i&&(e.acceleration.y+=i)}}(),function(t,e){var i,r,s,n;for(const e of fl.view(["marioInput","marioMovementConfig","dynamic","mario"])){const o=e.marioMovementConfig,a=e.marioInput,l=e.dynamic,h=e.mario,c=!!(null===(i=e.touchingLeft)||void 0===i?void 0:i.length),u=!!(null===(r=e.touchingRight)||void 0===r?void 0:r.length),d=!!(null===(s=e.touchingDown)||void 0===s?void 0:s.length);if(o&&a&&l&&h){const i=!!e.underwater,r=a.inputs,s=(i||d)&&r.jump&&!h.jumpCooldown,p=d&&!s&&!h.jumpCooldown;e.gravity=e.gravity||o.initFallGravity,h.jumped=!1,h.jumpCooldown&&(h.jumpCooldown-=t,h.jumpCooldown<=0&&(h.jumpCooldown=0));const f=Math.sign(l.velocity.x);let m=Math.abs(l.velocity.x);const g=r.left?-1:r.right?1:0;h.prevGrounded=h.grounded;const y=h.ducking,v=h.forcedDucking||h.ducking||y;if(p){h.ducking=r.ducking&&h.big,h.maxAirSpeed=void 0,h.jumping=!!h.jumpCooldown,h.grounded=!h.jumpCooldown;const e=!!r.run,s=m<1;if(h.running=!1,v||!g||!s&&g!==f){const e=h.skidDecel&&!a.anyPressed;h.skidDecel=!s&&e;const i=h.skidding;if(h.skidding=h.skidding&&!s,!(1===f&&u||-1===f&&c)){let e=0;if(v)h.skidDecel=!1,h.skidding=!1,g&&s&&(h.facing=g);else if(g)h.skidDecel=!0,h.skidding=!0,m<=o.skidTurnaround&&(h.facing=g,h.skidding=!1);else if(m>o.skidTurnaround){const t=h.facing;h.facing=h.skidding||!f?h.facing:f<0?-1:1,f&&f!==t&&(h.skidding=!0)}else i&&s&&(h.facing=1===h.facing?-1:1);e=h.skidDecel?o.skidDecel:o.releaseDecel,m<=e*t&&(e=m/t),l.acceleration.x+=-e*f}}else if(h.skidDecel=!1,h.skidding=!1,h.facing=g,!(1===g&&u||-1===g&&c)){let r=0;r=m<o.minWalkSpeed?o.minWalkSpeed/t:e?o.runAccel:o.walkAccel;const s=i?o.maxWalkSpeedUnderwater:e?o.maxRunSpeed:o.maxWalkSpeed;s===o.maxRunSpeed&&(h.running=!0),m+r*t>=s&&(r=(s-m)/t),l.acceleration.x+=r*g}}else if(h.skidding&&!s&&(h.facing=1===h.facing?-1:1),h.grounded=!1,h.skidding=!1,h.skidDecel=!1,!s&&h.maxAirSpeed||(h.maxAirSpeed=m>o.maxWalkSpeed+Number.EPSILON?o.maxRunSpeed:o.maxWalkSpeed,i?(h.jumpSpeed=h.whirlpool?o.whirlpoolJump:h.surface?o.surfaceJump:o.swimJump,h.jumpGravity=h.whirlpool?o.whirlpoolJumpGravity:o.swimJumpGravity,h.fallGravity=h.whirlpool?o.whirlpoolFallGravity:o.swimFallGravity):(h.jumpSpeed=m<o.walkGravitySpeed?o.walkJump:m<o.midGravitySpeed?o.midJump:o.runJump,h.jumpGravity=m<o.walkGravitySpeed?o.walkJumpGravity:m<o.midGravitySpeed?o.midJumpGravity:o.runJumpGravity,h.fallGravity=m<o.walkGravitySpeed?o.walkFallGravity:m<o.midGravitySpeed?o.midFallGravity:o.runFallGravity)),e.gravity=r.jumping&&l.velocity.y<=0?h.jumpGravity:h.fallGravity,i&&(h.ducking=!1,h.surface&&(e.gravity=r.jumping&&l.velocity.y<=0?o.surfaceJumpGravity:o.surfaceFallGravity),e.gravity&&(e.gravity+=225),g&&g!==h.facing&&m<=o.skidTurnaround&&(h.facing=g)),s?(h.jumped=!0,h.jumping=!0,h.jumpCooldown=5/60,l.acceleration.y=-((null!==(n=h.jumpSpeed)&&void 0!==n?n:0)+l.velocity.y)/t):(h.jumping||(h.ducking=!1),h.prevGrounded&&m>.98*o.maxRunSpeed&&(l.acceleration.y=-(10+l.velocity.y)/t)),g){let e=0;e=g===h.facing?m>=o.maxWalkSpeed?o.jumpFastAccel:o.jumpSlowAccel:m>=o.maxWalkSpeed?o.jumpFastDecel:m>=o.jumpBackwardsDecelThreshold?o.jumpNormalDecel:o.jumpSlowDecel,f===g&&m+e*t>=h.maxAirSpeed&&(e=(h.maxAirSpeed-m)/t),l.acceleration.x+=e*g}h.shooting&&(h.shooting-=t,h.shooting<=0&&(h.shooting=0)),"fire"===h.powerup&&h.big&&(!r.attack||h.shooting||v||(h.shooting=.1,h.shot=!0))}}}(t),function(){var t,e,i,r,s;for(const r of fl.view(["mario"]))if(null===(t=r.mario)||void 0===t?void 0:t.shot){const t=r.mario.skidding?-r.mario.facing:r.mario.facing,s=Uc(r.position.x+3*t,r.position.y,r);s.smb1ObjectsAnimations&&(s.smb1ObjectsAnimations.container.scale.x=t),s.dynamic&&(s.dynamic.velocity.x=t*(150+Math.abs(null!==(i=null===(e=r.dynamic)||void 0===e?void 0:e.velocity.x)&&void 0!==i?i:0)*(r.mario.skidding?0:1)))}for(const t of fl.view(["fireball"]))t.dynamic&&(null===(r=t.touchingDown)||void 0===r?void 0:r.length)&&t.dynamic.velocity.y>=0&&(t.dynamic.velocity.y=-170),Gc.pos=t.position,Ca.overlapsRectBroad(Gc)||fl.remove(t),!(null===(s=t.dynamic)||void 0===s?void 0:s.velocity.x)&&(delete t.fireball,delete t.dynamic,t.fireballHit=!0,t.smb1ObjectsAnimations&&(t.smb1ObjectsAnimations.setFrame(0),t.smb1ObjectsAnimations.loopsPerSecond=5,t.smb1ObjectsAnimations.setAnimation("firework"),zc.sounds.play("bump")))}(),function(t){var e,i,r,s,n;for(const e of fl.view(["dynamic"])){const i=e.dynamic;i&&(i.velocity=i.velocity.add(i.acceleration.mul(t)))}for(const t of fl.view(["smash"])){if(!t.smash)continue;const e=t.dynamic;e&&(e.velocity.y=Math.max(e.velocity.y,0))}for(const t of fl.view(["mushroom","touchingDown"])){const s=null===(e=t.touchingDown)||void 0===e?void 0:e.reduce(((e,i)=>void 0===i.hitAnim?e:e?Math.abs(i.position.x-t.position.x)>Math.abs(e.position.x-t.position.x)?i:e:i),void 0);if(!!(null===(i=t.touchingDown)||void 0===i?void 0:i.find((t=>t.bonked)))&&t.movement&&(t.movement.bounce=-100,t.movement.bounceOnce=!0,t.movement.bounceNow=!0),s&&(null===(r=t.movement)||void 0===r?void 0:r.horizontal)){const e=Math.sign(t.position.x-s.position.x);t.movement.horizontal=Math.abs(t.movement.horizontal)*e,t.movement.horizontalNow=!0}}for(const t of fl.view(["dynamic","movement"])){const e=t.dynamic,i=t.movement;e&&i&&(i.bounceNow&&(e.velocity.y=null!==(s=i.bounce)&&void 0!==s?s:0,i.bounceOnce&&(i.bounce=void 0)),i.horizontalNow&&(e.velocity.x=null!==(n=i.horizontal)&&void 0!==n?n:0))}for(const e of fl.view(["kinematic"])){const i=e.kinematic;i&&(i.velocity=i.velocity.add(i.acceleration.mul(t)))}}(t),function(){for(const t of fl.view(["mario","dynamic"])){const e=t.dynamic,i=t.mario;e&&i&&i.wind&&(i.wind=vc(e.velocity,i.wind))}for(const t of fl.view(["dynamic","floorSpeed"])){const e=t.dynamic;e&&t.floorSpeed&&(t.floorSpeed=vc(e.velocity,t.floorSpeed))}}(),function(){for(const t of fl.view(["dynamic"])){const e=t.dynamic;e&&hc.speedLimiter(e.velocity)}}(),function(t){!function(){for(const t of fl.view(["hits","prevHits"])){const e=t.prevHits,i=t.hits;e&&i&&(e.length=0,i.forEach((t=>e.push(t))))}for(const t of fl.view(["hits"]))t.hits&&(t.hits.length=0)}();for(const e of Tc){if(!e.userData.kinematic)continue;const i=e.userData.position,r=e.userData.size,s=e.userData.kinematic.velocity.mul(t);e.l=i.x-.5*r.x,e.t=i.y-.5*r.y,e.w=r.x,e.h=r.y,e.l=s.x<0?e.l+s.x:e.l,e.t=s.y<0?e.t+s.y:e.t,e.w=s.x<0?e.w-s.x:e.w+s.x,e.h=s.y<0?e.h-s.y:e.h+s.y,fc.kinematics.update(e)}for(const e of wc){if(!e.userData.dynamic)continue;const i=e.userData.dynamic.velocity.mul(t);if(i.isNull)continue;const r=e.userData.position,s=e.userData.size,n=r.x-.5*s.x,o=r.y-.5*s.y,a=s.x,l=s.y;e.l=i.x<0?n+i.x:n,e.t=i.y<0?o+i.y:o,e.w=i.x<0?a-i.x:a+i.x,e.h=i.y<0?l-i.y:l+i.y,fc.dynamics.update(e),xc.pos.x=n,xc.pos.y=o,xc.size.x=a,xc.size.y=l,xc.dr.x=i.x,xc.dr.y=i.y;const h=[];for(const t of fc.statics.findNear(e.l,e.t,e.w,e.h)){if(t===e)continue;bc.pos.x=t.l,bc.pos.y=t.t,bc.size.x=t.w,bc.size.y=t.h;const[i,r]=Ta(xc,bc);i&&h.push([r.edginess,t,r.time])}for(const i of fc.kinematics.findNear(e.l,e.t,e.w,e.h)){if(i===e||!i.userData.kinematic)continue;bc.pos.x=i.userData.position.x-.5*i.userData.size.x,bc.pos.y=i.userData.position.y-.5*i.userData.size.y,bc.size.x=i.userData.size.x,bc.size.y=i.userData.size.y,bc.dr.x=i.userData.kinematic.velocity.x*t,bc.dr.y=i.userData.kinematic.velocity.y*t;const[r,s]=Sa(xc,bc);r&&h.push([s.edginess,i,s.time])}const c=h.sort(((t,e)=>t[2]-e[2])).sort(((t,e)=>e[0]-t[0]));let u=null,d=0;for(const[i,r]of c){const i=e.userData.dynamic.velocity.mul(t);if(xc.dr.x=i.x,xc.dr.y=i.y,r.userData.kinematic){bc.pos.x=r.userData.position.x-.5*r.userData.size.x,bc.pos.y=r.userData.position.y-.5*r.userData.size.y,bc.size.x=r.userData.size.x,bc.size.y=r.userData.size.y,bc.dr.x=r.userData.kinematic.velocity.x*t,bc.dr.y=r.userData.kinematic.velocity.y*t;const[i,s]=Sa(xc,bc);if(i){const t=e.userData.dynamic.velocity.sub(r.userData.kinematic.velocity).abs().elementwiseMul(s.normal).mul(1-s.time);e.userData.dynamic.velocity.x+=t.x,e.userData.dynamic.velocity.y+=t.y,e.userData.hits&&e.userData.hits.push(Object.assign({e:r.userData},s)),r.userData.hits&&r.userData.hits.push(Object.assign({e:r.userData},s))}}else{if(bc.pos.x=r.l,bc.pos.y=r.t,bc.size.x=r.w,bc.size.y=r.h,d&&null!==u)if(d<0){if(bc.pos.y>=u)continue}else if(bc.pos.y+bc.size.y<=u)continue;const[t,i]=Ta(xc,bc);if(t){if(r.userData.invisibleBlock&&!(i.normal.y>0))continue;d=Math.sign(i.normal.y),u=d<0?bc.pos.y:d>0?bc.pos.y+bc.size.y:null;const t=e.userData.dynamic.velocity.abs().elementwiseMul(i.normal).mul(1-i.time);e.userData.dynamic.velocity.x+=t.x,e.userData.dynamic.velocity.y+=t.y,e.userData.hits&&e.userData.hits.push(Object.assign({e:r.userData},i)),r.userData.hits&&r.userData.hits.push(Object.assign({e:r.userData},i))}}}}}(t),function(){for(const t of fl.view(["dynamic"]))t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y;for(const t of fl.view(["kinematic"]))t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y}(),function(t){for(const e of fl.view(["dynamic"])){const i=e.dynamic;i&&(e.position=e.position.add(i.velocity.mul(t)))}for(const e of fl.view(["kinematic"])){const i=e.kinematic;i&&(e.position=e.position.add(i.velocity.mul(t)))}}(t),function(){for(const t of fl.view(["mario","dynamic"])){const e=t.mario,i=t.dynamic;if(e&&i)if(e.forcedDucking=!1,e.big&&!e.ducking){if(30===t.size.y)continue;Sc.pos.x=t.position.x-.5*t.size.x,Sc.pos.y=t.position.y-.5*t.size.y,Sc.size.x=t.size.x,Sc.size.y=t.size.y;const i=t.position.x-.5*t.size.x,r=t.position.y-.5*t.size.y-15,s=t.size.x,n=t.size.y;let o=!0;for(const e of fc.statics.findNear(i,r,s,n)){if(e.userData===t)continue;Ec.pos.x=e.userData.position.x-.5*e.userData.size.x,Ec.pos.y=e.userData.position.y-.5*e.userData.size.y,Ec.size.x=e.userData.size.x,Ec.size.y=e.userData.size.y;const[i,r]=Ta(Sc,Ec);o=o&&(!i||1!==r.normal.y)}for(const e of fc.kinematics.findNear(i,r,s,n)){if(e.userData===t)continue;Ec.pos.x=e.userData.position.x-.5*e.userData.size.x,Ec.pos.y=e.userData.position.y-.5*e.userData.size.y,Ec.size.x=e.userData.size.x,Ec.size.y=e.userData.size.y;const[i,r]=Ta(Sc,Ec);o=o&&(!i||1!==r.normal.y)}if(o){const e=t.size.y;t.size.y=30;const i=e-t.size.y;i&&(t.position.y+=i/2)}else e.forcedDucking=!0}else{if(15===t.size.y)continue;const e=t.size.y;t.size.y=15;const i=e-t.size.y;i&&(t.position.y+=i/2)}}}(),function(){for(const t of fl.view(["mario","dynamic"])){const e=t.dynamic,i=t.mario;e&&i&&i.wind&&(e.velocity.x-=i.wind,i.wind=0)}for(const t of fl.view(["dynamic","floorSpeed"])){const e=t.dynamic;e&&t.floorSpeed&&(e.velocity.x-=t.floorSpeed,t.floorSpeed=0)}}(),function(t){var e,i,r,s,n,o;!function(t){for(const e of["bonk","smash"]){const i="bonk"===e?"bonkCooldown":"smashCooldown";for(const e of fl.view([i])){let r=e[i];r&&(r-=t,e[i]=r,r<0&&(e[i]=0))}for(const t of fl.view([e]))t[e]&&!t[i]&&(t[i]=.1)}}(t);for(const t of fl.view(["bonked"]))delete t.bonked;for(const t of fl.view(["mario"])){if(t.bonk=!1,t.smash=!1,!Ic(t))continue;if(!t.dynamic)continue;const o=kc.dr,a=t.position,l=t.size,h=a.x-.5*l.x,c=a.y-.5*l.y,u=l.x,d=l.y;Dc.l=o.x<0?h+o.x:h,Dc.t=o.y<0?c+o.y:c,Dc.w=o.x<0?u-o.x:u+o.x,Dc.h=o.y<0?d-o.y:d+o.y,kc.pos.x=h,kc.pos.y=c,kc.size.x=u,kc.size.y=d;for(const o of fc.statics.findNear(Dc.l,Dc.t,Dc.w,Dc.h)){const a=o.userData;if(a===t)continue;Fc.pos.x=o.l,Fc.pos.y=o.t,Fc.size.x=o.w,Fc.size.y=o.h;const[l]=Ta(kc,Fc);if(l)if(a.invisibleBlock&&delete a.invisibleBlock,a.brick)if(null===(e=t.mario)||void 0===e?void 0:e.big){if(a.smashCooldown)continue;a.bonked=!0;const e=(null===(i=a.smb1TilesSprites)||void 0===i?void 0:i.getFrame().includes("2"))?"brokenBrick2":(null===(r=a.smb1TilesSprites)||void 0===r?void 0:r.getFrame().includes("3"))?"brokenBrick3":"brokenBrick1";fl.remove(a),t.smash=!0;const s=a.size.x/4,n=a.size.y/4;Ac(a.position.x-s,a.position.y-n,e,-1),Ac(a.position.x-s,a.position.y+n,e,-1,-66),Ac(a.position.x+s,a.position.y-n,e,1),Ac(a.position.x+s,a.position.y+n,e,1,-66)}else{if(a.bonkCooldown)continue;a.bonked=!0,void 0===a.hitAnim&&(a.hitAnim=0),t.bonk=!0}else if(a.coinblock){if(a.bonkCooldown)continue;if(a.bonked=!0,"coins"!==a.coinblock){if("pow"===a.coinblock)(null===(s=t.mario)||void 0===s?void 0:s.big)?Pc(a.position.x,a.position.y):Rc(a.position.x,a.position.y);else if("life"===a.coinblock){const t=Rc(a.position.x,a.position.y);t.powerup=!1,t.oneUp=!0,null===(n=t.smb1ObjectsSprites)||void 0===n||n.setFrame("oneup")}else"star"===a.coinblock?Mc(a.position.x,a.position.y):Cc(a.position.x,a.position.y);if(delete a.coinblock,a.smb1TilesAnimations){delete a.smb1TilesAnimations;const t=Qh.getFactory("tiles").new();a.smb1TilesSprites=t,t.setFrame("blockHit1")}if(a.smb1TilesSprites)switch(a.smb1TilesSprites.getFrame()){case"brick2":case"brickBottom2":a.smb1TilesSprites.setFrame("blockHit2");break;case"brick3":case"brickBottom3":a.smb1TilesSprites.setFrame("blockHit3");break;default:a.smb1TilesSprites.setFrame("blockHit1")}}else Cc(a.position.x,a.position.y),void 0===a.coinblockDeathTimer&&(a.coinblockDeathTimer=3.8);void 0===a.hitAnim&&(a.hitAnim=0),t.bonk=!0}else{if(a.bonkCooldown)continue;t.bonk=!0}}}for(const e of fl.view(["coinblockDeathTimer"]))void 0!==e.coinblockDeathTimer&&(e.coinblockDeathTimer-=t,e.coinblockDeathTimer<=0&&(delete e.coinblockDeathTimer,e.coinblock="coin"));for(const e of fl.view(["hitAnim"]))if(void 0!==e.hitAnim){const i=e.hitAnim/.4,r=8*Math.sin(i*Math.PI);e.smb1TilesSprites&&(e.smb1TilesSprites.container.position.y=e.positionStart.y-r),e.hitAnim+=t,e.hitAnim>.4&&(delete e.hitAnim,e.smb1TilesSprites&&(e.smb1TilesSprites.container.position.y=e.positionStart.y))}const a=fl.view(["mario"]);for(const e of fl.view(["grow"]))if(void 0!==e.grow){if(e.grow>=0){const i=e.grow/.4,r=8*Math.sin(i*Math.PI);e.position.y=e.positionStart.y-r,e.grow+=t,e.grow>.2&&(e.grow=-1)}else if(e.position.y=e.position.y-16*t,e.position.y-e.positionStart.y<=-16){e.position.y=e.positionStart.y-16;const t=a.length?a.reduce(((t,i)=>Math.abs(t.position.x-e.position.x)>Math.abs(i.position.x-e.position.x)?i:t)):null,i=Math.sign((null!==(o=null==t?void 0:t.position.x)&&void 0!==o?o:0)-e.position.x);e.mushroom&&(e.movement={horizontal:48*i,horizontalNow:!0},e.gravity=333),e.star&&(e.movement={horizontal:48*i,bounce:-200,horizontalNow:!0},e.gravity=333),delete e.grow}e.smb1ObjectsSprites&&(e.smb1ObjectsSprites.container.position.x=e.position.x,e.smb1ObjectsSprites.container.position.y=e.position.y)}for(const e of fl.view(["brokenBrick"])){const i=e.brokenBrick;i&&(e.position.x+=i.velocity.x*t,e.position.y+=i.velocity.y*t,i.velocity.y+=700*t),e.smb1TilesSprites&&(e.smb1TilesSprites.container.position.x=e.position.x,e.smb1TilesSprites.container.position.y=e.position.y);const[r,s]=Ca.fromViewport(0,Ca.getViewportHeight());e.position.y-.5*e.size.y>s&&fl.remove(e)}}(t),function(){var t,e;for(const i of fl.view(["dynamic","movement","hits"])){if(!i.dynamic||!i.movement)continue;const r=i.movement.horizontal;i.movement.horizontalNow=!1,r&&(null===(t=i.hits)||void 0===t?void 0:t.find((t=>Math.sign(t.normal.x)===-Math.sign(r))))&&(i.movement.horizontal=-r,i.movement.horizontalNow=!0);const s=i.movement.bounce;i.movement.bounceNow=!1,s&&(null===(e=i.hits)||void 0===e?void 0:e.find((t=>t.normal.y<0)))&&(i.movement.bounceNow=!0)}}(),function(){for(const t of fl.view(["mario"])){if(!t.mario)continue;const e=t.position,i=t.positionPrev,r=t.size,s=i.x-.5*r.x,n=i.y-.5*r.y,o=r.x,a=r.y,l=e.sub(i);Oc.pos.x=e.x-.5*r.x,Oc.pos.y=e.y-.5*r.y,Oc.size.x=o,Oc.size.y=a,Oc.dr=l,Nc.l=l.x<0?s+l.x:s,Nc.t=l.y<0?n+l.y:n,Nc.w=l.x<0?o-l.x:o+l.x,Nc.h=l.y<0?a-l.y:a+l.y;for(const e of fc.dynamics.findNear(Nc.l,Nc.t,Nc.w,Nc.h)){const i=e.userData;(i.powerup||i.oneUp||i.star)&&(Lc.pos.x=i.position.x-.5*i.size.x,Lc.pos.y=i.position.y-.5*i.size.y,Lc.size.x=i.size.x,Lc.size.y=i.size.y,_a(Oc,Lc)&&(fl.remove(i),i.powerup?t.mario.big?(t.mario.powerup="fire",t.mario.gainedPow=!0):(t.mario.big=!0,t.mario.changedSize=!0):i.oneUp?t.mario.gainedOneUp=!0:i.star&&(t.mario.star=30)))}}}(),function(t){for(const e of fl.view(["mario"])){const i=e.mario;i&&void 0!==i.star&&(i.star-=t,i.star<=0&&delete i.star)}}(t)),ml(this.graphics),Mh(t),dc(t),this.paused||Fh(),function(t){let e=null;for(const t of fl.view(["mario"]))e=t;if(e){const i=e.position.x,r=e.position.y+.5*e.size.y-16;let s=!1;for(const t of jc.preserveCamera)Ea.pointVsRect({x:i,y:r},{pos:{x:t.x,y:t.y},size:{x:t.w,y:t.h}})&&(s=!0);if(t.moveToScale(3),t.moveToCenter(i,r),!s){Hc=null;for(const t of jc.camera)Ea.pointVsRect({x:i,y:r},{pos:{x:t.x,y:t.y},size:{x:t.w,y:t.h}})&&(Hc=t)}Hc&&t.moveToClamp(i,r,3,Hc.x,Hc.y,Hc.w,Hc.h)}}(Ca),this.paused||function(){for(const t of fl.view(["touchingUp"]))t.touchingUp&&(t.touchingUp.length=0);for(const t of fl.view(["touchingRight"]))t.touchingRight&&(t.touchingRight.length=0);for(const t of fl.view(["touchingDown"]))t.touchingDown&&(t.touchingDown.length=0);for(const t of fl.view(["touchingLeft"]))t.touchingLeft&&(t.touchingLeft.length=0);for(const t of fl.view(["dynamic"]))t.dynamic&&(t.dynamic.acceleration.x=0,t.dynamic.acceleration.y=0);for(const t of fl.view(["mario"]))t.mario&&(t.mario.changedSize=!1,t.mario.gainedPow=!1,t.mario.shot=!1,t.mario.gainedOneUp=!1);for(const t of fl.view(["kinematic"]))t.kinematic&&(t.kinematic.acceleration.x=0,t.kinematic.acceleration.y=0)}(),!0}},Yc=new class extends Ua{getGrid(t){return 2===(null!=t?t:this.layer)?this.grid2:this.grid}remove(t,e,i,r){const s=this.getGrid(r),n=16*Math.floor(t/16)+"."+16*Math.floor(e/16),o=s[n];if(o&&(!i||i===o.gameObj))return delete s[n],(null==o?void 0:o.gameObj)&&fl.remove(o.gameObj),o}add(...t){const{grid:e}=oc({entities:t,entities2:[]}),i=this.getGrid(),r={layer:this.layer,entObs:[],ents:t};for(const[t,s]of Object.entries(e)){const e=i[t];delete i[t],(null==e?void 0:e.gameObj)&&fl.remove(e.gameObj),i[t]=s,this.applyAlphaFromLayer(s.gameObj,i===this.grid?1:2),r.entObs.push(s.gameObj)}return r}historyPush(t){this.history.length=this.historyIndex,this.history.push(t),this.history.length>25&&this.history.shift(),this.historyIndex=this.history.length}historyUndo(){const t=this.historyIndex;if(this.historyIndex=this.historyIndex-1,this.historyIndex<0&&(this.historyIndex=0),t===this.historyIndex)return;const e=this.history[this.historyIndex];if(e){const t=this.layer;this.layer=e.layer,"add"===e.type?e.ents.forEach((t=>{this.remove(t[1],t[2])})):this.add(...e.ents),this.layer=t}}historyRestore(){if(this.history.length<=this.historyIndex)return;const t=this.history[this.historyIndex];if(!t)return;this.historyIndex+=1;const e=this.layer;this.layer=t.layer,"add"===t.type?this.add(...t.ents):t.ents.forEach((t=>{this.remove(t[1],t[2])})),this.layer=e}toggleLayer(){this.layer=1===this.layer?2:1}applyAlphaFromLayer(t,e){const i=this.layer===e?1:.5;t.smb1MarioAnimations&&(t.smb1MarioAnimations.container.alpha=i),t.smb1TilesSprites&&(t.smb1TilesSprites.container.alpha=i),t.smb1ObjectsSprites&&(t.smb1ObjectsSprites.container.alpha=i),t.smb1ObjectsAnimations&&(t.smb1ObjectsAnimations.container.alpha=i),t.smb1TilesAnimations&&(t.smb1TilesAnimations.container.alpha=i),t.smb1TilesSpritesEditMode&&(t.smb1TilesSpritesEditMode.container.alpha=i)}toggleTransparency(t){if("none"===t)fl.view(["smb1MarioAnimations"]).forEach((t=>{t.smb1MarioAnimations&&(t.smb1MarioAnimations.container.alpha=1)})),fl.view(["smb1TilesSprites"]).forEach((t=>{t.smb1TilesSprites&&(t.smb1TilesSprites.container.alpha=1)}));else if("layer"===t){const t=this.getGrid(),e=t===this.grid?this.grid2:this.grid;Object.values(t).forEach((e=>this.applyAlphaFromLayer(e.gameObj,t===this.grid?1:2))),Object.values(e).forEach((t=>this.applyAlphaFromLayer(t.gameObj,e===this.grid?1:2)))}}constructor(){super(),this.zones={camZones:[],camPreserveZones:[],deathZones:[],underwaterZones:[],whirlpoolZones:[],surfaceZones:[],noMarioInputZones:[]},this.mouseX=0,this.mouseY=0,this.mousePrevX=0,this.mousePrevY=0,this.spanVel=new xa(0,0),this.grid={},this.grid2={},this.scale=1,this.prevSelected=null,this.selected=null,this.selectedZone="cam",this.zoneSelected=!1,this.solidFrame=void 0,this.brickFrame=void 0,this.blockFrame=void 0,this.clutterFrame=void 0,this.layer=1,this.history=[],this.historyIndex=0,this.graphicsOverlay=new lo,this.graphicsOverlay.zIndex=100;const t=document.createElement("div");this.entityCount=document.createElement("div"),t.style.display="flex",t.style.alignItems="center";const e=document.createElement("div");e.innerHTML="Entities:",t.append(e,this.entityCount),this.tileSelectors=document.createElement("div"),this.tileSelectors.style.padding="20px",this.tileSelectors.style.display="flex",this.tileSelectors.style.flexWrap="wrap",this.tileSelectors.style.gap="10px",this.marioSelect=document.createElement("button"),this.marioSelect.innerHTML="mario",this.marioSelect.onclick=()=>this.selected=sc.mario;const i=Vh.new();null==i||i.whenReady().then((()=>{this.marioSelect.innerHTML="";const t=document.createElement("img");t.style.width="48px",t.style.height="48px",t.alt="mario";const e=document.createElement("div");e.innerHTML=t.alt,this.marioSelect.append(t,e);const r=i.getDataUrl();r&&(t.src=r)})),this.solidSelect=document.createElement("button"),this.solidSelect.innerHTML="solid",this.solidSelect.onclick=()=>this.selected=sc.block;const r=$h.new();null==r||r.whenReady().then((()=>{this.solidSelect.innerHTML="";const t=document.createElement("img");t.style.width="48px",t.style.height="48px",t.alt="solid";const e=document.createElement("div");e.innerHTML=t.alt,this.solidSelect.append(t,e);const i=r.getDataUrl();i&&(t.src=i,this.solidSelect.addEventListener("wheel",(e=>{var i;const s=r.getFrames();let n=s.findIndex((t=>t===r.getFrame())),o=!1;for(;!1===o;)n=(n+Math.sign(e.deltaY))%s.length,this.solidFrame=s.at(n),o=null===(i=this.solidFrame)||void 0===i?void 0:i.includes("solid");this.solidFrame&&r.setFrame(this.solidFrame);const a=r.getDataUrl();a&&(t.src=a)})))})),this.brickSelect=document.createElement("button"),this.brickSelect.innerHTML="brick",this.brickSelect.onclick=()=>this.selected=sc.brick;const s=$h.new();this.brickFrame="brick1",s.setFrame(this.brickFrame),null==s||s.whenReady().then((()=>{this.brickSelect.innerHTML="";const t=document.createElement("img");t.style.width="48px",t.style.height="48px",t.alt="brick";const e=document.createElement("div");e.innerHTML=t.alt,this.brickSelect.append(t,e);const i=s.getDataUrl();i&&(t.src=i,this.brickSelect.addEventListener("wheel",(e=>{var i;const r=s.getFrames();let n=r.findIndex((t=>t===s.getFrame())),o=!1;for(;!1===o;)n=(n+Math.sign(e.deltaY))%r.length,this.brickFrame=r.at(n),o=null===(i=this.brickFrame)||void 0===i?void 0:i.includes("brick");this.brickFrame&&s.setFrame(this.brickFrame);const a=s.getDataUrl();a&&(t.src=a)})))})),this.clutterSelect=document.createElement("button"),this.clutterSelect.innerHTML="clutter",this.clutterSelect.onclick=()=>this.selected=sc.clutter;const n=$h.new();this.clutterFrame="clutterGreenPipeBodyHorizontalBotton",n.setFrame(this.clutterFrame),null==n||n.whenReady().then((()=>{this.clutterSelect.innerHTML="";const t=document.createElement("img");t.style.width="48px",t.style.height="48px",t.alt="clutter";const e=document.createElement("div");e.innerHTML=t.alt,this.clutterSelect.append(t,e);const i=n.getDataUrl();i&&(t.src=i,this.clutterSelect.addEventListener("wheel",(e=>{var i;const r=n.getFrames();let s=r.findIndex((t=>t===n.getFrame())),o=!1;for(;!1===o;)s=(s+Math.sign(e.deltaY))%r.length,this.clutterFrame=r.at(s),o=null===(i=this.clutterFrame)||void 0===i?void 0:i.includes("clutter");this.clutterFrame&&n.setFrame(this.clutterFrame);const a=n.getDataUrl();a&&(t.src=a)})))})),this.blockSelect=document.createElement("button"),this.blockSelect.innerHTML="block",this.blockSelect.onclick=()=>this.selected=sc.coinblock;const o=$h.new();this.blockFrame="block1",o.setFrame(this.blockFrame),null==o||o.whenReady().then((()=>{this.blockSelect.innerHTML="";const t=document.createElement("img");t.style.width="48px",t.style.height="48px",t.alt="block";const e=document.createElement("div");e.innerHTML=t.alt,this.blockSelect.append(t,e);const i=o.getDataUrl();i&&(t.src=i,this.blockSelect.addEventListener("wheel",(e=>{var i;const r=o.getFrames();let s=r.findIndex((t=>t===o.getFrame())),n=!1;for(;!1===n;)s=(s+Math.sign(e.deltaY))%r.length,this.blockFrame=r.at(s),n=null===(i=this.blockFrame)||void 0===i?void 0:i.includes("block");this.blockFrame&&o.setFrame(this.blockFrame);const a=o.getDataUrl();a&&(t.src=a)})))})),this.zoneSelect=document.createElement("button"),this.zoneSelect.innerHTML="camera<br>zone",this.zoneSelect.onclick=()=>{this.selected=null,this.zoneSelected=!0};const a=()=>{switch(this.selectedZone){case"cam":this.zoneSelect.innerHTML="camera<br>zone";break;case"campreserve":this.zoneSelect.innerHTML="camera preserve<br>zone";break;case"noMInput":this.zoneSelect.innerHTML="no mario input<br>zone";break;case"underwater":this.zoneSelect.innerHTML="underwater<br>zone";break;case"surface":this.zoneSelect.innerHTML="surface<br>zone";break;case"whirlpool":this.zoneSelect.innerHTML="whirlpool<br>zone";break;default:this.zoneSelect.innerHTML="death<br>zone"}};a(),this.zoneSelect.addEventListener("wheel",(t=>{if(Math.sign(t.deltaY)>0)switch(this.selectedZone){case"cam":this.selectedZone="campreserve";break;case"campreserve":this.selectedZone="noMInput";break;case"noMInput":this.selectedZone="underwater";break;case"underwater":this.selectedZone="surface";break;case"surface":this.selectedZone="whirlpool";break;case"whirlpool":this.selectedZone="death";break;default:this.selectedZone="cam"}else switch(this.selectedZone){case"cam":this.selectedZone="death";break;case"campreserve":this.selectedZone="cam";break;case"noMInput":this.selectedZone="campreserve";break;case"underwater":this.selectedZone="noMInput";break;case"surface":this.selectedZone="underwater";break;case"whirlpool":this.selectedZone="surface";break;default:this.selectedZone="whirlpool"}a()})),this.tileSelectors.append(this.zoneSelect,this.marioSelect,this.solidSelect,this.brickSelect,this.blockSelect,this.clutterSelect),this.mousePosDisplay=document.createElement("div");const l=document.createElement("div");l.style.display="flex",l.append(this.mousePosDisplay,t,this.tileSelectors);const h=document.createElement("div"),c=document.createElement("button");c.innerHTML=`Layer: [${this.layer}]`,c.onclick=()=>{this.toggleLayer(),this.toggleTransparency("layer"),c.innerHTML=`Layer: [${this.layer}]`},h.append(c),this.toolsCont=document.createElement("div"),this.toolsCont.style.width="100%",this.toolsCont.style.backgroundColor="white",this.toolsCont.style.display="flex",this.toolsCont.style.justifyContent="space-between",this.toolsCont.append(l,h)}onStart(t){if(!t)return;if(Ca.add(this.graphicsOverlay),fl.clear(),this.scale=Ca.getScale(),this.graphics=t.graphics,this.input=t.input,this.levelDataInit=t.levelDataInit||this.levelDataInit||pc,this.levelDataInit){const t=oc(this.levelDataInit);this.grid=t.grid,this.grid2=t.grid2;for(const[e,i]of Object.entries(this.zones))i.length=0,i.push(...t.parsed[e]||[])}this.toggleTransparency("layer");const e=document.getElementById("tools"),i=document.createElement("div");null==e||e.append(i),i.style.backgroundColor="white",i.append(this.toolsCont),this.disableSave=(()=>{const t=t=>{if(t.ctrlKey&&"KeyS"===t.code){t.preventDefault();const e=Object.assign({entities:[],entities2:[]},this.zones);for(const t of Object.values(this.grid))e.entities.push(t.init);e.entities2||(e.entities2=[]);for(const t of Object.values(this.grid2))e.entities2.push(t.init);const i=new File([JSON.stringify(e)],"level.json"),r=window.document.createElement("a");r.href=window.URL.createObjectURL(i),r.download="level.json",document.body.appendChild(r),r.click(),document.body.removeChild(r)}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)})()}onEnd(){var t;this.toggleTransparency("none"),this.graphicsOverlay.removeFromParent(),null===(t=this.disableSave)||void 0===t||t.call(this);const e=document.getElementById("tools");return e&&(e.innerHTML=""),this.levelDataInit=JSON.stringify(Object.assign({entities:Object.values(this.grid).map((t=>t.init)),entities2:Object.values(this.grid2).map((t=>t.init))},this.zones)),this.graphics&&this.input?[{graphics:this.graphics,input:this.input,zones:this.zones},"gameplay"]:[null,"gameplay"]}onUpdate(t){if(this.graphicsOverlay.clear(),this.selected&&(this.zoneSelected=!1,this.currentZone=void 0),this.zoneSelected?this.zoneSelect.classList.add("selected"):this.zoneSelect.classList.remove("selected"),this.selected!==this.prevSelected){this.prevSelected=this.selected;for(const t of this.tileSelectors.children)t.classList.remove("selected");switch(this.selected){case sc.mario:this.marioSelect.classList.add("selected");break;case sc.block:this.solidSelect.classList.add("selected");break;case sc.brick:this.brickSelect.classList.add("selected");break;case sc.clutter:this.clutterSelect.classList.add("selected");break;case sc.coinblock:this.blockSelect.classList.add("selected")}}if(!this.graphics||!this.input)return!1;if(this.input.isPressed("Space"))return!1;this.input.isPressed("KeyZ")&&(this.input.isHeld("ControlLeft")||this.input.isHeld("ControlRight"))&&(this.input.isHeld("ShiftLeft")||this.input.isHeld("ShiftRight")?this.historyRestore():this.historyUndo());const[e,i]=Ca.getMousePos(),r=16*Math.floor(e/16),s=16*Math.floor(i/16);if(this.mousePosDisplay.innerHTML=`x: ${Math.floor(e)} | y: ${Math.floor(i)}<br>gx: ${r} | gy: ${s}`,fl.update(),this.entityCount.innerHTML=fl.number().toString(),this.graphics.clear(),this.input.isHeld("MouseMain"))if(this.input.isHeld("ControlLeft")&&this.selected){const t=this.remove(e,i);t&&this.historyPush({type:"remove",ents:[t.init],layer:this.layer})}else{const t=r,n=s,o=t+"."+n;if(!this.getGrid()[o]&&this.selected){const r=!this.input.isHeld("ShiftLeft"),s=r?t+8:e,o=r?n+8:i;let a=null;switch(this.selected){case sc.block:a=this.solidFrame&&"solidFloor1"!==this.solidFrame?this.add([this.selected,s,o,{tileFrame:this.solidFrame}]):this.add([this.selected,s,o]);break;case sc.brick:a=this.add([this.selected,s,o,{tileFrame:this.brickFrame}]);break;case sc.clutter:a=this.add([this.selected,s,o,{tileFrame:this.clutterFrame}]);break;case sc.coinblock:a=this.add([this.selected,s,o,{tileFrame:this.blockFrame}]);break;default:a=this.add([this.selected,s,o])}this.historyPush(Object.assign({type:"add"},a))}}if(this.zoneSelected){const t=!this.input.isHeld("ShiftLeft"),n=this.input.isHeld("ControlLeft"),o=t?r:e,a=t?s:i;if(this.input.isPressed("MouseMain"))if(n){this.currentZone=void 0;for(const[t,r]of Object.entries(this.zones)){const s=r.find((t=>Ea.pointVsRect(new xa(e,i),{pos:new xa(t.x,t.y),size:new xa(t.w,t.h)})));if(s){const e=new Set(this.zones[t]);e.delete(s),this.zones[t]=[...e];break}}}else this.currentZone={x:o,y:a,w:16,h:16};if(this.input.isHeld("MouseMain")&&this.currentZone){const e=Math.sign(o+8-this.currentZone.x);if(t)this.currentZone.w=o+16-this.currentZone.x,e<0&&(this.currentZone.w=this.currentZone.w-16);else{const t=o-this.currentZone.x;this.currentZone.w=Math.abs(t)>16?t:16*Math.sign(t)||16}const i=Math.sign(a+8-this.currentZone.y);if(t)this.currentZone.h=a+16-this.currentZone.y,i<0&&(this.currentZone.h=this.currentZone.h-16);else{const t=a-this.currentZone.y;this.currentZone.h=Math.abs(t)>16?t:16*Math.sign(t)||16}}if(this.input.isReleased("MouseMain")&&this.currentZone){let t=0,e=0,i=0,r=0;switch(this.currentZone.w>0?(t=this.currentZone.x,i=this.currentZone.w):(t=this.currentZone.x+this.currentZone.w,i=-this.currentZone.w),this.currentZone.h>0?(e=this.currentZone.y,r=this.currentZone.h):(e=this.currentZone.y+this.currentZone.h,r=-this.currentZone.h),this.selectedZone){case"cam":this.zones.camZones.push({x:t,y:e,w:i,h:r});break;case"campreserve":this.zones.camPreserveZones.push({x:t,y:e,w:i,h:r});break;case"death":this.zones.deathZones.push({x:t,y:e,w:i,h:r});break;case"noMInput":this.zones.noMarioInputZones.push({x:t,y:e,w:i,h:r});break;case"surface":this.zones.surfaceZones.push({x:t,y:e,w:i,h:r});break;case"underwater":this.zones.underwaterZones.push({x:t,y:e,w:i,h:r});break;case"whirlpool":this.zones.whirlpoolZones.push({x:t,y:e,w:i,h:r})}}}return function(t,e,i,r){const s=r.scale;if(r.mousePrevX=r.mouseX,r.mousePrevY=r.mouseY,[r.mouseX,r.mouseY]=e.getMouseViewportPos(),i.isHeld("MouseSecondary")||i.isHeld("MouseAuxiliary")){const[i,s]=e.fromViewport(r.mousePrevX,r.mousePrevY),[n,o]=e.fromViewport(r.mouseX,r.mouseY);r.spanVel.x=(i-n)/t,r.spanVel.y=(s-o)/t}else r.spanVel=r.spanVel.sub(r.spanVel.mul(.1));const n=e.getCenterX(),o=e.getCenterY();e.setCenter(n+r.spanVel.x*t,o+r.spanVel.y*t);const a=i.getWheel();if(a&&(a.deltaY<0?r.scale*=1.1:r.scale/=1.1,r.scale<.1&&(r.scale=.1)),s!==r.scale){const[t,i]=e.getMousePos();e.setScale(r.scale);const[s,n]=e.getMousePos();e.setCenter(e.getCenterX()+t-s,e.getCenterY()+i-n)}}(t,Ca,this.input,this),ml(this.graphics),Mh(t),dc(t,!0),function(t,e,i,r){const[s,n]=Ca.fromViewport(0,0),[o,a]=Ca.fromViewport(Ca.getViewportWidth(),Ca.getViewportHeight()),l=Ca.getScale(),h=l<1&&l>=.499?"medium":l<.499&&l>.2?"far":l<=.2?"farther":"close",c="medium"===h?32:"far"===h?0:"close"===h?16:0;if(!c)return;for(let e=s;e<o+c;e+=c){const i=Math.floor(e/c)*c;t.lineStyle(2/l,4456465).beginFill(0,0).moveTo(i,n).lineTo(i,a).endFill()}for(let e=n;e<a+c;e+=c){const i=Math.floor(e/c)*c;t.lineStyle(2/l,4456465).beginFill(0,0).moveTo(s,i).lineTo(o,i).endFill()}const[u,d]=Ca.getMousePos(),p=16*Math.floor(u/16),f=16*Math.floor(d/16);if(e.lineStyle(3/l,16776960).beginFill(0,0).drawRect(p,f,16,16).endFill(),r){let t=0,i=0,s=0,n=0;r.w>0?(t=r.x,s=r.w):(t=r.x+r.w,s=-r.w),r.h>0?(i=r.y,n=r.h):(i=r.y+r.h,n=-r.h),e.lineStyle(4/l,16777215).beginFill(0,0).drawRect(t,i,s,n).endFill(),e.lineStyle(2/l,0).beginFill(0,0).drawRect(t,i,s,n).endFill()}for(const[t,r]of Object.entries(i)){const i="camZones"===t?16776960:"noCamZones"===t?16755353:"deathZones"===t?16711680:"underwaterZones"===t?255:"whirlpoolZones"===t?65280:"surfaceZones"===t?65535:16711935;r.forEach((t=>{e.lineStyle(4/l,16777215).beginFill(0,0).drawRect(t.x,t.y,t.w,t.h).endFill(),e.lineStyle(2/l,i).beginFill(0,0).drawRect(t.x,t.y,t.w,t.h).endFill()}))}}(this.graphics,this.graphicsOverlay,this.zones,this.currentZone),Fh(),!0}};Xc.connect(Yc,"edit"),Yc.connect($c,"gameplay"),$c.connect(Yc,"editor"),(new class extends Pa{constructor(){super(...arguments),this.state="loading",this.input=new Ra(Ca.getCanvas()),this.graphics=new lo,this.smUpdate=Xc.start(this),this.loading=0}load(){return function(t,e,i,r){return new(i||(i=Promise))((function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){this.loading=1}))}onStart(){this.load(),Ca.add(this.graphics),this.graphics.zIndex=-1}onFrameDraw(){this.input.update();const t=Math.min(1/24,Math.max(this.dt,1/120));this.smUpdate(t),Ca.update(t),Ca.render()}}).start()})()})();